<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Wechat Public Account: PyStaData">
<meta property="og:type" content="website">
<meta property="og:title" content="LG&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="LG&#39;s Blog">
<meta property="og:description" content="Wechat Public Account: PyStaData">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Gang Li">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>LG's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">LG's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/%E6%96%87%E6%9C%AC%E5%A4%A7%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E6%8F%90%E5%8F%96%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/%E6%96%87%E6%9C%AC%E5%A4%A7%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E6%8F%90%E5%8F%96%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">文本大数据信息提取方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 13:17:41 / Modified: 14:01:54" itemprop="dateCreated datePublished" datetime="2020-08-17T13:17:41+08:00">2020-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Notes/" itemprop="url" rel="index"><span itemprop="name">Notes</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Notes/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文为刊载于《经济学（季刊）》2019 年第 4 期上<a target="_blank" rel="noopener" href="https://kns.cnki.net/KCMS/detail/detail.aspx?dbcode=CJFQ&amp;dbname=CJFDLAST2020&amp;filename=JJXU201904001&amp;v=MjkxMDF5ZlRlN0c0SDlqTXE0OUZaWVI4ZVgxTHV4WVM3RGgxVDNxVHJXTTFGckNVUjdxZlpPVnVGeTNsVTcvTUw=">《文本大数据分析在经济学和金融学中的应用：一个文献综述》</a>的阅读笔记。原论文详细综述了文本大数据信息提取方法、文本分析方法在经济学和金融学中的应用，是了解文本分析方法在经济学研究中应用的好材料。本篇笔记聚焦论文的第二部分，即文本大数据信息提取方法，旨在为文本分析方法的学习和日后研究运用提供基本认识。</p>
<p><strong>下图是我阅读时记录的思维导图，原文和高清大图可在公众号后台回复【文本信息】获取。</strong></p>
<p><img src="/2020/08/17/%E6%96%87%E6%9C%AC%E5%A4%A7%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E6%8F%90%E5%8F%96%E6%96%B9%E6%B3%95/文本大数据信息提取方法.png" alt></p>
<h1 id="文本信息提取步骤"><a href="#文本信息提取步骤" class="headerlink" title="文本信息提取步骤"></a>文本信息提取步骤</h1><blockquote>
<p>将文本大数据应用于经济学和金融学研究的核心挑战在于如何准确、有效率地从文本中提取需要的信息，并考察其对相应问题的解释或预测能力。</p>
</blockquote>
<p>这其实表达两层含义：一是操作层面，需要准确的选取文本来源和正确的提取方法，以便技术上准确提取需要的信息；二是应用层面，即提取的信息能否度量预期的现实含义。因此，使用文本大数据用于经济学研究时，一方面要有好的 idea ，选择合适的文本来源和具有操作性的提取方式，另一方面，提取的信息要能较好度量经济含义。</p>
<p><img src="/2020/08/17/%E6%96%87%E6%9C%AC%E5%A4%A7%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E6%8F%90%E5%8F%96%E6%96%B9%E6%B3%95/文本信息提取步骤.jpg" alt></p>
<p>上图展示了信息提取的过程，$\Psi$ 表示原始文本库，$Y$ 表示要解释或者预测的经济或者金融现象（可以理解为被解释变量），要考察 $\Psi$ 对 $Y$ 的解释能力，需要经过三个步骤：</p>
<ul>
<li>将文本库 $\Psi$ 内所有的文本转化为数据矩阵 $\Lambda$ ；</li>
<li>通过计量或者统计方法 $F$ ，将 $\Lambda$ 转换成目标信息序列 $V$ ，比如关注度、情绪和不确定性指数等；</li>
<li>用提取出的 $V$ 来解释或者预测 $Y$ 。</li>
</ul>
<p>其实第一步和第二步是如何将数据结构化，即从文本大数据提取信息。而第三步（利用结构化的数据来完成解释和预测工作）是计量经济学和统计学的研究重点。接下来，我们一起来梳理从原始文本中提取信息的方法。</p>
<h1 id="文本大数据信息提取方法"><a href="#文本大数据信息提取方法" class="headerlink" title="文本大数据信息提取方法"></a>文本大数据信息提取方法</h1><h2 id="原始文本库到数据矩阵的结构化转换"><a href="#原始文本库到数据矩阵的结构化转换" class="headerlink" title="原始文本库到数据矩阵的结构化转换"></a>原始文本库到数据矩阵的结构化转换</h2><p>自然语言理解面临的主要障碍：一是同一字（词）的含义在不容场景或语境下有变化，这里有一些经典的笑话（更多例子可以去看 <a target="_blank" rel="noopener" href="https://github.com/fighting41love/hardNLU" title="hardNLU">hardNLU</a> 乐呵乐呵）：</p>
<ul>
<li>“南京市长江大桥”（你好，江大桥市长）</li>
<li>他快抱不起儿子了，因为他太胖了（他是谁？）</li>
<li>书《无线电法国别研究》（法国别研究了）</li>
<li>我背有点驼，麻麻说“你的背得背背背背佳”</li>
</ul>
<p>二是由于文字的多样性，在转换为数据矩阵后往往需要处理高维稀疏矩阵相关的问题。</p>
<h3 id="分词技术"><a href="#分词技术" class="headerlink" title="分词技术"></a>分词技术</h3><p>英文单词由空格隔开，单词就实现了分词。实证中会将单个词语扩展成长度为 n 的词组，即 n 元词组（n-gram）。n-gram 是大词汇连续文本或语音识别中常用的一种语言模型，它是利用上下文相邻词的搭配信息来进行文本大数据转换。其中， n 代表一个整型数值，当 n 为 2 的时候，模型称为 bi-gram ，意思是模型会对相邻的两个词进行匹配；当 n 为 3 时，模型称为 tri-gram ，也就是会对相邻 3 个单词进行匹配。而中文汉字为连续序列，所以需要分词。 Python 中常用的分词库有 <a target="_blank" rel="noopener" href="https://github.com/fxsjy/jieba" title="jieba">jieba</a> 和北大的 <a target="_blank" rel="noopener" href="https://github.com/lancopku/PKUSeg-python" title="pkuseg">pkuseg</a> 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jieba 库</span></span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line">jieba.enable_paddle() <span class="comment"># 启动paddle模式。 0.40版之后开始支持，早期版本不支持</span></span><br><span class="line">strs=[<span class="string">&quot;我来到北京清华大学&quot;</span>,<span class="string">&quot;乒乓球拍卖完了&quot;</span>,<span class="string">&quot;中国科学技术大学&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> strs:</span><br><span class="line">    seg_list = jieba.cut(str,use_paddle=<span class="literal">True</span>) <span class="comment"># 使用paddle模式</span></span><br><span class="line">    print(<span class="string">&quot;Paddle Mode: &quot;</span> + <span class="string">&#x27;/&#x27;</span>.join(list(seg_list)))</span><br><span class="line"></span><br><span class="line">seg_list = jieba.cut(<span class="string">&quot;我来到北京清华大学&quot;</span>, cut_all=<span class="literal">True</span>)</span><br><span class="line">print(<span class="string">&quot;Full Mode: &quot;</span> + <span class="string">&quot;/ &quot;</span>.join(seg_list))  <span class="comment"># 全模式</span></span><br><span class="line"></span><br><span class="line">seg_list = jieba.cut(<span class="string">&quot;我来到北京清华大学&quot;</span>, cut_all=<span class="literal">False</span>)</span><br><span class="line">print(<span class="string">&quot;Default Mode: &quot;</span> + <span class="string">&quot;/ &quot;</span>.join(seg_list))  <span class="comment"># 精确模式</span></span><br><span class="line"></span><br><span class="line">seg_list = jieba.cut(<span class="string">&quot;他来到了网易杭研大厦&quot;</span>)  <span class="comment"># 默认是精确模式</span></span><br><span class="line">print(<span class="string">&quot;, &quot;</span>.join(seg_list))</span><br><span class="line"></span><br><span class="line">seg_list = jieba.cut_for_search(<span class="string">&quot;小明硕士毕业于中国科学院计算所，后在日本京都大学深造&quot;</span>)  <span class="comment"># 搜索引擎模式</span></span><br><span class="line">print(<span class="string">&quot;, &quot;</span>.join(seg_list))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># Paddle Mode: 我/来到/北京清华大学</span></span><br><span class="line"><span class="comment"># Paddle Mode: 乒乓球/拍卖/完/了</span></span><br><span class="line"><span class="comment"># Paddle Mode: 中国科学技术大学</span></span><br><span class="line"><span class="comment"># Full Mode: 我/ 来到/ 北京/ 清华/ 清华大学/ 华大/ 大学</span></span><br><span class="line"><span class="comment"># Default Mode: 我/ 来到/ 北京/ 清华大学</span></span><br><span class="line"><span class="comment"># 他, 来到, 了, 网易, 杭研, 大厦</span></span><br><span class="line"><span class="comment"># 小明, 硕士, 毕业, 于, 中国, 科学, 学院, 科学院, 中国科学院, 计算, 计算所, ，, 后, 在, 日本, 京都, 大学, 日本京都大学, 深造</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pkuseg 库</span></span><br><span class="line"><span class="keyword">import</span> pkuseg</span><br><span class="line"></span><br><span class="line">seg = pkuseg.pkuseg()           <span class="comment"># 以默认配置加载模型</span></span><br><span class="line">text = seg.cut(<span class="string">&#x27;我爱北京天安门&#x27;</span>)  <span class="comment"># 进行分词</span></span><br><span class="line">print(text)</span><br><span class="line"></span><br><span class="line">seg = pkuseg.pkuseg(model_name=<span class="string">&#x27;medicine&#x27;</span>)  <span class="comment"># 程序会自动下载所对应的细领域模型</span></span><br><span class="line">text = seg.cut(<span class="string">&#x27;我爱北京天安门&#x27;</span>)              <span class="comment"># 进行分词</span></span><br><span class="line">print(text)</span><br><span class="line"></span><br><span class="line">seg = pkuseg.pkuseg(postag=<span class="literal">True</span>)  <span class="comment"># 开启词性标注功能</span></span><br><span class="line">text = seg.cut(<span class="string">&#x27;我爱北京天安门&#x27;</span>)    <span class="comment"># 进行分词和词性标注</span></span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure>
<p>关于各分词工具的性能，在 pkuseg 主页有其和 jieba、THULAC 等国内代表分词工具包的比较，详情可参见 <a target="_blank" rel="noopener" href="https://github.com/lancopku/pkuseg-python/blob/master/readme/comparison.md" title="comparison">comparison</a> 。</p>
<p>根据分割原理，可将现有分词方法归纳为<strong>基于字符串匹配</strong>、<strong>基于理解</strong>和<strong>基于统计</strong>三类。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">方法</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">基于字符串匹配</td>
<td style="text-align:center">将待分析的字符串与前定的词典词条匹配，若某个字符串可在词典中找到，则记为识别出一个词。该方法的好处是简便快速，但忽略歧义问题</td>
</tr>
<tr>
<td style="text-align:center">基于理解</td>
<td style="text-align:center">在分词的同时进行句法、语义分析，以改进对歧义词的处理</td>
</tr>
<tr>
<td style="text-align:center">基于统计</td>
<td style="text-align:center">先用机器学习模型学习已经切分好的词语的规律，进而实现对未知文本的切分，常用方法包括<strong>最大概率分词法</strong>和<strong>最大熵分词法</strong>等</td>
</tr>
</tbody>
</table>
</div>
<p>目前文献中用到的分词方法常将三种方法结合。需要注意的是，由于一些特定领域的文本包含一些对信息提取比较重要的专有词语（如上市公司名称、金融术语等），因此常常需要根据研究问题拓展现有词典，以提高软件识别和分割词语的准确度。</p>
<h2 id="词转换为向量的技术"><a href="#词转换为向量的技术" class="headerlink" title="词转换为向量的技术"></a>词转换为向量的技术</h2><p>完成分词之后需要考虑如何将文本进一步转化为数字化矩阵。<strong>如果将一篇文本视作从所有词语库中挑选若干词形成的组合，这一转换的主要挑战往往是如何对由词语构成的高维矩阵实现降维的问题。要理解这一点首先需要了解独热表示法（One-hot representation）</strong>。</p>
<h3 id="独热表示法"><a href="#独热表示法" class="headerlink" title="独热表示法"></a>独热表示法</h3><p>独热法的特点是忽略语法和语序等要素，将文本数据看作是若干独立词汇的集合。首先，根据文本中出现的全部词语构成一个词表（通常是去掉“的、地、得、和”等停用词和标点符号后得到的全部词语），并将每个词按顺序编号 $1,2,3…,N$ 。然后，将词语 $j$ 用一个 $N$ 维向量 $w_j$ 来表示，该向量的第 $j$ 个位置的元素为 1 ，其余为 0 。在每一个词都转换为一个向量后，通过加总所有词的向量，文本 $t$ 就可以转化为 $1\times N$ 的向量 $W_t$ ，其中 $w_j (j = 1,2,…,N)$ 是第 $j$ 个词语在文本 $t$ 中出现的频率。若一共有 $t=1,…T$ 个文本，采用独热表示法之后，原始文本库 $\Psi$ 就可以转化为 $T\times N$ 的数字矩阵。</p>
<p>例如，原始文本库 $\Psi$ 由两条帖子组成。第一条的内容是“明天涨停。后天涨停没戏。”，第二条是“玛丽有个小绵羊。”分词后得 “明天、涨停、后天、没戏、玛丽、有、个、小、绵羊”九个不同词语，即 $N = 9$ 。用独热法则“明天”用向量 $[1,0,0,0,0,0,0,0,0]$ 表示，“涨停”为 $[0,1,0,0, 0,0,0,0,0]$ ，以此类推。于是第一个帖子可用向量 $[1,2,1,1,0,0,0,0,0]$ 表示,第二个帖子即 $[0,0,0,0,1,1,1,1,1]$ 。</p>
<blockquote>
<p>One-Hot 编码是分类变量作为二进制向量的表示。这首先要求将分类值映射到整数值。然后，每个整数值被表示为二进制向量，除了整数的索引之外，它都是零值，被标记为 1 。</p>
</blockquote>
<p>在实际操作时，数值型类别变量可以直接调用 sklearn 库中的 <code>OneHotEncoder</code> 进行编码，但是 <code>OneHotEncoder</code> 无法直接对字符型变量编码，也就是说 <code>OneHotEncoder().fit_transform(str_ls)</code> 会报错。所以一般采用如下两种方法：</p>
<ul>
<li>先用 <code>LabelEncoder()</code> 转换成连续的数值型变量，再用 <code>OneHotEncoder()</code> 二值化。</li>
<li>直接用 <code>LabelBinarizer()</code> 进行二值化，这种方法只支持一维数组，也就是每次只能传入一个变量。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 独热表示法</span></span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelBinarizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分词</span></span><br><span class="line">text = <span class="string">&quot;玛丽有一个小绵羊。&quot;</span></span><br><span class="line">text_str = jieba.cut(text)</span><br><span class="line">stopwords = [<span class="string">&#x27;，&#x27;</span>, <span class="string">&#x27;。&#x27;</span>]     <span class="comment"># 停用词</span></span><br><span class="line">text_ls = [x <span class="keyword">for</span> x <span class="keyword">in</span> text_str</span><br><span class="line">           <span class="keyword">if</span> len(x) &gt; <span class="number">1</span></span><br><span class="line">           <span class="keyword">and</span> x <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br><span class="line">print(text_ls)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法一：先转为数值型变量，再进行二值化</span></span><br><span class="line"><span class="comment"># 转为数值型编码</span></span><br><span class="line">label_encoder = LabelEncoder()</span><br><span class="line">integer_encoded = label_encoder.fit_transform(text_ls)</span><br><span class="line">print(integer_encoded)</span><br><span class="line"><span class="comment"># 二值编码</span></span><br><span class="line">onehot_encoder = OneHotEncoder(sparse=<span class="literal">False</span>)</span><br><span class="line">integer_encoded = integer_encoded.reshape(len(integer_encoded), <span class="number">1</span>)</span><br><span class="line">onehot_encoded = onehot_encoder.fit_transform(integer_encoded)</span><br><span class="line">print(onehot_encoded)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二：直接二值化</span></span><br><span class="line">LabelBinarizer().fit_transform(text_ls) <span class="comment"># 传入变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&#x27;玛丽&#x27;, &#x27;一个&#x27;, &#x27;小绵羊&#x27;]</span></span><br><span class="line"><span class="string">[2 0 1]</span></span><br><span class="line"><span class="string">[[0. 0. 1.]</span></span><br><span class="line"><span class="string"> [1. 0. 0.]</span></span><br><span class="line"><span class="string"> [0. 1. 0.]]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">array([[0, 0, 1],</span></span><br><span class="line"><span class="string">       [1, 0, 0],</span></span><br><span class="line"><span class="string">       [0, 1, 0]])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>上述步骤显示，独热法操作简单；但数据量大时转换后的矩阵往往是高维稀疏数据矩阵。这是由词向量维数由词语数量决定、并且大部分词语出现频率低，因此文本对应的向量中绝大部分值为零的特征决定的。<strong>另外，独热法可能因忽略上下文结构而会产生歧义</strong>。例如上例中第一个帖子转换成的向量也可以是 “明天涨停没戏。后天涨停。”的转换结果，这和原文的含义产生了偏差。</p>
<p><strong>解决高维稀疏矩阵的问题：一是采取多种措施对数字化文本实现降维；二是采用词语嵌入技术（Word Embedding），直接在词语转换为数字化矩阵时就将词语转化为低维向量</strong>。</p>
<h2 id="词嵌入技术"><a href="#词嵌入技术" class="headerlink" title="词嵌入技术"></a>词嵌入技术</h2><p>词嵌入技术是指把一个维数为所有词的数量的高维空间“嵌入”到一个维数低得多的连<br>续向量空间中涉及的模型和技术。即 $e_j = E \times W_j$ ，其中 $e_j$ 表示第 $j$ 个词通过嵌入矩阵 $E$ （embedding matrix）映射到实数域上的词向量，$W_j$ 为第 $j$ 个词的独热向量表示。由于该向量的每个元素值可以是连续值而不只是 0 或者 1 ，$e_j$ 的维度 $N_e$ 可以远低于 $N$ 。</p>
<p>独热表示法可以看成最简单的词嵌入方法，即 $e_j = E \times W_j = w_j$ 。常用词嵌入算法：</p>
<ul>
<li>Word2Vec：先用向量代表各个词，然后通过神经网络模型, 在大量的文本语料数据上来学习这些向量的参数。训练后的模型不仅可以将每个词语映射到一个低维的空间上（通常为 100-1000 维），每个维数上的取值为连续值；并且根据不同词语的向量距离可以度量词语间的相似程度，也解决了独热法下不同词语相互独立的问题。</li>
<li>GloVe（Global vector for Word Representation）。</li>
</ul>
<h2 id="数据矩阵的信息提取"><a href="#数据矩阵的信息提取" class="headerlink" title="数据矩阵的信息提取"></a>数据矩阵的信息提取</h2><p>现有经济和金融领域文本相关分析的问题大致可分为两类：</p>
<ol>
<li>区分文本显示的投资者情绪正负、新闻或者文件语调正负、报纸属于左派还是右派、以及行业分类等聚类问题。</li>
<li>对情绪、不确定性、恐慌程度、意见分歧程度的度量以及相应的回归问题。</li>
</ol>
<h3 id="无监督学习方法"><a href="#无监督学习方法" class="headerlink" title="无监督学习方法"></a>无监督学习方法</h3><h4 id="词典法"><a href="#词典法" class="headerlink" title="词典法"></a>词典法</h4><p><strong>该方法从预先设定的词典出发，通过统计文本数据中不同类别词语出现的次数，结合不同的加权方法来提取文本信息</strong>。使用词典法的一个关键环节是选择或构建合适的词典，这里词典包括了特定词典，也包括作者构造的特定词语或词组的集合。</p>
<p>英文常见词典如下：<br>|词典|特点|文献|<br>|:—:|:—:|:—:|<br>|Harvard IV-4 |包含心理和社会学常涉及的 1045 个正面词语和 1160 个负面词语，并非为金融领域文本专门创建|Tetlock(2007)；Tetlock et al.(2008)；Jegadeesh and Wu(2013)|<br>|Henry|专门为金融文本构建的词典|Henry(2008)；Price et al.(2012)|<br>|Diction|包含 686 个正面词汇和 920 个负面词汇，主要应用于会计领域|Rogers et al.(2011)；Davis et al.(2012)|<br>|Loughran and McDonald（简称：LM）|从上市公司的 10-K 文件中人工收集并整理构造出来，他们的实证结果表明 LM 词典在度量文本情绪方面比 Harvard IV-4 词典和 Diction 词典的效果更好，因此目前用词典法分析金融、会计领域文本情绪时多采用 LM 词典|Garcia(2013)； Huang et al. (2014)； Loughran and McDonald(2014)；Solomon et al.(2014)|</p>
<p>中文词典：<br>|词典|特点|文献|<br>|:—:|:—:|:—:|<br>|适用于中国股吧论坛的金融情绪词典|随机抽取 2008 到 2018 年间某股票论坛四万条帖子，人工挑取其中正、负面词语|Chen et al.（2018）|<br>|中国财经媒体领域的正负面词库|手动整理新闻报道，结合《现代汉语词典》、《最新汉英经济金融常用术语使用手册》、LM 词典中文版以及知网-中文信息结构库等词库|汪昌云和武佳薇（2015）|<br>|适用于金融科技领域的情感词词典|根据和讯网上的新闻|王靖一和黄益平（2018）|</p>
<p>除了确定词典，另一个重要的问题是如何确定词语权重。常见的加权方法有<strong>等权重</strong>、<strong>词频-逆文档（TF-IDF）加权</strong>和<strong>对应变量加权</strong>三种。<br>|加权方法|特点|<br>|:—-|:—-|<br>|等权重法|假定文本中每个词语的重要程度相同|<br>|TF-IDF 加权方法|<strong>同时考虑词语在文本中出现的次数（频率）和多少文档包含该词语这两个维度</strong>，对在文本中频繁出现但并没有实际含义的词语赋予较少的权重、而给予有重要含义但出现次数较少的词语较大权重|<br>|对应变量加权|是指借用文本中词语与对应变量（市场收益率、波动率指数等）的关系来确定词语的权重|</p>
<p>TF-IDF ( Term Frequency-Inverse Document Frequency ) ，一般翻译为“词频-逆向文件频率”。其计算公式为：</p>
<p>首先，计算 tf 的值：</p>
<script type="math/tex; mode=display">
tf = \frac{n_{i,j}}{\sum_k{n_{kj}}}</script><p>其中，$n<em>{i,j}$ 表示某个词在语料库中出现的次数；$\sum_k{n</em>{k,j}}$ 表示是该文件中所有单词出现的次数之和。</p>
<p>而在 scikit-learn 中，idf 的计算公式为:</p>
<script type="math/tex; mode=display">
idf = log(\frac{N+1}{N_{w}+1})+1</script><p>其中，$N$ 表示语料库中的文件总数；$N_w$ 代表语料库中包含上述单词的文件数量。</p>
<p>那么，tf-idf 的计算公式为：</p>
<script type="math/tex; mode=display">
tf-idf = tf*idf</script><p>注：tf-idf 的计算公式有多种变体。</p>
<p>在 jieba 库中使用 tf-idf 进行关键词提取的操作如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba.analyse <span class="keyword">as</span> analyse</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">&#x27;../data/2020年中央一号文件.txt&#x27;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">t = f.read()</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot; &quot;</span>.join(analyse.extract_tags(t,topK=<span class="number">20</span>,withWeight=<span class="literal">False</span>,allowPOS=())))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># 农村 脱贫 乡村 建设 农业 加强 推进 扶贫 三农 工作 用地 全面 服务 治理 支持 攻坚 落实 开展 农产品 强化</span></span><br></pre></td></tr></table></figure>
<p>上方基于 TF-IDF 算法的关键词抽取代码的参数解释：</p>
<ul>
<li><code>sentence</code> 为待提取的文本</li>
<li><code>topK</code> 为返回几个 TF/IDF 权重最大的关键词，默认值为 20</li>
<li><code>withWeight</code> 为是否一并返回关键词权重值，默认值为 False</li>
<li><code>allowPOS</code> 仅包括指定词性的词，默认值为空，即不筛选</li>
</ul>
<h4 id="主题分类模型"><a href="#主题分类模型" class="headerlink" title="主题分类模型"></a>主题分类模型</h4><p>在经济和金融领域的一个应用需求是在没有事先标注集的情况下，对文本按主题做分类。由于一篇文本的主题可能有多个，这类分类问题不同于按照事先标注集、将一篇文本仅归入一类的应用。主题分类问题的代表模型是由 Blei et al.（2003）提出的隐含狄利克雷分配（Latent Dirichlet Allocation，LDA）模型，它是一种概率主题模型。</p>
<p>LDA 模型假定全部文档 $M$ 中存在 $K$ 个主题，每个文档 $m$ 包含 $N<em>m$ 个词语，并且每个词都是由其中一个主题生成。主题服从一个多项式分布 $\theta_m$ ，而每个主题 $k$ 与词汇表中的 $V$ 个单词的一个多项式分布 $\varphi</em>{k}$ 相对应，并且假定分布 $\theta_m$ 和分布 $\varphi_k$ 具有共轭的狄利克雷分布。该共轭的狄利克雷分布的超参数为 $\alpha$ 和 $\beta$ 。<strong>这样，通过预设文档中的主题个数，LDA 模型可以将每篇文档的主题以概率分布的形式给出，其中每个主题对应一类词语的分布，根据词语分布可以挑选出一些关键词对该主题进行描述</strong>。</p>
<p><img src="/2020/08/17/%E6%96%87%E6%9C%AC%E5%A4%A7%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E6%8F%90%E5%8F%96%E6%96%B9%E6%B3%95/LDA模型图示法.png" alt></p>
<p>LDA 模型假定文档的生成过程如上图所示：（1）从狄利克雷分布 $\alpha$ 中抽样得到文档 $m$ 的主题多项式分布 $\theta<em>m$ ，从狄利克雷分布 $\beta$ 抽样得到主题 $k$ 的词语多项式分布 $\varphi_k$，其中 $k = 1,2,…,k$；（2）从主题多项式分布 $\theta_m$ 中抽样得到文档 $m$ 的第 $n$ 个词的主题 $Z</em>{m,n}$ ；（3）从主题 $Z<em>{m,n}$ 对应的词语分布 $\varphi</em>{m,n}$ 抽取 $W<em>{m,n}$ ；（4）重复上述步骤 $N</em>{m}$ 次。因此，所有已知和隐藏的变量联合分布可以表示为：</p>
<script type="math/tex; mode=display">
P(W_{m},Z_{m},\theta_{m},\Phi;\alpha,\beta) = \prod_{n=1}^{N_{m}}P(\theta_m;\alpha)P(Z_{m,n}|\theta_m)P(\Phi;\beta)P(W_{m,n}|\varphi_{Z_{m,n}})</script><p>其中，$\Phi = {\theta<em>{k}}</em>{k=1}^{K}$，模型中唯一可观测的变量是词语 $W<em>{m,n}$ 。实际应用中，可以通过 Gibss 抽样方法来估计 LDA 模型的参数，从而得到每篇文档的主题分布 $\theta_m$ 和每个主题对应的词语分布 $\varphi</em>{k}$ 。</p>
<p>LDA 的一个局限性是需要人为地给出一个主题数量，而主题数量的选择会影响主题的生成和文档的归类。</p>
<h3 id="有监督学习方法"><a href="#有监督学习方法" class="headerlink" title="有监督学习方法"></a>有监督学习方法</h3><h4 id="经典的有监督机器学习方法"><a href="#经典的有监督机器学习方法" class="headerlink" title="经典的有监督机器学习方法"></a>经典的有监督机器学习方法</h4><p>经典机器学习方法包括朴素贝叶斯、支持向量机、决策树、K 近邻算法、AdaBoost、最大熵法等。在金融领域的文本分析中，较为常用的传统机器学习方法包括朴素贝叶斯（Naive Bayes）和支持向量机（Support Vector Machine，SVM）。</p>
<p>朴素贝叶斯算法假定文本中的特征互相独立，即不同词语不存在相互依赖关系。在处理文本分类问题时常见步骤如下：</p>
<ul>
<li>根据训练集学习文本中词语与所属类别的关系，得到朴素贝叶斯分类器的先验分布（即本文属于不同类别的先验概率），以及条件概率分布（即给定分类类别下某词语出现的频率）；</li>
<li>使用前一步得到的概率，根据文本中的词语特征，结合贝叶斯条件概率公式，计算文档属于不用类别的条件概率；</li>
<li>按照最大后验概率假设将文本分类为具有最大后验概率的一类。</li>
</ul>
<p>支持向量机（Vapnik，1996）是一种容许词语间存在相互依赖的有监督学习算法，既可以用于分类也可以用于回归分析。其基本原理是：首先将每个文本投射为高维空间的一个点，通过寻找到一个超平面，将这些点按照其对应的标签（如正、负情绪等）进行分割，使得每个类别的点到这个超平面的最近距离最大化。使用支持向量机进行分类和回归分析前的步骤：</p>
<ul>
<li>采用独热表示法或者 Word2Vec 等方法将文本转化为向量；</li>
<li>根据训练集学习文本向量与所属类别的关系；</li>
<li>对将根据训练集得到的模型做交叉验证（cross-validation）；</li>
<li>将训练出的最优模型用于预测所有文本分类。</li>
</ul>
<h4 id="深度学习法"><a href="#深度学习法" class="headerlink" title="深度学习法"></a>深度学习法</h4><p>文本分析中，SVM 等分类器虽然可以处理一定的非线性，但作为线性分类器，这类方法往往只能将输入数据切分为非常简单的区域，也容易导致过拟合等问题（Gentzkow et al.，2018）。作为机器学习的分支，深度学习试图通过模仿人脑的神经网络，使用多重非线性变换构成的多个处理层对数据进行高层抽象，以实现分类等目标。</p>
<p>深度学习常用模型包括深度神经网络（Deep neural nets，DNN）、卷积神经网络（Convolutional Neural Network，CNN），和循环神经网络（Recurrent Neural Network，RNN）等。</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>无论是采用经典机器学习方法还是新兴的深度学习法，有监督训练都需要两个要素：<strong>高质量的标注数据作为训练集和明确的模型选择标准</strong>。由于训练集质量会直接影响最终信息提取效果，做相关研究应事先评估构建标注数据需要耗费的成本。在模型选择标准方面，理想模型不仅要能避免样本内过拟合，也要有较好的样本外表现。通常需要采用交叉验证的方法来评估模型：</p>
<ul>
<li>首先将标注集按照一定的比例随机分为训练集、验证集和测试集；</li>
<li>再在训练集上训练模型，根据其在验证集上的表现来调整模型参数；</li>
<li>最后将模型应用到测试集上计算准确率，作为评估模型样本外表现的标准。</li>
</ul>
<p>综上所述，<strong>选择文本数据信息提取方法需综合考虑文本数据的来源、语言环境、内容长短以及需提取信息的特征等因素，同时评估各类方法的成本和收益</strong>。在条件允许的情况下，可同时考虑简单方法和复杂方法，通过分析比较两类方法的差异来提高信息提取的准确性。当然，使用复杂方法时需要保证这些方法的透明性和可复制性（Loughran and McDonald，2016）。最后还要注意的是，数据的结构化转换和文本数据信息提取这两步的执行顺序需要依靠具体问题来决定，有时需要反复尝试才能找到最佳方案。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Mrwan/p/7411447.html" title="scikit-learn- 特征二值化">scikit-learn- 特征二值化</a></p>
<p><a target="_blank" rel="noopener" href="https://machinelearningmastery.com/how-to-one-hot-encode-sequence-data-in-python/" title="Jason Brownlee-How to One Hot Encode Sequence Data in Python">Jason Brownlee-How to One Hot Encode Sequence Data in Python</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/%E7%94%A8TikZ%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%B8%B8%E7%94%A8%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/%E7%94%A8TikZ%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%B8%B8%E7%94%A8%E5%9B%BE/" class="post-title-link" itemprop="url">用TikZ快速绘制微观经济学常用图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 13:08:01 / Modified: 14:02:06" itemprop="dateCreated datePublished" datetime="2020-08-17T13:08:01+08:00">2020-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LaTeX/" itemprop="url" rel="index"><span itemprop="name">LaTeX</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LaTeX/Stata/" itemprop="url" rel="index"><span itemprop="name">Stata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>看经济学教材的时候，在想这些复杂又清晰的图是怎么绘制的。于是上网搜了一下，根据网上的信息，在 LaTeX 中使用 TikZ 包进行绘制是一个不错的选择，所以这两天花点时间学习了一下。</p>
<p>这篇推文算是学习笔记，共分为三部分：首先，从最熟悉的供求均衡入手，通过带有详细注释的代码，熟悉基本用法；虽有，尝试做一个用阴影表示消费者剩余变化的练习题，这部分我还用 Stata 画了图对比；最后，从其他资料中附上其他示例。</p>
<h2 id="均衡"><a href="#均衡" class="headerlink" title="均衡"></a>均衡</h2><p><img src="/2020/08/17/%E7%94%A8TikZ%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%B8%B8%E7%94%A8%E5%9B%BE/1.png" alt></p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">documentclass</span><span class="string">&#123;article&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">usepackage</span><span class="string">[utf8]</span><span class="string">&#123;inputenc&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">usepackage</span><span class="string">&#123;tikz&#125;</span></span> <span class="comment">% 引入tikz宏包</span></span><br><span class="line"><span class="tag">\<span class="name">usetikzlibrary</span><span class="string">&#123;calc&#125;</span></span> <span class="comment">% 计算坐标轴</span></span><br><span class="line"></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;document&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;tikzpicture&#125;</span><span class="string">[domain=0:5,scale=1.5,thick]</span></span> <span class="comment">% scale 实现缩放，所以不必担心绝对坐标的问题</span></span><br><span class="line"><span class="comment">% 定义供给曲线和需求曲线的参数</span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">dint</span><span class="string">&#123;4.5&#125;</span></span> <span class="comment">%需求曲线Y轴的截距</span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">dslp</span><span class="string">&#123;-0.5&#125;</span></span> <span class="comment">%需求曲线的斜率</span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">sint</span><span class="string">&#123;1.2&#125;</span></span> <span class="comment">%供给曲线Y轴的截距</span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">sslp</span><span class="string">&#123;0.8&#125;</span></span> <span class="comment">%供给曲线的斜率</span></span><br><span class="line">    <span class="comment">%定义供给曲线和需求曲线</span></span><br><span class="line">    <span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">demmand</span><span class="string">&#123;\x,&#123;\dslp*\x+\dint&#125;</span></span>&#125;</span><br><span class="line">    <span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">supply</span><span class="string">&#123;\x,&#123;\sslp*\x+\sint&#125;</span></span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">% 标记坐标点</span></span><br><span class="line"><span class="tag">\<span class="name">coordinate</span></span> (ints) at (&#123;(<span class="tag">\<span class="name">sint</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)&#125;,&#123;(<span class="tag">\<span class="name">sint</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)*<span class="tag">\<span class="name">sslp</span></span>+<span class="tag">\<span class="name">sint</span></span>&#125;);  <span class="comment">%均衡点</span></span><br><span class="line"><span class="tag">\<span class="name">coordinate</span></span> (ep) at (0,&#123;(<span class="tag">\<span class="name">sint</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)*<span class="tag">\<span class="name">sslp</span></span>+<span class="tag">\<span class="name">sint</span></span>&#125;); <span class="comment">%均衡价格纵坐标</span></span><br><span class="line"><span class="tag">\<span class="name">coordinate</span></span> (eq) at (&#123;(<span class="tag">\<span class="name">sint</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)&#125;,0); <span class="comment">%均衡数量横坐标</span></span><br><span class="line"><span class="tag">\<span class="name">coordinate</span></span> (dint) at (0,&#123;<span class="tag">\<span class="name">dint</span></span>&#125;);</span><br><span class="line"><span class="tag">\<span class="name">coordinate</span></span> (sint) at (0,&#123;<span class="tag">\<span class="name">sint</span></span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">% 绘制坐标轴</span></span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[-&gt;]</span></span> (0,0) -- (0,6) node[above] &#123;<span class="formula">$P$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[-&gt;]</span></span> (0,0) -- (7,0) node[right] &#123;<span class="formula">$Q$</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">% 绘制供给和需求曲线</span></span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[thick, color=blue]</span></span> plot (<span class="tag">\<span class="name">demmand</span></span>) node(right) &#123;<span class="formula">$D(p)=&#123;45&#125;-5p$</span>&#125;; <span class="comment">% 需求曲线</span></span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[thick, color=red]</span></span> plot (<span class="tag">\<span class="name">supply</span></span>) node(right) &#123;<span class="formula">$S(p)=12+8p$</span>&#125;; <span class="comment">% 供给曲线</span></span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span> (ints) -- (ep) node[left] &#123;<span class="formula">$p^*$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span> (ints) -- (eq) node[below] &#123;<span class="formula">$q^*$</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">% 标示均衡点</span></span><br><span class="line"><span class="tag">\<span class="name">fill</span><span class="string">[purple]</span></span> (ints) circle (2pt);</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;tikzpicture&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;document&#125;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="表示消费者剩余变化"><a href="#表示消费者剩余变化" class="headerlink" title="表示消费者剩余变化"></a>表示消费者剩余变化</h2><p>问题：考察线性需求曲线$D(p)=20-2p$。当价格从 2 上升至 3 时，相应地，消费者剩余的变化是多少？并通过图形表示。</p>
<h3 id="Stata绘制"><a href="#Stata绘制" class="headerlink" title="Stata绘制"></a>Stata绘制</h3><p><img src="/2020/08/17/%E7%94%A8TikZ%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%B8%B8%E7%94%A8%E5%9B%BE/2.jpg" alt></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">clear</span></span><br><span class="line"><span class="keyword">set</span> obs 200</span><br><span class="line"></span><br><span class="line"><span class="keyword">gen</span> q = _n</span><br><span class="line"><span class="keyword">gen</span> p = (20-q)/2 </span><br><span class="line"><span class="keyword">keep</span> <span class="keyword">if</span>  p &gt;0</span><br><span class="line"><span class="keyword">gen</span> p1 = 2</span><br><span class="line"><span class="keyword">gen</span> p2 = 3</span><br><span class="line"></span><br><span class="line"><span class="keyword">line</span> p q || (rarea p p1 q <span class="keyword">if</span> q &lt;= 16 &amp; p &lt;= 3, <span class="keyword">sort</span> color(gray)) || <span class="comment">///</span></span><br><span class="line">    (rarea p1 p2 q <span class="keyword">if</span> q &lt;= 14,<span class="keyword">sort</span> color(gray)), <span class="comment">///</span></span><br><span class="line">    scheme(qleanmono) plotregion(margin(sides)) legend(off) <span class="comment">/// </span></span><br><span class="line">    title(<span class="string">&quot;消费者剩余的变化&quot;</span>) <span class="comment">///</span></span><br><span class="line">    ytitle(<span class="string">&quot;p&quot;</span>) xtitle(<span class="string">&quot;q&quot;</span>) <span class="comment">///</span></span><br><span class="line">    yline(2,lp(dash)) xline(16,lp(dash)) <span class="comment">///</span></span><br><span class="line">    yline(3,lp(dash)) xline(14,lp(dash)) <span class="comment">///</span></span><br><span class="line">    ylabel(0(2)10 2 3) xlabel(0(4)20 14 16) <span class="comment">///</span></span><br><span class="line">    text(6.5 10  <span class="string">&quot;&#123;it:D(P) = 20 - 2*P&#125;&quot;</span>) <span class="comment">///</span></span><br><span class="line">    text(2 17 <span class="string">&quot;&#123;it:(16,2)&#125;&quot;</span>)  <span class="comment">///</span></span><br><span class="line">    text(3 15 <span class="string">&quot;&#123;it:(14,3)&#125;&quot;</span>) <span class="comment">///</span></span><br><span class="line">    text(2.5 6 <span class="string">&quot;&#123;it:S =½(14+16)*1 = 15 &#125;&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="LaTeX-绘制"><a href="#LaTeX-绘制" class="headerlink" title="LaTeX 绘制"></a>LaTeX 绘制</h3><p><img src="/2020/08/17/%E7%94%A8TikZ%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%B8%B8%E7%94%A8%E5%9B%BE/3.png" alt></p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;tikzpicture&#125;</span><span class="string">[domain=0:5,scale=0.4,fill opacity=0.6]</span></span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">dint</span><span class="string">&#123;20&#125;</span></span>     <span class="comment">%Y-intercept for DEMAND.</span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">dslp</span><span class="string">&#123;-2&#125;</span></span>     <span class="comment">%Slope for DEMAND.</span></span><br><span class="line"></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">demand</span><span class="string">&#123;\x,&#123;\dslp*\x+\dint&#125;</span></span>&#125;</span><br><span class="line"><span class="comment">% DEMAND</span></span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[color=blue]</span></span> (20,0) -- (0,10) node[right] &#123;<span class="formula">$D(p) = 20 - 2p$</span>&#125;;</span><br><span class="line"><span class="comment">% CS    </span></span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span> (0,3) -- (14,3);</span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span> (0,2) -- (16,2);</span><br><span class="line"><span class="tag">\<span class="name">fill</span></span> [fill=red] (0,3) -- (14,3) -- (16,2) -- (0,2);</span><br><span class="line"><span class="comment">% Draw axes</span></span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[-&gt;]</span></span> (0,0) -- (25,0) node[right] &#123;<span class="formula">$Q$</span>&#125;;</span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[-&gt;]</span></span> (0,0) -- (0,15) node[left] &#123;<span class="formula">$P$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;tikzpicture&#125;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="更多例子"><a href="#更多例子" class="headerlink" title="更多例子"></a>更多例子</h2><h2 id="需求价格弹性"><a href="#需求价格弹性" class="headerlink" title="需求价格弹性"></a>需求价格弹性</h2><p><img src="/2020/08/17/%E7%94%A8TikZ%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%B8%B8%E7%94%A8%E5%9B%BE/5.png" alt></p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% 需求价格弹性</span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;tikzpicture&#125;</span><span class="string">[scale=3]</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">% 坐标轴</span></span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [&lt;-&gt;,thick] (0,2) node (yaxis) [above] &#123;<span class="formula">$P$</span>&#125;</span><br><span class="line">    |- (3,0) node (xaxis) (above) &#123;<span class="formula">$Q$</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">% 绘制两条直线</span></span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[color=white]</span></span> (0,0) coordinate (a_1) -- (2,2) coordinate (a_2);</span><br><span class="line">    <span class="tag">\<span class="name">draw</span></span> (0,1.5) coordinate (b_1) -- (1.5,0) coordinate (b_2) node[below] &#123;<span class="formula">$Demand$</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">% 计算直线交点，并储存为c</span></span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (c) at (intersection of a_1--a_2 and b_1--b_2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">% 标示交点</span></span><br><span class="line">    <span class="tag">\<span class="name">fill</span></span> [red] (c) circle (1pt);</span><br><span class="line">    </span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[-&gt;,dashed]</span></span> (<span class="formula">$(c)+(0,0.15)$</span>) -- (<span class="formula">$(c)+(-.7,0.85)$</span>);</span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[-&gt;,dashed]</span></span> (<span class="formula">$(c)+(0.15,0)$</span>) -- (<span class="formula">$(c)+(0.85,-0.7)$</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="tag">\<span class="name">fill</span><span class="string">[blue]</span></span> (0.5,1.5) node &#123;Elastic&#125;;</span><br><span class="line">        <span class="tag">\<span class="name">fill</span><span class="string">[blue]</span></span> (1.6,0.5) node &#123;Inelastic&#125;;</span><br><span class="line">        </span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[-&gt;]</span></span> (1.5,1.5) node[label=above:Unitary Elastic] &#123;&#125; -- (<span class="formula">$(c)+(.1,.1)$</span>);</span><br><span class="line"></span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;tikzpicture&#125;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="征税"><a href="#征税" class="headerlink" title="征税"></a>征税</h3><p><img src="/2020/08/17/%E7%94%A8TikZ%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%B8%B8%E7%94%A8%E5%9B%BE/4.png" alt></p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%                         TikZ code: An excise tax</span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;tikzpicture&#125;</span><span class="string">[domain=0:5,scale=1,thick]</span></span></span><br><span class="line"><span class="tag">\<span class="name">usetikzlibrary</span><span class="string">&#123;calc&#125;</span></span>                                <span class="comment">%allows coordinate calculations.</span></span><br><span class="line"><span class="tag">\<span class="name">usetikzlibrary</span><span class="string">&#123;decorations.pathreplacing&#125;</span></span>           <span class="comment">%allows drawing curly braces.</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">% Define linear parameters for supply and demand</span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">dint</span><span class="string">&#123;4.5&#125;</span></span>      <span class="comment">%Y-intercept for DEMAND.</span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">dslp</span><span class="string">&#123;-0.5&#125;</span></span>     <span class="comment">%Slope for DEMAND.</span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">sint</span><span class="string">&#123;1.2&#125;</span></span>      <span class="comment">%Y-intercept for SUPPLY.</span></span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">sslp</span><span class="string">&#123;0.8&#125;</span></span>      <span class="comment">%Slope for SUPPLY.</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">tax</span><span class="string">&#123;1.5&#125;</span></span>       <span class="comment">%Excise (per-unit) tax</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">% Define Supply and Demand Lines as equations of parameters defined above.</span></span><br><span class="line">  <span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">demand</span><span class="string">&#123;\x,&#123;\dslp*\x+\dint&#125;</span></span>&#125;</span><br><span class="line">  <span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">supply</span><span class="string">&#123;\x,&#123;\sslp*\x+\sint&#125;</span></span>&#125;</span><br><span class="line">  <span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">demandtwo</span><span class="string">&#123;\x,&#123;\dslp*\x+\dint+\dsh&#125;</span></span>&#125;</span><br><span class="line">  <span class="tag">\<span class="name">def</span></span><span class="tag">\<span class="name">supplytwo</span><span class="string">&#123;\x,&#123;\sslp*\x+\sint+\ssh&#125;</span></span>&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">% Define coordinates.</span></span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (ints) at (&#123;(<span class="tag">\<span class="name">sint</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)&#125;,&#123;(<span class="tag">\<span class="name">sint</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)*<span class="tag">\<span class="name">sslp</span></span>+<span class="tag">\<span class="name">sint</span></span>&#125;);</span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (ep) at  (0,&#123;(<span class="tag">\<span class="name">sint</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)*<span class="tag">\<span class="name">sslp</span></span>+<span class="tag">\<span class="name">sint</span></span>&#125;);</span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (eq) at  (&#123;(<span class="tag">\<span class="name">sint</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)&#125;,0);</span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (dint) at (0,&#123;<span class="tag">\<span class="name">dint</span></span>&#125;);</span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (sint) at (0,&#123;<span class="tag">\<span class="name">sint</span></span>&#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (teq) at  (&#123;(<span class="tag">\<span class="name">sint</span></span>+<span class="tag">\<span class="name">tax</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)&#125;,0); <span class="comment">%quantity</span></span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (tep) at  (0,&#123;(<span class="tag">\<span class="name">sint</span></span>+<span class="tag">\<span class="name">tax</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)*<span class="tag">\<span class="name">sslp</span></span>+<span class="tag">\<span class="name">sint</span></span>+<span class="tag">\<span class="name">tax</span></span>&#125;); <span class="comment">%price</span></span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (tint) at  (&#123;(<span class="tag">\<span class="name">sint</span></span>+<span class="tag">\<span class="name">tax</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)&#125;,&#123;(<span class="tag">\<span class="name">sint</span></span>+<span class="tag">\<span class="name">tax</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)*<span class="tag">\<span class="name">sslp</span></span>+<span class="tag">\<span class="name">sint</span></span>+<span class="tag">\<span class="name">tax</span></span>&#125;); <span class="comment">%tax equilibrium</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (sep) at (0,&#123;<span class="tag">\<span class="name">sslp*</span></span>(<span class="tag">\<span class="name">sint</span></span>+<span class="tag">\<span class="name">tax</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)+<span class="tag">\<span class="name">sint</span></span>&#125;);</span><br><span class="line">    <span class="tag">\<span class="name">coordinate</span></span> (sen) at (&#123;(<span class="tag">\<span class="name">sint</span></span>+<span class="tag">\<span class="name">tax</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)&#125;,&#123;<span class="tag">\<span class="name">sslp*</span></span>(<span class="tag">\<span class="name">sint</span></span>+<span class="tag">\<span class="name">tax</span></span>-<span class="tag">\<span class="name">dint</span></span>)/(<span class="tag">\<span class="name">dslp</span></span>-<span class="tag">\<span class="name">sslp</span></span>)+<span class="tag">\<span class="name">sint</span></span>&#125;);   </span><br><span class="line"> </span><br><span class="line"><span class="comment">% DEMAND</span></span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[thick,color=blue]</span></span> plot (<span class="tag">\<span class="name">demand</span></span>) node[right] &#123;<span class="formula">$P(q) = -<span class="tag">\<span class="name">frac</span><span class="string">&#123;1&#125;</span><span class="string">&#123;2&#125;</span></span>q+<span class="tag">\<span class="name">frac</span><span class="string">&#123;9&#125;</span><span class="string">&#123;2&#125;</span></span>$</span>&#125;;</span><br><span class="line">     </span><br><span class="line"><span class="comment">% SUPPLY</span></span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[thick,color=purple]</span></span> plot (<span class="tag">\<span class="name">supply</span></span>) node[right] &#123;Supply&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">% Draw axes, and dotted equilibrium lines.</span></span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[-&gt;]</span></span> (0,0) -- (6.2,0) node[right] &#123;<span class="formula">$Q$</span>&#125;;</span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[-&gt;]</span></span> (0,0) -- (0,6.2) node[above] &#123;<span class="formula">$P$</span>&#125;;</span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[decorate,decoration=&#123;brace&#125;,thick]</span></span>  (<span class="formula">$(sep)+(-0.8,0)$</span>) -- (<span class="formula">$(tep)+(-0.8,0)$</span>) node[midway,below=-8pt,xshift=-18pt] &#123;tax&#125;;</span><br><span class="line">     </span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span> (tint) -- (teq) node[below] &#123;<span class="formula">$Q_T$</span>&#125;;                  </span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span> (tint) -- (tep) node[left] &#123;<span class="formula">$P_d$</span>&#125;;                       </span><br><span class="line">    <span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span> (sen) -- (sep) node[left] &#123;<span class="formula">$P_s$</span>&#125;;                        </span><br><span class="line">         </span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;tikzpicture&#125;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="短期单位成本曲线"><a href="#短期单位成本曲线" class="headerlink" title="短期单位成本曲线"></a>短期单位成本曲线</h3><p><img src="/2020/08/17/%E7%94%A8TikZ%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%B8%B8%E7%94%A8%E5%9B%BE/6.png" alt><br><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;figure&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;tikzpicture&#125;</span><span class="string">[scale=0.8]</span></span></span><br><span class="line"><span class="tag">\<span class="name">tiny</span></span></span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> (0,0) -- (8,0) node [below] &#123;Quantity, units&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> (0,-0.5) -- (0,5) node [above] &#123;Cost per unit, <span class="tag">\<span class="name">$</span></span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> (0.2,5) to [out=270,in=172] (2.6,0.4);</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> (2.6,0.4) to [out=350.5,in=178] (7,0.1);</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (7,0.5) &#123;<span class="formula">$AFC$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> (0.3,5) to [out=280,in=150] (2,2.1);</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> (2,2.1) to [out=330,in=200] (7,2);</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (7,2.3) &#123;<span class="formula">$ATC$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> (0,2) to [out=340,in=200] (7,1.8);</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (7,1.8) &#123;<span class="formula">$AVC$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> (0,2) to [out=315,in=240] (7,5);</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (7,5) &#123;<span class="formula">$MC$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;tikzpicture&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">caption</span><span class="string">&#123;Short-run unit cost curves&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;figure&#125;</span></span></span><br></pre></td></tr></table></figure></p>
<h3 id="斯勒茨基分解"><a href="#斯勒茨基分解" class="headerlink" title="斯勒茨基分解"></a>斯勒茨基分解</h3><p><img src="/2020/08/17/%E7%94%A8TikZ%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%B8%B8%E7%94%A8%E5%9B%BE/7.png" alt><br><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% Slutsky Decomposition</span></span><br><span class="line"><span class="tag">\<span class="name">usetikzlibrary</span><span class="string">&#123;decorations.pathreplacing&#125;</span></span> </span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;figure&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;tikzpicture&#125;</span><span class="string">[scale=1.2]</span></span></span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [thick] (0,0) -- (8,0);</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [thick] (0,0) -- (0,5);</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (8,0) &#123;<span class="formula">$x_1$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [above] at (0,5) &#123;<span class="formula">$x_2$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [thick] (1.7,4.2) to [out=310,in=160] (5.4,1.5);</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [thick] (0.6,4) to [out=295,in=165] (3.5,1);</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [thick] (1.4,3.2) to [out=290,in=155] (3.5,1.3);</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (6.5,0.9) &#123;<span class="formula">$C$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [thick] (0,4.6) -- (7.5,0);</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [thick] (0,4.6) -- (3.15,0);</span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span>(1.4,2.5)--(1.4,0);</span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span>(3.4,2.5)--(3.4,0);</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [thick] (0,3.4) -- (5.4,0);</span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[dashed]</span></span>(2.4,1.9)--(2.4,0);</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [above] at (2.4,2) &#123;<span class="formula">$x^B$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[fill]</span></span> (2.4,1.9) circle [radius =0.06];</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [left] at (1.3,2.5) &#123;<span class="formula">$x^A$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[fill]</span></span> (1.4,2.5) circle [radius =0.06];</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (3.2,3) &#123;<span class="formula">$x^C$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span><span class="string">[fill]</span></span> (3.4,2.5) circle [radius =0.06];</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (0.5,4.6) &#123;<span class="formula">$C$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (-0.1,4) &#123;<span class="formula">$A$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [left] at (2.9,0.2) &#123;<span class="formula">$A$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (4.3,0.2) &#123;<span class="formula">$B$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">node</span></span> [right] at (-0.1,3.1) &#123;<span class="formula">$B$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [decorate,decoration=&#123;brace,amplitude=4pt, mirror&#125;,xshift=0pt,yshift=-3pt]</span><br><span class="line">(1.4,0) -- (2.4,0) node [black,midway,yshift=-.5cm] &#123;<span class="tag">\<span class="name">footnotesize</span></span> <span class="formula">$SE_1$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">draw</span></span> [decorate,decoration=&#123;brace,amplitude=4pt, mirror&#125;,xshift=0pt,yshift=-3pt]</span><br><span class="line">(2.4,0) -- (3.4,0) node [black,midway,yshift=-.5cm] &#123;<span class="tag">\<span class="name">footnotesize</span></span> <span class="formula">$IE_1$</span>&#125;;</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;tikzpicture&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">caption</span><span class="string">&#123;Slutsky decomposition&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;figure&#125;</span></span></span><br></pre></td></tr></table></figure></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="http://static.latexstudio.net/wp-content/uploads/2016/06/tikzforeconomists-110619150244-phpapp01.pdf">http://static.latexstudio.net/wp-content/uploads/2016/06/tikzforeconomists-110619150244-phpapp01.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://sites.google.com/site/kochiuyu/Tikz">https://sites.google.com/site/kochiuyu/Tikz</a></p>
<p><a target="_blank" rel="noopener" href="https://riguz.com/tex/latex_tikz/">https://riguz.com/tex/latex_tikz/</a></p>
<p><a target="_blank" rel="noopener" href="http://www.texample.net/tikz/examples/">http://www.texample.net/tikz/examples/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/Stata%E7%88%AC%E5%8F%96%E8%A1%8C%E4%B8%9A%E6%99%AF%E6%B0%94%E6%8C%87%E6%95%B0%E5%B9%B6%E5%8F%AF%E8%A7%86%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/Stata%E7%88%AC%E5%8F%96%E8%A1%8C%E4%B8%9A%E6%99%AF%E6%B0%94%E6%8C%87%E6%95%B0%E5%B9%B6%E5%8F%AF%E8%A7%86%E5%8C%96/" class="post-title-link" itemprop="url">Stata爬取行业景气指数并可视化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 13:06:38 / Modified: 13:15:48" itemprop="dateCreated datePublished" datetime="2020-08-17T13:06:38+08:00">2020-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Stata/" itemprop="url" rel="index"><span itemprop="name">Stata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前看见有文章在稳健性检验部分，用企业景气指数和企业家信心指数代替 GDP 增长率作为宏观经济层面投资机会的替代变量（李凤羽和杨墨竹，2015）。所以想收集来看看，在网上找到<a target="_blank" rel="noopener" href="http://data.ce.cn/">中国经济网行情数据中心</a>公布了数据，所以用 Stata 爬了下，好久没有用 Stata 干这种活儿，也当是练练手。</p>
<h1 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h1><p>网页是 POST 请求，所以调用 <code>curl</code> 进行爬取。爬虫的思路也不难，找到翻页信息后批量请求，然后对字符串进行清理，最终整理成规范的数据。注意，如果想复刻我的代码，注意先下载 <code>curl</code>，安装<code>nrow</code>, <code>openall</code> 两个外部命令。 </p>
<h1 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h1><h2 id="爬取数据"><a href="#爬取数据" class="headerlink" title="爬取数据"></a>爬取数据</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">* 获取页面截止页码</span></span><br><span class="line">!curl -<span class="keyword">H</span> <span class="string">&quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&quot;</span> -<span class="keyword">d</span> <span class="string">&quot;curPage=1&amp;numPerPage=15&amp;rand=1587711227852&quot;</span> -o confidenceIndex.txt <span class="string">&quot;http://data.ce.cn/servlet/macrography/MacrographyAction?function=Condition&quot;</span></span><br><span class="line"><span class="keyword">infix</span> strL v 1-20000 using confidenceIndex.txt,<span class="keyword">clear</span></span><br><span class="line"><span class="keyword">keep</span> <span class="keyword">if</span> <span class="built_in">index</span>(v, <span class="string">&quot;pagecount&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> ustrregexm(v,<span class="string">&quot;(\d+)&quot;</span>) <span class="keyword">local</span> a = ustrregexs(1)</span><br><span class="line"></span><br><span class="line"><span class="comment">* 爬取并存储单页数据</span></span><br><span class="line"><span class="keyword">forvalues</span> p = 1/<span class="symbol">`a&#x27;</span>&#123; </span><br><span class="line">    <span class="keyword">qui</span>&#123;</span><br><span class="line">    !curl -<span class="keyword">H</span> <span class="string">&quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&quot;</span> -<span class="keyword">d</span> <span class="string">&quot;curPage=`p&#x27;&amp;numPerPage=15&amp;rand=1530620756348&quot;</span> -o confidenceIndex.txt <span class="string">&quot;http://data.ce.cn/servlet/macrography/MacrographyAction?function=Condition&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    * 处理字符串</span></span><br><span class="line">    <span class="keyword">infix</span> strL v 1-200000 using confidenceIndex.txt,<span class="keyword">clear</span></span><br><span class="line">    <span class="keyword">keep</span> <span class="keyword">if</span> <span class="built_in">index</span>(v,<span class="string">`&quot;&lt;td &gt;&quot;&#x27;</span>) | <span class="comment">///</span></span><br><span class="line">        <span class="built_in">index</span>(v,<span class="string">`&quot;&lt;td style=&quot;border-left:none;&quot;&gt;&quot;&#x27;</span>) | <span class="comment">///</span></span><br><span class="line">        <span class="built_in">index</span>(v,<span class="string">`&quot;&lt;td class=&quot;tsblue&quot; style=&quot;border-left:0 none;&quot;&gt;&quot;&#x27;</span>) </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">replace</span> v = ustrregexra(v,<span class="string">&quot;&lt;(.*?)td(.*?)&gt;&quot;</span>,<span class="string">&quot;&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">    * 调整数据格式</span></span><br><span class="line">        <span class="keyword">forvalues</span> i = 0/7&#123;</span><br><span class="line">            <span class="keyword">gen</span> temp<span class="symbol">`i&#x27;</span> = v <span class="keyword">if</span> <span class="built_in">mod</span>(_n, 7) == <span class="symbol">`i&#x27;</span></span><br><span class="line">            <span class="keyword">preserve</span></span><br><span class="line">            <span class="keyword">keep</span> temp<span class="symbol">`i&#x27;</span></span><br><span class="line">            <span class="keyword">drop</span> <span class="keyword">if</span> temp<span class="symbol">`i&#x27;</span> == <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">save</span> <span class="string">&quot;.\temp\temp`i&#x27;.dta&quot;</span>, <span class="keyword">replace</span></span><br><span class="line">            <span class="keyword">restore</span></span><br><span class="line">        &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">use</span> <span class="string">&quot;.\temp\temp0.dta&quot;</span>, <span class="keyword">clear</span></span><br><span class="line">    <span class="keyword">forvalues</span> i = 1/6&#123;</span><br><span class="line">        <span class="keyword">merge</span> 1:1 _n using <span class="string">&quot;.\temp\temp`i&#x27;.dta&quot;</span>, nogen    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    nrow</span><br><span class="line">    <span class="keyword">save</span> <span class="string">&quot;.\result\result`p&#x27;.dta&quot;</span>, <span class="keyword">replace</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">dis</span> <span class="keyword">in</span> result <span class="string">&quot;第 -`p&#x27;- 页爬取完毕!&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="数据整理"><a href="#数据整理" class="headerlink" title="数据整理"></a>数据整理</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">openall, directory(<span class="string">&quot;./result/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">* 日期变量</span></span><br><span class="line"><span class="keyword">gen</span> q = usubstr(月份,1,4) + <span class="string">&quot;q&quot;</span> + usubstr(月份,6,1)</span><br><span class="line"><span class="keyword">g</span> 季度=<span class="built_in">quarterly</span>(q,<span class="string">&quot;YQ&quot;</span>)</span><br><span class="line"><span class="keyword">format</span> 季度 %tq</span><br><span class="line"><span class="keyword">drop</span> q</span><br><span class="line"></span><br><span class="line"><span class="comment">* 数据类型</span></span><br><span class="line"><span class="keyword">order</span> 月份 数据类型 总体 工业 建筑业 房地产业 住宿和餐饮业</span><br><span class="line"><span class="keyword">destring</span> 总体-住宿和餐饮业, <span class="keyword">replace</span></span><br><span class="line"><span class="keyword">encode</span> 数据类型, <span class="keyword">gen</span>(类型)</span><br><span class="line"></span><br><span class="line"><span class="comment">* 定义panel</span></span><br><span class="line"><span class="keyword">xtset</span> 季度 类型</span><br><span class="line"><span class="keyword">save</span> <span class="string">&quot;企业景气指数与企业家信心指数.dta&quot;</span>, <span class="keyword">replace</span></span><br></pre></td></tr></table></figure>
<h1 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h1><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="string">&quot;企业景气指数与企业家信心指数.dta&quot;</span>, <span class="keyword">clear</span></span><br><span class="line"><span class="keyword">tw</span> (<span class="keyword">line</span> 工业 季度 <span class="keyword">if</span> 类型 == 1) <span class="comment">///</span></span><br><span class="line">   (<span class="keyword">line</span> 工业 季度 <span class="keyword">if</span> 类型 == 2), <span class="comment">///</span></span><br><span class="line">   scheme(qleanmono) <span class="comment">///</span></span><br><span class="line">   legend(pos(8) <span class="keyword">label</span>(1 <span class="string">&quot;企业家信心指数&quot;</span>) <span class="keyword">label</span>(2 <span class="string">&quot;企业景气指数&quot;</span>)) <span class="comment">///</span></span><br><span class="line">   title(<span class="string">&quot;中国企业景气指数与企业家信心指数：工业&quot;</span>) <span class="comment">///</span></span><br><span class="line">   subtitle(<span class="string">&quot;（时间：1999年第1季度-2019年第4季度）&quot;</span>) <span class="comment">///</span></span><br><span class="line">   ytitle(<span class="string">&quot;总体指数&quot;</span>) <span class="comment">///</span></span><br><span class="line">   <span class="keyword">note</span>(<span class="string">&quot;数据来源：中国经济网（http://data.ce.cn）&quot;</span>)</span><br><span class="line"><span class="keyword">graph</span> export <span class="string">&quot;中国企业景气指数与企业家信心指数_工业.png&quot;</span>, <span class="keyword">replace</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/Stata%E7%88%AC%E5%8F%96%E8%A1%8C%E4%B8%9A%E6%99%AF%E6%B0%94%E6%8C%87%E6%95%B0%E5%B9%B6%E5%8F%AF%E8%A7%86%E5%8C%96/中国企业景气指数与企业家信心指数_工业.png" alt></p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>中国经济网行情数据中心还有一些其他股票、基金、宏观经济和金融等数据，数据源质量还比较好。</p>
<p><img src="/2020/08/17/Stata%E7%88%AC%E5%8F%96%E8%A1%8C%E4%B8%9A%E6%99%AF%E6%B0%94%E6%8C%87%E6%95%B0%E5%B9%B6%E5%8F%AF%E8%A7%86%E5%8C%96/中国经济网行情数据中心.png" alt></p>
<p>其实有点想以这个网站数据源为基础，写个命令方便的获取上面的数据，但是一是现在还有其他的事情要忙活，做这件事的激励似乎不太够；二是写出来之后还需要精力维护，就先搁置吧。有兴趣的朋友可以尝试一下，我在上面这里也爬过房价指数和其他的数据，数据页面的网页结构是差不多的，实现起来应该也还好。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/Stata%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%B8%AD%E5%8D%97%E8%B4%A2%E5%A4%A72019%E7%A0%94%E6%8B%9F%E5%BD%95%E5%8F%96%E7%A9%B6%E7%94%9F%E5%BD%95%E6%8A%A5%E5%91%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/Stata%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%B8%AD%E5%8D%97%E8%B4%A2%E5%A4%A72019%E7%A0%94%E6%8B%9F%E5%BD%95%E5%8F%96%E7%A9%B6%E7%94%9F%E5%BD%95%E6%8A%A5%E5%91%8A/" class="post-title-link" itemprop="url">Stata自动生成中南财大2019研拟录取究生录报告</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 13:01:52 / Modified: 13:16:14" itemprop="dateCreated datePublished" datetime="2020-08-17T13:01:52+08:00">2020-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/Stata/" itemprop="url" rel="index"><span itemprop="name">Stata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>又是一年考研季，今天有朋友问我去年的学校录取情况，因为一直没咋关注过这个，一下还真不知道是啥情况，就去官网找了下名单。但是官网给的名单是 PDF 格式，不方便拿来做统计分析，所以就用 Stata 顺手做了一些简单的分析工作，觉得这也为需要提供重复性报告的工作提供一种思路。具体来说，主要包括如下技术要点：</p>
<ul>
<li>使用 Stata16 调用 Python 下载PDF，转化为 Excel 表格；</li>
<li>使用 Stata 爬取学校官网的学院名单，整理和生成学院代码；</li>
<li>使用 Stata 中的 <code>putdocx</code> 命令制作自动化分析报告。</li>
</ul>
<p>在开始之前，要注意使用的是 Stata 16，而且需要先安装 Python 的 <code>pdfplumber</code> 库；Stata 的 <code>tbl2putdocx.ado</code> 文件，这是来自 <a target="_blank" rel="noopener" href="https://www.statalist.org/forums/forum/general-stata-discussion/general/1398211-putdocx-command">statalist</a> 解决 <code>putdocx</code> 命令中输出 <code>tab</code> 结果的一个解决方案。在公众号后台回复【zuledocx】可以获取我整理好的 <code>ado</code> 文件，之后放入 Stata 所在路径的 <code>./ado/plus/t</code> 文件夹中即可。</p>
<h1 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h1><h2 id="下载和转换-PDF-文件"><a href="#下载和转换-PDF-文件" class="headerlink" title="下载和转换 PDF 文件"></a>下载和转换 PDF 文件</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">python:</span><br><span class="line">import requests</span><br><span class="line">import pdfplumber</span><br><span class="line">from openpyxl import Workbook</span><br><span class="line"></span><br><span class="line"># 下载 PDF 文件</span><br><span class="line">pdf = &#x27;http:<span class="comment">//yzb.zuel.edu.cn/_upload/article/files/70/72/9a65178a4aacb5ae64daa5950b83/cf27a493-b596-4059-9c7c-ba76ba73237f.pdf&#x27;</span></span><br><span class="line">r = requests.<span class="built_in">get</span>(pdf, stream=True)</span><br><span class="line">with <span class="keyword">open</span>(<span class="string">&quot;2019年硕士研究生拟录取名单公示.pdf&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> pdf:</span><br><span class="line">    <span class="keyword">for</span> content <span class="keyword">in</span> r:</span><br><span class="line">            pdf.write(content)</span><br><span class="line"></span><br><span class="line"># 提取并写入 Excel</span><br><span class="line">wb = Workbook()</span><br><span class="line">ws = wb.active</span><br><span class="line">with pdfplumber.<span class="keyword">open</span>(<span class="string">&quot;2019年硕士研究生拟录取名单公示.pdf&quot;</span>) <span class="keyword">as</span> pdf:</span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> pdf.pages:</span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">table</span> <span class="keyword">in</span> page.extract_tables():</span><br><span class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> <span class="keyword">table</span>:</span><br><span class="line">                ws.<span class="keyword">append</span>(row)</span><br><span class="line">wb.<span class="keyword">save</span>(<span class="string">&quot;./data/2019年硕士研究生拟录取名单公示.xlsx&quot;</span>)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>下载和转换之后的数据如下：</p>
<p><img src="/2020/08/17/Stata%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%B8%AD%E5%8D%97%E8%B4%A2%E5%A4%A72019%E7%A0%94%E6%8B%9F%E5%BD%95%E5%8F%96%E7%A9%B6%E7%94%9F%E5%BD%95%E6%8A%A5%E5%91%8A/1.png" alt></p>
<h2 id="爬取官网学院名称"><a href="#爬取官网学院名称" class="headerlink" title="爬取官网学院名称"></a>爬取官网学院名称</h2><p><img src="/2020/08/17/Stata%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%B8%AD%E5%8D%97%E8%B4%A2%E5%A4%A72019%E7%A0%94%E6%8B%9F%E5%BD%95%E5%8F%96%E7%A9%B6%E7%94%9F%E5%BD%95%E6%8A%A5%E5%91%8A/3.png" alt></p>
<p>因为公布的名单中学院是用三位数的代码，所以需要去官网弄到学院名称进行匹配，这样才能知道拟录取学生所对应的学院。在制作学院代码过程中，一是需要剔除不招硕士的学院，二是要和名单中的专业进行比照，确保拟录取专业和学院相对应。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">copy</span> <span class="string">&quot;http://www.zuel.edu.cn/schools/&quot;</span> <span class="string">&quot;./data/schools.txt&quot;</span>, <span class="keyword">replace</span></span><br><span class="line"><span class="keyword">infix</span> strL v 1-200000 using <span class="string">&quot;./data/schools.txt&quot;</span>,<span class="keyword">clear</span></span><br><span class="line"><span class="keyword">keep</span> <span class="keyword">if</span> <span class="built_in">index</span>(v,<span class="string">&quot;学院&quot;</span>)</span><br><span class="line"><span class="keyword">gen</span> 学院 = ustrregexs(2) <span class="keyword">if</span> ustrregexm(v,<span class="string">`&quot;&lt;option value=&quot;(.*?)&quot; &gt;(.*?)&lt;/option&gt;&quot;&#x27;</span>)</span><br><span class="line"><span class="keyword">keep</span> 学院</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">if</span> 学院 == <span class="string">&quot;&quot;</span> </span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">if</span> _n &gt;= 15 &amp; _n != 16 &amp; _n != 17</span><br><span class="line"><span class="keyword">gen</span> 学院代码 = 100 + _n</span><br><span class="line"><span class="keyword">tostring</span> 学院代码, <span class="keyword">replace</span></span><br><span class="line"><span class="keyword">replace</span> 学院 = <span class="string">&quot;&quot;</span> <span class="keyword">if</span> 学院 == <span class="string">&quot;继续教育学院&quot;</span></span><br><span class="line"><span class="keyword">replace</span> 学院 = <span class="string">&quot;法律硕士教育中心&quot;</span> <span class="keyword">if</span> 学院 == <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">replace</span> 学院代码 = <span class="string">&quot;117&quot;</span> <span class="keyword">if</span> 学院代码 == <span class="string">&quot;116&quot;</span></span><br><span class="line"><span class="keyword">save</span> <span class="string">&quot;./data/学院代码.dta&quot;</span>, <span class="keyword">replace</span></span><br></pre></td></tr></table></figure>
<h2 id="数据清理"><a href="#数据清理" class="headerlink" title="数据清理"></a>数据清理</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import excel using <span class="string">&quot;./data/2019年硕士研究生拟录取名单公示.xlsx&quot;</span>,firstrow <span class="keyword">clear</span></span><br><span class="line"></span><br><span class="line"><span class="comment">* 异常值</span></span><br><span class="line"><span class="keyword">destring</span> 政治-总成绩, <span class="keyword">replace</span></span><br><span class="line">misstable <span class="keyword">summarize</span> _all <span class="comment">// 3条异常</span></span><br><span class="line"><span class="keyword">replace</span> 专项计划 = <span class="string">&quot;少数民族高层次骨干人才计划&quot;</span> <span class="keyword">if</span> 专项计划 == <span class="string">&quot;少数民族高层次骨&quot;</span></span><br><span class="line"><span class="keyword">replace</span> 拟录取专业 = <span class="string">&quot;金融统计、保险精算与风险管理&quot;</span> <span class="keyword">if</span> 拟录取专业 == <span class="string">&quot;金融统计、保险精算与风险&quot;</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">if</span> 考生编号 == <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">* 去除换行符</span></span><br><span class="line"><span class="keyword">replace</span> 拟录取专业 = usubinstr(拟录取专业,<span class="string">&quot; &quot;</span>,<span class="string">&quot;&quot;</span>,.)</span><br><span class="line"><span class="keyword">replace</span> 拟录取专业 = ustrregexrf(拟录取专业,<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">* 匹配学院代码</span></span><br><span class="line"><span class="keyword">merge</span> <span class="keyword">m</span>:1 学院代码 using <span class="string">&quot;./data/学院代码.dta&quot;</span>, nogen</span><br><span class="line"><span class="keyword">order</span> 学院* 拟录取专业</span><br><span class="line"><span class="keyword">compress</span></span><br><span class="line"><span class="keyword">save</span> <span class="string">&quot;./data/2019拟录取_不含推免_清理后.dta&quot;</span>, <span class="keyword">replace</span></span><br></pre></td></tr></table></figure>
<h2 id="生成报告"><a href="#生成报告" class="headerlink" title="生成报告"></a>生成报告</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="string">&quot;./data/2019拟录取_不含推免_清理后.dta&quot;</span>, <span class="keyword">clear</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 创建文档 */</span></span><br><span class="line"><span class="keyword">capture</span> putdocx <span class="keyword">clear</span></span><br><span class="line">putdocx begin</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 标题  */</span></span><br><span class="line">putdocx paragraph, style(Title) halign(center)</span><br><span class="line">putdocx text (<span class="string">&quot;中南财经政法大学2019拟录硕士取研究生分析报告&quot;</span>), <span class="comment">///</span></span><br><span class="line">    font(<span class="string">&quot;宋体&quot;</span>,16,black) bold linebreak</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 小标题 */</span></span><br><span class="line">putdocx paragraph, style(Title)</span><br><span class="line">putdocx text (<span class="string">&quot;一、前言&quot;</span>), <span class="comment">///</span></span><br><span class="line">    font(<span class="string">&quot;黑体&quot;</span>,14,black)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 文本块 */</span></span><br><span class="line">putdocx textblock begin</span><br><span class="line">        本报告使用的数据来自中南财经政法大学研究生招生网公布的《2019年硕士研究生拟录取名单公示》。本文处理流程大致为：首先使用Stata16调用Python完成PDF下载和转化，随后去官网爬取和匹配学院代码、清理异常值等整理工作，</span><br><span class="line">最后对拟录取人数的学院、专业和录取类型进行了简单的分析。要说明的是，研招网公布的这份名单不包括推免生，所以本报告分析对象主要是统考生，另外，本分析旨在学习Stata数据整理和文档自动化，为解决需要提供重复性报告的工作提供一种思路。</span><br><span class="line">如果分析过程中的数据与实际情况存在差别，请以官网为准。</span><br><span class="line">putdocx textblock end</span><br><span class="line"></span><br><span class="line">putdocx paragraph, style(Title)</span><br><span class="line">putdocx text (<span class="string">&quot;二、总体分析&quot;</span>), <span class="comment">///</span></span><br><span class="line">    font(<span class="string">&quot;黑体&quot;</span>,14,black)</span><br><span class="line"></span><br><span class="line"><span class="comment">**********************************</span></span><br><span class="line"><span class="keyword">des</span>,s</span><br><span class="line"><span class="keyword">local</span> <span class="keyword">N</span> = <span class="built_in">r</span>(<span class="keyword">N</span>)</span><br><span class="line"><span class="keyword">count</span> <span class="keyword">if</span> 学习方式 == <span class="string">&quot;全日制&quot;</span></span><br><span class="line"><span class="keyword">local</span> allday = <span class="built_in">r</span>(<span class="keyword">N</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">count</span> <span class="keyword">if</span> 备注 == <span class="string">&quot;调剂&quot;</span></span><br><span class="line"><span class="keyword">local</span> change = <span class="built_in">r</span>(<span class="keyword">N</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">count</span> <span class="keyword">if</span> 拟录取类别 == <span class="string">&quot;定向&quot;</span></span><br><span class="line"><span class="keyword">local</span> fixed = <span class="built_in">r</span>(<span class="keyword">N</span>)</span><br><span class="line"><span class="comment">************************************</span></span><br><span class="line"></span><br><span class="line">putdocx textblock begin</span><br><span class="line">        据网站公布的名单，2019年拟录取的硕士研究生（不含推免）共 &lt;&lt;dd_docx_display:<span class="symbol">`N&#x27;</span>&gt;&gt; 名。其中，有 &lt;&lt;dd_docx_display:<span class="symbol">`change&#x27;</span>&gt;&gt; 名是调剂而来。在学习方式方面，全日制 &lt;&lt;dd_docx_display:<span class="symbol">`allday&#x27;</span>&gt;&gt; 名，非全日制为 &lt;&lt;dd_docx_display:<span class="symbol">`N&#x27;</span>-<span class="symbol">`allday&#x27;</span>&gt;&gt; 名。在拟录取类别</span><br><span class="line">方面，非定向为 &lt;&lt;dd_docx_display:<span class="symbol">`fixed&#x27;</span>&gt;&gt; 名，定向为 &lt;&lt;dd_docx_display:<span class="symbol">`N&#x27;</span>-<span class="symbol">`fixed&#x27;</span>&gt;&gt; 名。</span><br><span class="line">putdocx textblock end</span><br><span class="line"></span><br><span class="line">putdocx paragraph</span><br><span class="line">putdocx text (<span class="string">&quot;拟录取人数在各学院的分布大致如下：&quot;</span>)</span><br><span class="line">tbl2putdocx 学院</span><br><span class="line"></span><br><span class="line">putdocx paragraph</span><br><span class="line">putdocx text (<span class="string">&quot;各专业拟录取人数如下：&quot;</span>)</span><br><span class="line">tbl2putdocx 拟录取专业</span><br><span class="line"></span><br><span class="line">putdocx <span class="keyword">save</span> <span class="string">&quot;./result/中南财经政法大学2019硕士拟录取研究生分析报告.docx&quot;</span>, <span class="keyword">replace</span></span><br></pre></td></tr></table></figure>
<p>最终的效果如下：</p>
<p><img src="/2020/08/17/Stata%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%B8%AD%E5%8D%97%E8%B4%A2%E5%A4%A72019%E7%A0%94%E6%8B%9F%E5%BD%95%E5%8F%96%E7%A9%B6%E7%94%9F%E5%BD%95%E6%8A%A5%E5%91%8A/文档结果.png" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/Stata%E6%95%B4%E7%90%86%E8%AF%81%E7%9B%91%E4%BC%9A%E4%B8%8A%E5%B8%82%E5%85%AC%E5%8F%B8%E8%A1%8C%E4%B8%9A%E5%88%86%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/Stata%E6%95%B4%E7%90%86%E8%AF%81%E7%9B%91%E4%BC%9A%E4%B8%8A%E5%B8%82%E5%85%AC%E5%8F%B8%E8%A1%8C%E4%B8%9A%E5%88%86%E7%B1%BB/" class="post-title-link" itemprop="url">Stata整理证监会上市公司行业分类</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 12:58:38 / Modified: 13:16:00" itemprop="dateCreated datePublished" datetime="2020-08-17T12:58:38+08:00">2020-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Stata/" itemprop="url" rel="index"><span itemprop="name">Stata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="问题的提出"><a href="#问题的提出" class="headerlink" title="问题的提出"></a>问题的提出</h1><p>证监会网站会公布每季度<a target="_blank" rel="noopener" href="http://www.csrc.gov.cn/pub/newsite/scb/ssgshyfljg/">上市公司最新行业分类结果</a>，但提供的是 PDF 版本，难以直接用作数据匹配。刚正好需要这份数据，所以用 Stata 来下载、转换和整理数据。</p>
<h1 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h1><ol>
<li>使用 Stata16 调用 Python 完成文件的下载、PDF 转换成 Excel 文件。</li>
<li>使用 Stata 进行数据整理，涉及观测值去重、填充和利用正则表达式生成新变量等内容。</li>
</ol>
<h1 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h1><h2 id="调用-Python-下载和提取文件"><a href="#调用-Python-下载和提取文件" class="headerlink" title="调用 Python 下载和提取文件"></a>调用 Python 下载和提取文件</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">python:</span><br><span class="line">import requests</span><br><span class="line">import pdfplumber</span><br><span class="line">from openpyxl import Workbook</span><br><span class="line"></span><br><span class="line"># 下载 PDF 文件</span><br><span class="line">pdf_2019q4 = &#x27;http:<span class="comment">//www.csrc.gov.cn/pub/newsite/scb/ssgshyfljg/202001/W020200110325952653089.pdf&#x27;</span></span><br><span class="line">r = requests.<span class="built_in">get</span>(pdf_2019q4, stream=True)</span><br><span class="line">with <span class="keyword">open</span>(<span class="string">&quot;证监会2019年4季度上市公司行业分类结果.pdf&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> pdf:</span><br><span class="line">    <span class="keyword">for</span> content <span class="keyword">in</span> r:</span><br><span class="line">            pdf.write(content)</span><br><span class="line"></span><br><span class="line"># 提取并写入Excel</span><br><span class="line">wb = Workbook()</span><br><span class="line">ws = wb.active</span><br><span class="line">with pdfplumber.<span class="keyword">open</span>(<span class="string">&quot;证监会2019年4季度上市公司行业分类结果.pdf&quot;</span>) <span class="keyword">as</span> pdf:</span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> pdf.pages:</span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">table</span> <span class="keyword">in</span> page.extract_tables():</span><br><span class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> <span class="keyword">table</span>:</span><br><span class="line">                ws.<span class="keyword">append</span>(row)</span><br><span class="line">wb.<span class="keyword">save</span>(<span class="string">&quot;证监会2019年4季度上市公司行业分类结果.xlsx&quot;</span>)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="整理数据"><a href="#整理数据" class="headerlink" title="整理数据"></a>整理数据</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import excel using <span class="string">&quot;证监会2019年4季度上市公司行业分类结果.xlsx&quot;</span>, <span class="keyword">clear</span></span><br><span class="line"><span class="keyword">duplicates</span> <span class="keyword">drop</span></span><br><span class="line"></span><br><span class="line"><span class="comment">* ssc install nrow, replace</span></span><br><span class="line"><span class="comment">* ssc install carryforward, replace</span></span><br><span class="line">nrow</span><br><span class="line">carryforward _all,<span class="keyword">replace</span></span><br><span class="line"><span class="keyword">gen</span> 行业门类与大类 = ustrregexs(0) + 行业大类代码 <span class="keyword">if</span> ustrregexm(门类名称及代码,<span class="string">&quot;[A-Z]&quot;</span>) == 1</span><br><span class="line"><span class="keyword">save</span> <span class="string">&quot;201914上市公司行业分类.dta&quot;</span>, <span class="keyword">replace</span></span><br></pre></td></tr></table></figure>
<h1 id="最终结果"><a href="#最终结果" class="headerlink" title="最终结果"></a>最终结果</h1><p><img src="/2020/08/17/Stata%E6%95%B4%E7%90%86%E8%AF%81%E7%9B%91%E4%BC%9A%E4%B8%8A%E5%B8%82%E5%85%AC%E5%8F%B8%E8%A1%8C%E4%B8%9A%E5%88%86%E7%B1%BB/result.png" alt></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/%E6%9D%82%E4%B9%B1%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%88%86%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/%E6%9D%82%E4%B9%B1%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%88%86%E7%B1%BB/" class="post-title-link" itemprop="url">杂乱文件自动分类</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 12:55:20 / Modified: 13:15:18" itemprop="dateCreated datePublished" datetime="2020-08-17T12:55:20+08:00">2020-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/Stata/" itemprop="url" rel="index"><span itemprop="name">Stata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="杂乱文件自动分类"><a href="#杂乱文件自动分类" class="headerlink" title="杂乱文件自动分类"></a>杂乱文件自动分类</h1><p>在数据清理或者实证过程中，常常会有大量的文档、表格和图片等。疏于整理的话，文件夹中文件就会五花八门。下图是不是太过真实？</p>
<p><img src="/2020/08/17/%E6%9D%82%E4%B9%B1%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%88%86%E7%B1%BB/1-文件夹实况.png" alt></p>
<p>如果想按照文件类型将文件归类，你会怎么做呢？<code>Ctrl+X</code> 和 <code>Ctrl+V</code>？听起来好费眼睛啊。有没有一种快捷的方法让文件自动分类呢？ <code>Talk is cheap, show me your code</code> 。本文的内容如下：</p>
<ul>
<li>先分别使用 Stata 和 Python 编程来解决问题；</li>
<li>之后，推荐一款 Windows 平台下的文件管理神器 DropIt 。</li>
</ul>
<h1 id="分析问题"><a href="#分析问题" class="headerlink" title="分析问题"></a>分析问题</h1><p>在开始写代码之前，先来分析一下这个问题：如果以该文件后缀命令的文件夹存在，则移动进去；如果不存在，先新建该文件后缀的文件夹，再将文件移动进去。实现思路可以用如下流程图描述：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">st&#x3D;&gt;start: 开始</span><br><span class="line">exist?&#x3D;&gt;condition: 目标文件夹存在吗？</span><br><span class="line">createfolder&#x3D;&gt;operation: 新建该后缀文件夹</span><br><span class="line">move&#x3D;&gt;operation: 移动到目标文件夹</span><br><span class="line">e&#x3D;&gt;end: 结束</span><br><span class="line"></span><br><span class="line">st-&gt;exist?</span><br><span class="line">exist?(no)-&gt;createfolder-&gt;move</span><br><span class="line">exist?(yes)-&gt;move-&gt;e</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/%E6%9D%82%E4%B9%B1%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%88%86%E7%B1%BB/1-2-流程图.png" alt></p>
<h2 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h2><h2 id="Stata-实现"><a href="#Stata-实现" class="headerlink" title="Stata 实现"></a>Stata 实现</h2><p>使用 Stata 的思路是，通过两次遍历，首先遍历文件名，提取后缀，创建文件夹；之后再通过文件后缀判断，将文件移动到相应的文件夹。实现代码如下：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">&quot;..\files&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">* Create folders</span></span><br><span class="line">fs</span><br><span class="line"><span class="keyword">foreach</span> <span class="keyword">file</span> <span class="keyword">in</span> `<span class="built_in">r</span>(files)&#x27;&#123;</span><br><span class="line">    <span class="keyword">local</span> folder =  ustrregexrf(<span class="string">&quot;`file&#x27;&quot;</span>,<span class="string">&quot;^.*\.&quot;</span>,<span class="string">&quot;&quot;</span>,.)</span><br><span class="line">    <span class="keyword">cap</span> <span class="keyword">mkdir</span> <span class="string">&quot;`folder&#x27;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">* Move Files</span></span><br><span class="line">fs</span><br><span class="line"><span class="keyword">foreach</span> <span class="keyword">file</span> <span class="keyword">in</span> `<span class="built_in">r</span>(files)&#x27;&#123;</span><br><span class="line">    <span class="keyword">local</span> <span class="keyword">type</span> =  ustrregexrf(<span class="string">&quot;`file&#x27;&quot;</span>,<span class="string">&quot;^.*\.&quot;</span>,<span class="string">&quot;&quot;</span>,.)</span><br><span class="line">    <span class="keyword">if</span> ustrregexrf(<span class="string">&quot;`file&#x27;&quot;</span>,<span class="string">&quot;^.*\.&quot;</span>,<span class="string">&quot;&quot;</span>,.) == <span class="string">&quot;`type&#x27;&quot;</span>&#123;</span><br><span class="line">        !<span class="keyword">move</span> <span class="string">&quot;`file&#x27;&quot;</span> <span class="string">&quot;`type&#x27;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Python-实现"><a href="#Python-实现" class="headerlink" title="Python 实现"></a>Python 实现</h2><p>使用 <code>os</code> 库读取后缀、判断文件夹是否存在，使用 <code>shutil</code> 库来操作文件。实现代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">os.getcwd()</span><br><span class="line">os.listdir()</span><br><span class="line">os.chdir(<span class="string">&quot;../files&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> files:</span><br><span class="line">    folder = f.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(folder):</span><br><span class="line">        os.mkdir(folder)</span><br><span class="line">        shutil.move(f, folder)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        shutil.move(f, folder)</span><br></pre></td></tr></table></figure>
<h2 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h2><p><img src="/2020/08/17/%E6%9D%82%E4%B9%B1%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%88%86%E7%B1%BB/2-实现效果.gif" alt></p>
<p>以 Stata 运行过程为例，看看实现效果。怎么样？是不是看起来比较“酷炫”？</p>
<h1 id="DropIt：文件自动分类管理工具"><a href="#DropIt：文件自动分类管理工具" class="headerlink" title="DropIt：文件自动分类管理工具"></a>DropIt：文件自动分类管理工具</h1><p><img src="/2020/08/17/%E6%9D%82%E4%B9%B1%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%88%86%E7%B1%BB/3-how_to_use_dropit.png" alt></p>
<p> DropIt 是一款源于国外的开源、免费软件，目前仅支持 Window 系统。预先设定好协议（规则），轻松拖拽就可以将文件自动分类。可前往 <a target="_blank" rel="noopener" href="http://www.dropitproject.com/"> DropIt 官网</a> 下载体验，软件非常轻量，安装包只有 5.1 M 。我们来看看处理任务的效果：</p>
<p><img src="/2020/08/17/%E6%9D%82%E4%B9%B1%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%88%86%E7%B1%BB/5-dropit实现效果.gif" alt></p>
<p> 除了自动分类，它还支持批量压缩文件、给重要的文件加密、文件转格式和批量处理图片等功能。根据个人的使用习惯，可以打造个人全自动的文件管理系统，<a target="_blank" rel="noopener" href="https://sspai.com/post/45532">这里</a> 有一篇进阶使用说明，感兴趣的朋友可以看看。</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>本文围绕杂乱文件自动分类的问题，分别使用 Stata 和 Python 编写代码来实现需求，然后安利了一款 Windows 系统的文件管理神器。通过这篇文章，是不是感觉在日益依赖电脑的学习和办公环境下，能够按照需求写代码，能够节约时间，提高效率。再者，“工欲善其事，必先利其器”，多关注和使用一些良心的神器，也可以极大的提高工作效率。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="http://www.dropitproject.com/dokuwiki/doku.php?id=howto:start_with_dropit">Crash Course: How to start with DropIt</a></p>
<p><a target="_blank" rel="noopener" href="https://sspai.com/post/45532">用 DropIt 打造全自动的 Windows 文件管理体系</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/" class="post-title-link" itemprop="url">Python做多元线性回归</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 12:52:21 / Modified: 14:01:39" itemprop="dateCreated datePublished" datetime="2020-08-17T12:52:21+08:00">2020-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>人们总是倾向于寻求自己熟悉的东西。受其他语言的影响，你大概能猜到 Python 会支持正则表达式，然后就去查阅文档。但是如果你从来没有见过元组拆包（tuple unpacking），也从没有听过描述符（descriptor），那么估计你也不会去搜索它们，然后就永远失去了使用这些 Python 独有特性的机会。(《流畅的 Python 》）</p>
</blockquote>
<p>读到这句话时，深有同感。迁移能力帮助我们快速了解陌生的语言，但受惯性思维的影响，容易忽视新事物的特性。所以，我的理解是：有其他语言的基础，学习新语言时，应该迁移和对比相结合。具体而言：对比着学，尽快找到感觉；注重工具之间的特性；问题导向，根据需求选择合适的工具。</p>
<p>经济学或者其他社科专业背景的读者，做实证可能对 Stata 比较熟悉。比如要做 OLS 回归，输入 <code>reg y x1 x2 x3</code> 就好。对比到 Python 中该如何做呢？本文以 Stata 自带 <code>auto.dta</code> （1978年美国汽车数据） 数据为例，对照着 Stata 的完成多元线性回归的过程，展示在 Python 中如何跑回归。一方面，熟悉 Python 的操作；另一方面，通过比较，观察二者的特性。</p>
<p>在开始实证分析之前，应该先建立这样一个框架，使得数据和文件的存放比较清晰。所以，可见熟悉路径操作比较重要，是组织和管理项目的基础。我在 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1MTg3MDMzMw==&amp;mid=2247483677&amp;idx=3&amp;sn=7954dbf09dfaf35651ae65987e168c9d&amp;chksm=e9ed2c0fde9aa5194d6140007382082bf148b1db8e76e075ea09a2c9cd983fb15a038f9316cb&amp;scene=126&amp;sessionid=1585314476&amp;key=06a08b8428b497dccdf7995fd9edbaafd2c9a9118308c1418eed4f759e1934407e2b272e1c29a4d8be038414dc41d32c6cae09127da552d0adf25e26a4ab2560b0231d7b394941ad8593bfafea15fafe&amp;ascene=1&amp;uin=MTk2MzA0MTI3NA%3D%3D&amp;devicetype=Windows+10&amp;version=6208006f&amp;lang=zh_CN&amp;exportkey=A55ttvx2aqHJsRmrbsqgrS0%3D&amp;pass_ticket=WtX7baLha5prx6LZMFvwUR1kPi9chWY30IhRHvNO%2FLHidvGtFAnJ15JjbPyR%2Fk1M">Windows 系统常用命令行命令（二）：路径与文件夹操作</a> 讲过如何生成目录结构。本项目的目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:.</span><br><span class="line">│  README.md</span><br><span class="line">│</span><br><span class="line">├─code</span><br><span class="line">│  │  Python_auto_OLS.ipynb</span><br><span class="line">│  │  Stata_auto_OLS.do</span><br><span class="line">│  │</span><br><span class="line">│  └─.ipynb_checkpoints</span><br><span class="line">├─data</span><br><span class="line">│      auto.dta</span><br><span class="line">│</span><br><span class="line">├─doc</span><br><span class="line">│      Stata&amp;Python_实现多元线性回归对比.md</span><br><span class="line">│</span><br><span class="line">├─img</span><br><span class="line">│      1-预览数据.png</span><br><span class="line">│      2-数据概览.png</span><br><span class="line">│      3-1-描述性统计.png</span><br><span class="line">│      3-2-描述性统计.png</span><br><span class="line">│      4-相关系数矩阵.png</span><br><span class="line">│      5-相关性热力图.png</span><br><span class="line">│      6-散点图.png</span><br><span class="line">│      7-评估模型.png</span><br><span class="line">│</span><br><span class="line">├─refs</span><br><span class="line">└─result</span><br></pre></td></tr></table></figure>
<h1 id="建立模型"><a href="#建立模型" class="headerlink" title="建立模型"></a>建立模型</h1><p>先从熟悉的看起，调用 auto.dta 数据，探究汽车价格的影响因素。首先，建立如下回归模型：</p>
<script type="math/tex; mode=display">
price = \beta_{0} +\beta_{1}*weight + \beta_{2}*length + \beta_{3}*mpg + \epsilon</script><p>其中， $price$ 为汽车价格，$weight$ 为汽车重量，$length$ 为汽车长度，$mpg$ 为汽车每加仑汽油能够行驶的英里数。$\beta<em>{0}$ 为常数项，$\beta</em>{1}$，$\beta<em>{2}$，$\beta</em>{3}$为回归系数，$\epsilon$ 为残差。</p>
<h1 id="Stata-中运行回归"><a href="#Stata-中运行回归" class="headerlink" title="Stata 中运行回归"></a>Stata 中运行回归</h1><p>在 Stata 中，完成整个实证的过程大致如下：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">cd</span> ..\data</span><br><span class="line"><span class="keyword">use</span> auto,<span class="keyword">clear</span></span><br><span class="line"></span><br><span class="line"><span class="comment">* 因变量 </span></span><br><span class="line"><span class="keyword">global</span> Xs <span class="string">&quot;weight length mpg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">* 数据概览</span></span><br><span class="line"><span class="keyword">describe</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> obs:            74                          1978 Automobile Data</span></span><br><span class="line"><span class="comment"> vars:            12                          13 Apr 2016 17:45</span></span><br><span class="line"><span class="comment"> size:         3,182                          (_dta has notes)</span></span><br><span class="line"><span class="comment">---------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">              storage   display    value</span></span><br><span class="line"><span class="comment">variable name   type    format     label      variable label</span></span><br><span class="line"><span class="comment">---------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">make            str18   %-18s                 Make and Model</span></span><br><span class="line"><span class="comment">price           int     %8.0gc                Price</span></span><br><span class="line"><span class="comment">mpg             int     %8.0g                 Mileage (mpg)</span></span><br><span class="line"><span class="comment">rep78           int     %8.0g                 Repair Record 1978</span></span><br><span class="line"><span class="comment">headroom        float   %6.1f                 Headroom (in.)</span></span><br><span class="line"><span class="comment">trunk           int     %8.0g                 Trunk space (cu. ft.)</span></span><br><span class="line"><span class="comment">weight          int     %8.0gc                Weight (lbs.)</span></span><br><span class="line"><span class="comment">length          int     %8.0g                 Length (in.)</span></span><br><span class="line"><span class="comment">turn            int     %8.0g                 Turn Circle (ft.)</span></span><br><span class="line"><span class="comment">displacement    int     %8.0g                 Displacement (cu. in.)</span></span><br><span class="line"><span class="comment">gear_ratio      float   %6.2f                 Gear Ratio</span></span><br><span class="line"><span class="comment">foreign         byte    %8.0g      origin     Car type</span></span><br><span class="line"><span class="comment">---------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">Sorted by: foreign</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">* 描述性统计</span></span><br><span class="line"><span class="keyword">summarize</span> price <span class="variable">$Xs</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Variable |        Obs        Mean    Std. Dev.       Min        Max</span></span><br><span class="line"><span class="comment">-------------+---------------------------------------------------------</span></span><br><span class="line"><span class="comment">       price |         74    6165.257    2949.496       3291      15906</span></span><br><span class="line"><span class="comment">      weight |         74    3019.459    777.1936       1760       4840</span></span><br><span class="line"><span class="comment">      length |         74    187.9324    22.26634        142        233</span></span><br><span class="line"><span class="comment">         mpg |         74     21.2973    5.785503         12         41</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">* 相关系数</span></span><br><span class="line"><span class="keyword">pwcorr</span> price <span class="variable">$Xs</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">             |    price   weight   length      mpg</span></span><br><span class="line"><span class="comment">-------------+------------------------------------</span></span><br><span class="line"><span class="comment">       price |   1.0000 </span></span><br><span class="line"><span class="comment">      weight |   0.5386   1.0000 </span></span><br><span class="line"><span class="comment">      length |   0.4318   0.9460   1.0000 </span></span><br><span class="line"><span class="comment">         mpg |  -0.4686  -0.8072  -0.7958   1.0000 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">* 绘制散点图</span></span><br><span class="line"><span class="keyword">tw</span> (<span class="keyword">scatter</span> price weight)(<span class="keyword">lfit</span> price weight)</span><br><span class="line"></span><br><span class="line"><span class="comment">* 回归</span></span><br><span class="line"><span class="keyword">regress</span> price <span class="variable">$Xs</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Source |       SS           df       MS      Number of obs   =        74</span></span><br><span class="line"><span class="comment">-------------+----------------------------------   F(3, 70)        =     12.98</span></span><br><span class="line"><span class="comment">       Model |   226957412         3  75652470.6   Prob &gt; F        =    0.0000</span></span><br><span class="line"><span class="comment">    Residual |   408107984        70  5830114.06   R-squared       =    0.3574</span></span><br><span class="line"><span class="comment">-------------+----------------------------------   Adj R-squared   =    0.3298</span></span><br><span class="line"><span class="comment">       Total |   635065396        73  8699525.97   Root MSE        =    2414.6</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">       price |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]</span></span><br><span class="line"><span class="comment">-------------+----------------------------------------------------------------</span></span><br><span class="line"><span class="comment">      weight |      4.365      1.167     3.74   0.000        2.036       6.693</span></span><br><span class="line"><span class="comment">      length |   -104.868     39.722    -2.64   0.010     -184.090     -25.646</span></span><br><span class="line"><span class="comment">         mpg |    -86.789     83.943    -1.03   0.305     -254.209      80.630</span></span><br><span class="line"><span class="comment">       _cons |  14542.434   5890.632     2.47   0.016     2793.940   26290.929</span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>最终的模型结果为：</p>
<script type="math/tex; mode=display">
price = 14542.434 + 4.365*weight - 104.868*length - 86.789*mpg</script><p>其中，$weight$ 的系数为 4.365 ，在 1% 的水平下显著，说明在其他条件不变的情况下，汽车重量每上升 1 单位，汽车价格平均增加 4.365 。$length$ 和 $mpg$ 的系数分别为 -104.868 和 -86.789 。模型的整体拟合优度为 0.357 。</p>
<p>抽象出来，实证过程大致为：导入数据、概览数据、描述性统计、相关系数、绘制散点图回归和模型评估与解释。接下来，将在 Python 中按照此流程重现。</p>
<h1 id="Python-中进行回归"><a href="#Python-中进行回归" class="headerlink" title="Python 中进行回归"></a>Python 中进行回归</h1><h2 id="定义路径和导入数据"><a href="#定义路径和导入数据" class="headerlink" title="定义路径和导入数据"></a>定义路径和导入数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> join</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">os.getcwd()</span><br><span class="line">data_path = join(os.getcwd(), <span class="string">&#x27;data&#x27;</span>) <span class="comment"># data 文件夹的路径</span></span><br><span class="line"></span><br><span class="line">data = pd.read_stata(join(data_path,<span class="string">&#x27;auto.dta&#x27;</span>))</span><br><span class="line">data.head() <span class="comment"># 预览前 5 条数据</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/1-预览数据.png" alt="预览数据"></p>
<h2 id="数据概览"><a href="#数据概览" class="headerlink" title="数据概览"></a>数据概览</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.info()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/2-数据概览.png" alt></p>
<p>可以使用 <code>info()</code> 方法显示数据信息。上图结果显示，数据共有 74个观测值，12 列（ 12 个变量），columns 对应我们通常理解的 variables 。<code>rep78</code> 的 <code>non-null</code> 为 69 ，说明有 5 个缺失值。此外，还报告了数据的类型，需要注意的是，Pandas 中数据类型和 Python 中的普通的数据类型不同。</p>
<h2 id="描述性统计"><a href="#描述性统计" class="headerlink" title="描述性统计"></a>描述性统计</h2><h3 id="使用-DataFrame-的-describe-方法"><a href="#使用-DataFrame-的-describe-方法" class="headerlink" title="使用 DataFrame 的 describe() 方法"></a>使用 DataFrame 的 <code>describe()</code> 方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.describe().T</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/3-1-描述性统计.png" alt></p>
<p>上图为输出结果，<code>describe()</code> 对每一列进行统计，默认不报告非数值型列的结果。如果要报告所有列的结果，添加 <code>include=all</code> 参数，写成 <code>data.describe(include = all).T</code> 。<code>T</code> 表示转置，这里是为了方便看结果。</p>
<h3 id="计算生成"><a href="#计算生成" class="headerlink" title="计算生成"></a>计算生成</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">description = [data.min(), data.max(), data.mean(),</span><br><span class="line">               data.std()]  <span class="comment"># 依次计算最小值、最大值、均值、标准差</span></span><br><span class="line">description = pd.DataFrame(</span><br><span class="line">    description, index=[<span class="string">&#x27;Min&#x27;</span>, <span class="string">&#x27;Max&#x27;</span>, <span class="string">&#x27;Mean&#x27;</span>, <span class="string">&#x27;STD&#x27;</span>]).T  <span class="comment"># 将结果存入数据框</span></span><br><span class="line">print(<span class="string">&#x27;描述性统计结果：\n&#x27;</span>, np.round(description, <span class="number">2</span>))  <span class="comment"># 保留两位小数</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/3-2-描述性统计.png" alt></p>
<p>也可以自己计算描述性统计信息，将结果存入新的 DataFrame 。</p>
<h2 id="相关系数"><a href="#相关系数" class="headerlink" title="相关系数"></a>相关系数</h2><h3 id="计算-pearson-相关系数"><a href="#计算-pearson-相关系数" class="headerlink" title="计算 pearson 相关系数"></a>计算 pearson 相关系数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">corr = data.corr(method=<span class="string">&#x27;pearson&#x27;</span>)  <span class="comment"># pearson 相关系数矩阵</span></span><br><span class="line">print(<span class="string">&#x27;相关系数矩阵为：\n&#x27;</span>, np.round(corr, <span class="number">2</span>))  <span class="comment"># 保留两位小数</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/4-相关系数矩阵.png" alt></p>
<h3 id="绘制相关性热力图"><a href="#绘制相关性热力图" class="headerlink" title="绘制相关性热力图"></a>绘制相关性热力图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]  <span class="comment"># 用来正常显示中文标签</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span>  <span class="comment"># 用来正常显示负号</span></span><br><span class="line"></span><br><span class="line">plt.subplots(figsize=(<span class="number">10</span>, <span class="number">10</span>))  <span class="comment"># 设置画面大小</span></span><br><span class="line">sns.heatmap(corr, annot=<span class="literal">True</span>, vmax=<span class="number">1</span>, square=<span class="literal">True</span>, cmap=<span class="string">&quot;rainbow&quot;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;相关性热力图&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/5-相关性热力图.png" alt></p>
<h2 id="绘制散点图"><a href="#绘制散点图" class="headerlink" title="绘制散点图"></a>绘制散点图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sns.pairplot(data, x_vars=[<span class="string">&#x27;weight&#x27;</span>, <span class="string">&#x27;length&#x27;</span>, <span class="string">&#x27;mpg&#x27;</span>],</span><br><span class="line">             y_vars=<span class="string">&#x27;price&#x27;</span>, kind=<span class="string">&quot;reg&quot;</span>, height=<span class="number">5</span>, aspect=<span class="number">0.7</span>)</span><br><span class="line">plt.show()</span><br><span class="line">plt.close</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/6-散点图.png" alt></p>
<h2 id="回归模型"><a href="#回归模型" class="headerlink" title="回归模型"></a>回归模型</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LinearRegression</span><br><span class="line"></span><br><span class="line">Xs = data[[<span class="string">&#x27;weight&#x27;</span>, <span class="string">&#x27;length&#x27;</span>, <span class="string">&#x27;rep78&#x27;</span>]] </span><br><span class="line">y = data[<span class="string">&#x27;price&#x27;</span>].values.reshape(<span class="number">-1</span>, <span class="number">1</span>)</span><br><span class="line">reg = LinearRegression()</span><br><span class="line">reg.fit(Xs, y)</span><br><span class="line">print(<span class="string">&quot;The linear model is: price = &#123;:.5&#125; + &#123;:.5&#125;*weight + &#123;:.5&#125;*length + &#123;:.5&#125;*mpg&quot;</span>.format(</span><br><span class="line">    reg.intercept_[<span class="number">0</span>], reg.coef_[<span class="number">0</span>][<span class="number">0</span>], reg.coef_[<span class="number">0</span>][<span class="number">1</span>], reg.coef_[<span class="number">0</span>][<span class="number">2</span>]))</span><br></pre></td></tr></table></figure>
<p>输出的结果为：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The linear model <span class="keyword">is</span>: price = <span class="number">1.4542e+04</span> + <span class="number">4.3648</span>*weight + <span class="number">-104.87</span>*length + <span class="number">-86.789</span>*mpg</span><br></pre></td></tr></table></figure></p>
<h2 id="评估模型"><a href="#评估模型" class="headerlink" title="评估模型"></a>评估模型</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm</span><br><span class="line"></span><br><span class="line">Xs = np.column_stack((data[<span class="string">&#x27;weight&#x27;</span>], data[<span class="string">&#x27;length&#x27;</span>], data[<span class="string">&#x27;mpg&#x27;</span>]))</span><br><span class="line">y = data[<span class="string">&#x27;price&#x27;</span>]</span><br><span class="line">X2 = sm.add_constant(X) <span class="comment"># 添加常数项</span></span><br><span class="line">est = sm.OLS(y, X2)</span><br><span class="line">est2 = est.fit()</span><br><span class="line">print(est2.summary())</span><br></pre></td></tr></table></figure>
<p><img src="/2020/08/17/Python%E5%81%9A%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/7-评估模型.png" alt></p>
<p>上图为模型结果的评估，和前文 Stata 的回归结果对比，结果一致。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>经前文对比，是否感觉到 Stata 用来做计量的方便性？不管是数据清理还是运行模型，Stata 几条命令就可以搞定，而 Python 实现起来相对复杂。本文演示的还仅是最简单的多元线性回归，一些复杂和前沿的计量模型， Python 中可能还没有现成的包，需要自己编写代码。</p>
<p>对于完成实证论文，Stata 能够轻松的实现图表自动化，而 Python 似乎没有这么便捷的图表输出。不过使用 Jupyter Notebook ，Python 在数据探索性分析和可视化方面更加强大。简单总结，Stata 是用来做计量实证的利器，而 Python 更适合数据科学领域，完成数据分析与可视化、机器学习等任务。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/Pythonn%E4%BB%8EPDF%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/Pythonn%E4%BB%8EPDF%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">Pythonn从PDF中提取数据</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 12:32:02 / Modified: 14:01:26" itemprop="dateCreated datePublished" datetime="2020-08-17T12:32:02+08:00">2020-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>PDF(<strong>P</strong>ortable <strong>D</strong>ocument <strong>F</strong>ormat)，译作便携式文档格式，是一种用独立于应用程序、硬件、操作系统的方式呈现文档的文件格式。PDF文件通常混合了矢量图形、文本和位图，其基本内容包括：文本存储为内容字符串、由图形和线条组成的用于说明和设计的矢量图形、由照片和其他类型的图片组成的位图。这是 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8F%AF%E7%A7%BB%E6%A4%8D%E6%96%87%E6%A1%A3%E6%A0%BC%E5%BC%8F">维基百科-PDF</a> 的解释。</p>
<p>结合自己的经验，我觉得常见的PDF文件可以分为两类：一种是文本转化而成（Text-Based），这种文件通常可以直接复制和粘贴；另一种是扫描文件而成（Scanned），比如影印书籍、插入图片制成的文件。依据这个划分，将 Python 中处理 PDF 文件的第三方库可以简单归类：</p>
<ul>
<li><strong>Text-Based</strong>：<code>PyPDF2</code>,<code>pdfminer</code>,<code>textract</code>,<code>slate</code> 等库可用于提取文本；<code>pdfplumber</code>,<code>camelot</code> 等库可用来提取表格。</li>
<li><strong>Scanned</strong>：先将文档转为图片，再利用 OCR（光学字符识别）提取内容，如 <code>pytesseract</code> 库；或者采用 <code>OpenCV</code> 进行图像处理。</li>
</ul>
<p>上述大部分是第三方库，所以需要先进行安装：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">pip install PyPDF2</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install pdfminer</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install pdfminer.six</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install textract</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install slate</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install pdfplumber</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install camelot</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install pdf2image</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install pillow</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install pytesseract</span></span><br></pre></td></tr></table></figure>
<p> 接下来，我们就分别使用上面提到的方法，分别看看对两类文档的处理。</p>
<h1 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h1><h2 id="Text-Based-PDF"><a href="#Text-Based-PDF" class="headerlink" title="Text-Based PDF"></a>Text-Based PDF</h2><h3 id="PyPDF2-库"><a href="#PyPDF2-库" class="headerlink" title="PyPDF2 库"></a>PyPDF2 库</h3><p> <code>PyPDF2</code>拥有<code>PdfFileReader</code>, <code>PdfFileMerger</code>,<code>PageObject</code>和<code>PdfFileWriter</code> 四个类，能够完成 PDF 读取、拆分、裁剪和合并等工作。</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PyPDF2</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 获取 PDF 信息</span></span><br><span class="line">pdfFile = open(<span class="string">&#x27;./input/2020中央一号文件.pdf&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">pdfText = PyPDF2.PdfFileReader(pdfFile)</span><br><span class="line">page_count = pdfText.getNumPages()  <span class="comment"># 获取页面总数</span></span><br><span class="line">print(page_count)  <span class="comment"># 共 19 页</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取文本</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> range(<span class="number">0</span>, page_count):</span><br><span class="line">    text = pdfText.getPage(p)</span><br><span class="line">    print(text.extractText().encode(<span class="string">&#x27;utf-8&#x27;</span>))  </span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 部分输出：</span></span><br><span class="line"><span class="string">b&#x27;\n \n\n \n\n \n\n2020\n\n1\n\n2\n\n \n  \n\n\n\n\n \n  \n2020\n\n\n\n\n\n\n\n2020\n\n\n \n  \n\n2020\n\n\n\n\n&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\n\n\n\n\n\n \n  \n\n \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \n&#x27;</span></span><br><span class="line"><span class="string">b&#x27;  \n\n\n\n\n\n\n\n\n\n \n  \n\n\n\n\n\n\n\n\n \n  \n\n\n\n\n\n\n&#x27;</span></span><br><span class="line"><span class="string">b&#x27;\n\n \n  \n\n\n\n\n\n\n\n\n \n  \n\n\n \n  \n\n\n\n\n\n\n\n\n\n&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>上面文件提取输出为空，猜想是因为和文件本身有关，识别不了。于是，我换了另外一个英文论文用来测试。</p>
<p><img src="/2020/08/17/Pythonn%E4%BB%8EPDF%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/1.png" alt></p>
<p>测试代码和输出结果如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更换另外的英文PDF</span></span><br><span class="line">pdfFile = open(<span class="string">&#x27;./input/Political Uncertainty and Corporate Investment Cycles.pdf&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">pdfObj = PyPDF2.PdfFileReader(pdfFile)</span><br><span class="line">page_count = pdfObj.getNumPages()</span><br><span class="line">print(page_count)</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> range(<span class="number">0</span>, page_count):</span><br><span class="line">    text = pdfObj.getPage(p)</span><br><span class="line">    print(text.extractText())</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 部分输出：</span></span><br><span class="line"><span class="string">39</span></span><br><span class="line"><span class="string">THEJOURNALOFFINANCE</span></span><br><span class="line"><span class="string">•</span></span><br><span class="line"><span class="string">VOL.LXVII,NO.1</span></span><br><span class="line"><span class="string">•</span></span><br><span class="line"><span class="string">FEBRUARY2012</span></span><br><span class="line"><span class="string">PoliticalUncertaintyandCorporateInvestment</span></span><br><span class="line"><span class="string">Cycles</span></span><br><span class="line"><span class="string">BRANDONJULIOandYOUNGSUKYOOK</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ABSTRACT</span></span><br><span class="line"><span class="string">Wedocumentcyclesincorporateinvestmentcorrespondingwiththetimingofna-</span></span><br><span class="line"><span class="string">tionalelectionsaroundtheworld.Duringelectionyears,Þrmsreduceinvestmentex-</span></span><br><span class="line"><span class="string">pendituresbyanaverageof4.8%relativetononelectionyears,controllingforgrowth</span></span><br><span class="line"><span class="string">opportunitiesandeconomicconditions.Themagnitudeoftheinvestmentcyclesvaries</span></span><br><span class="line"><span class="string">withdifferentcountryandelectioncharacteristics.Weinvestigateseveralpotential</span></span><br><span class="line"><span class="string">explanationsandÞndevidencesupportingthehypothesisthatpoliticaluncertainty</span></span><br><span class="line"><span class="string">leadsÞrmstoreduceinvestmentexpendituresuntiltheelectoraluncertaintyisre-</span></span><br><span class="line"><span class="string">solved.TheseÞndingssuggestthatpoliticaluncertaintyisanimportantchannel</span></span><br><span class="line"><span class="string">throughwhichthepoliticalprocessaffectsrealeconomicoutcomes.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="pdfminer-库"><a href="#pdfminer-库" class="headerlink" title="pdfminer 库"></a>pdfminer 库</h3><p><code>pdfminer</code> 库主要用于解析PDF，因为版本更新的原因，这个库的配置过程坑略多。可以参阅 stackoverflow 上 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5725278/how-do-i-use-pdfminer-as-a-library#">How do I use pdfminer as a library
</a> 的回答，提供了一些解决方案。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfinterp <span class="keyword">import</span> PDFResourceManager, PDFPageInterpreter</span><br><span class="line"><span class="keyword">from</span> pdfminer.converter <span class="keyword">import</span> TextConverter</span><br><span class="line"><span class="keyword">from</span> pdfminer.layout <span class="keyword">import</span> LAParams</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfpage <span class="keyword">import</span> PDFPage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_pdf_to_txt</span>(<span class="params">path</span>):</span></span><br><span class="line">    rsrcmgr = PDFResourceManager()  <span class="comment"># 存储共享资源，例如字体或图片</span></span><br><span class="line">    retstr = io.StringIO()</span><br><span class="line">    codec = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    laparams = LAParams()</span><br><span class="line">    device = TextConverter(rsrcmgr, retstr, codec=codec, laparams=laparams)</span><br><span class="line">    fp = open(path, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    interpreter = PDFPageInterpreter(rsrcmgr, device)  <span class="comment"># 解析 page内容</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span>  <span class="comment"># 密码，若无则初始化为空</span></span><br><span class="line">    maxpages = <span class="number">0</span></span><br><span class="line">    caching = <span class="literal">True</span></span><br><span class="line">    pagenos = set()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> PDFPage.get_pages(fp, pagenos, maxpages=maxpages,</span><br><span class="line">                                  password=password,</span><br><span class="line">                                  caching=caching,</span><br><span class="line">                                  check_extractable=<span class="literal">True</span>):</span><br><span class="line">        interpreter.process_page(page)</span><br><span class="line"></span><br><span class="line">    text = retstr.getvalue()</span><br><span class="line"></span><br><span class="line">    fp.close()</span><br><span class="line">    device.close()</span><br><span class="line">    retstr.close()</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">convert_pdf_to_txt(<span class="string">&quot;./input/2020中央一号文件.pdf&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>输出效果如下：</p>
<p><img src="/2020/08/17/Pythonn%E4%BB%8EPDF%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/2.png" alt></p>
<h3 id="textract-库"><a href="#textract-库" class="headerlink" title="textract 库"></a>textract 库</h3><p>这个库用起来也比较方便，但配置需要注意两点：1.安装 <code>textract</code> 的时候并不会自动安装 <code>pdfminer</code>，需要手动安装 <code>pdfminer</code>；2. 报错 <code>local variable &#39;pipe&#39; referenced before assignment</code>，需要对源码进行细微修改。如果配置报错，可以参考这篇文章： <a target="_blank" rel="noopener" href="https://blog.csdn.net/FannLann/article/details/80238889">python使用textract解析pdf时遇到UnboundLocalError: local variable ‘pipe’ referenced before assignment</a>，总结的比较全面。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> textract</span><br><span class="line">text = textract.process(<span class="string">&quot;./input/2020中央一号文件.pdf&quot;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">print(text.decode())</span><br></pre></td></tr></table></figure>
<p>处理效果如下：</p>
<p><img src="/2020/08/17/Pythonn%E4%BB%8EPDF%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/3.png" alt></p>
<h2 id="Scanned-PDF"><a href="#Scanned-PDF" class="headerlink" title="Scanned PDF"></a>Scanned PDF</h2><blockquote>
<p>Python-tesseract is an optical character recognition (OCR) tool for python. That is, it will recognize and “read” the text embedded in images. Python-tesseract is a wrapper for Google’s Tesseract-OCR Engine. It is also useful as a stand-alone invocation script to tesseract, as it can read all image types supported by the Pillow and Leptonica imaging libraries, including jpeg, png, gif, bmp, tiff, and others. Additionally, if used as a script, Python-tesseract will print the recognized text instead of writing it to a file.(from pytesseract project description)</p>
</blockquote>
<p> 上段引用来自 <code>pytesseract</code> 项目的官方描述。说的是：Python-tesseract 是 Google Tesseract-OCR 引擎的包装。它也可以用作tesseract的独立调用脚本，因为它可以读取 Pillow 和 Leptonica 图像库支持的所有图像类型，包括 jpeg，png，gif，bmp，tiff 等。<strong>此外，如果用作脚本，Python-tesseract 将打印可识别的文本，而不是将其写入文件</strong>。以我最近在在看的一本电子书（奈特的《风险、不确定性和利润》）进行演示，文档的清晰度如下：</p>
<p> <img src="/2020/08/17/Pythonn%E4%BB%8EPDF%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/4.png" alt></p>
<p>对于这种扫描的文件，处理方法前言中已经提及。具体来说：先将 PDF 转换为图片，再利用 OCR 提取文本内容。另外，因为全书有 320 页，处理起来太费时间，我就先提取其中的 15-30 页（正好是作者序言）进行演示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PyPDF2</span><br><span class="line"><span class="keyword">from</span> pdf2image <span class="keyword">import</span> convert_from_path</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切割、提取15-30页</span></span><br><span class="line">pdfFile = open(<span class="string">&#x27;./input/风险、不确定性和利润.pdf&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">pdf_input = PyPDF2.PdfFileReader(pdfFile)</span><br><span class="line"></span><br><span class="line">pdf_output = PyPDF2.PdfFileWriter()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>, <span class="number">30</span>):</span><br><span class="line">    pdf_output.addPage(pdf_input.getPage(i))</span><br><span class="line">pdf_output.write(open(<span class="string">&#x27;./output/风险、不确定性和利润_15_30.pdf&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>))</span><br><span class="line"><span class="comment"># PDF 转为图片</span></span><br><span class="line">PDF_file = <span class="string">&#x27;./output/风险、不确定性和利润_15_30.pdf&#x27;</span></span><br><span class="line">pages = convert_from_path(PDF_file, <span class="number">500</span>)</span><br><span class="line">image_counter = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> pages:</span><br><span class="line">    filename = <span class="string">&quot;page_&quot;</span>+str(image_counter)+<span class="string">&quot;.jpg&quot;</span></span><br><span class="line">    page.save(filename, <span class="string">&#x27;JPEG&#x27;</span>)</span><br><span class="line">    image_counter += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 图片中提取文本</span></span><br><span class="line">filelimit = image_counter<span class="number">-1</span></span><br><span class="line">outfile = <span class="string">&quot;out_text.txt&quot;</span></span><br><span class="line">f = open(outfile, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, filelimit + <span class="number">1</span>):</span><br><span class="line">    filename = <span class="string">&quot;page_&quot;</span>+str(i)+<span class="string">&quot;.jpg&quot;</span></span><br><span class="line">    text = str(</span><br><span class="line">        ((pytesseract.image_to_string(Image.open(filename), lang=<span class="string">&#x27;chi_sim&#x27;</span>)))) // chi_sim 表示简体中文</span><br><span class="line">    text = text.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    text = text.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    f.write(text)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>处理结果如下：</p>
<p><img src="/2020/08/17/Pythonn%E4%BB%8EPDF%E4%B8%AD%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE/5.png" alt></p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>本文对 Python 中从 PDF 提取信息的方法进行了说明，并将主要第三方库进行了对比。可以看出，PDF的转换是一个比较麻烦的事，转换效果很大程度取决于文档本身的质量。如果文件量比较小，还不如复制粘贴，或者 使用 APP 和网站处理来得快。任务量比较大，实在需要程序处理时，一方面，在着手写程序之前先可以使用不同的方法对比，选择最好的实现效果；另一方面，使用程序批量处理并非一劳永逸，往往需要和人工校验相配合。</p>
<h1 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h1><p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/working-with-pdf-files-in-python/">Working with PDF files in Python</a></p>
<p> <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/136888486">PDF提取文本</a></p>
<p><a target="_blank" rel="noopener" href="https://www.blog.pythonlibrary.org/2018/05/03/exporting-data-from-pdfs-with-python/">Exporting Data from PDFs with Python</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42415326/article/details/89432839?utm_medium=distribute.pc_relevant.none-task-blog-baidujs-8">使用pdfminer3k模块读取PDF</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5725278/how-do-i-use-pdfminer-as-a-library#">How do I use pdfminer as a library
</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/PythonforResearch-2-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/PythonforResearch-2-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">PythonforResearch|2_数据处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 12:28:52 / Modified: 14:01:14" itemprop="dateCreated datePublished" datetime="2020-08-17T12:28:52+08:00">2020-08-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>创建日期：</strong> 20200805 15:20<br><strong>上次修改：</strong> 20200805 19:27<br><strong>Python版本：</strong> Python 3.7  </p>
<p>项目介绍：一直想写一份适合经济学等社科背景、学术科研向的Python教程。因为学经济学的多少会对Stata有所了解，有一些写~代码~命令的经历，这份教程应该：</p>
<ul>
<li>简洁好理解，花最少的时间了解 Python 的核心用法；</li>
<li>实用易操作，最好是能够看完上手即用。</li>
</ul>
<p>在构思了一段时间之后，偶然发现 Ties de Kok 的 <a target="_blank" rel="noopener" href="https://github.com/TiesdeKok/LearnPythonforResearch">Get started with Python for research tutorial</a>项目已经搭建出了我想要的框架。于是打算在这个项目的基础上进行完善，首先将其主要内容“汉化”成中文，之后对用法进行扩充、加入典型用法和案例。</p>
<blockquote>
<p>原作者简介：Ties de Kok (<a target="_blank" rel="noopener" href="http://www.tiesdekok.com">Personal Website</a>)为华盛顿大学福斯特商学院的助理教授，他专注于将计算机科学与实证会计研究相结合，研究兴趣是财务会计、资本市场、计算机科学、自然语言处理和经验管理会计。</p>
</blockquote>
<p>本部分基于 PyCon 2015 tutorial/talk by Brandon Rhodes，如果想了解更多，建议观看：</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=5JnMutdy6Fw">https://www.youtube.com/watch?v=5JnMutdy6Fw</a><br><a target="_blank" rel="noopener" href="https://github.com/brandon-rhodes/pycon-pandas-tutorial">https://github.com/brandon-rhodes/pycon-pandas-tutorial</a></p>
<p>往期目录：</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/rA5kgJvA8eQHRjx9pUGoXA">PythonforResearch | 0_语法基础</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/f9q7vVG5iT7w9HQTfQmIHw">PythonforResearch | 1_文件操作</a></p>
<h1 id="导入-Pandas-库"><a href="#导入-Pandas-库" class="headerlink" title="导入 Pandas 库"></a>导入 Pandas 库</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> join</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义路径</span></span><br><span class="line">data_path = join(os.getcwd(), <span class="string">&#x27;data&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h1 id="创建-dataframe"><a href="#创建-dataframe" class="headerlink" title="创建 dataframe"></a>创建 dataframe</h1><h2 id="导入本地数据"><a href="#导入本地数据" class="headerlink" title="导入本地数据"></a>导入本地数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto = pd.read_csv(join(data_path, <span class="string">&#x27;auto_df.csv&#x27;</span>), sep=<span class="string">&#x27;;&#x27;</span>, index_col=<span class="string">&#x27;Unnamed: 0&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="创建并传入数据"><a href="#创建并传入数据" class="headerlink" title="创建并传入数据"></a>创建并传入数据</h2><p>可以传入多种类型的数据到 <code>pd.DataFrame()</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;col1&#x27;</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], <span class="string">&#x27;col2&#x27;</span>: [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]&#125;</span><br><span class="line">df = pd.DataFrame(data=d)</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>7</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d = [(<span class="number">1</span>, <span class="number">2</span> ,<span class="number">3</span> ,<span class="number">4</span>), (<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>)]</span><br><span class="line">df = pd.DataFrame(data=d)</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="由字典创建"><a href="#由字典创建" class="headerlink" title="由字典创建"></a>由字典创建</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;row1&#x27;</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], <span class="string">&#x27;row2&#x27;</span>: [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]&#125;</span><br><span class="line">df = pd.DataFrame.from_dict(d, orient=<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row1</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>row2</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div>



<p>也可以直接传入字典：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame.from_dict(&#123;<span class="string">&#x27;row1&#x27;</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], <span class="string">&#x27;row2&#x27;</span>: [<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]&#125;, orient=<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row1</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>row2</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="操作-dataframe"><a href="#操作-dataframe" class="headerlink" title="操作 dataframe"></a>操作 dataframe</h1><h2 id="添加列（Add-columns）"><a href="#添加列（Add-columns）" class="headerlink" title="添加列（Add columns）"></a>添加列（Add columns）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">&#x27;col5&#x27;</span>] = [<span class="number">10</span>, <span class="number">10</span>]</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>col5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row1</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>10</td>
    </tr>
    <tr>
      <th>row2</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="添加行（Add-row）"><a href="#添加行（Add-row）" class="headerlink" title="添加行（Add row）"></a>添加行（Add row）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.loc[<span class="string">&#x27;row3&#x27;</span>] = [<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>col5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row1</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>10</td>
    </tr>
    <tr>
      <th>row2</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>10</td>
    </tr>
    <tr>
      <th>row3</th>
      <td>11</td>
      <td>12</td>
      <td>13</td>
      <td>14</td>
      <td>15</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="转置（Inverse-dataframe）"><a href="#转置（Inverse-dataframe）" class="headerlink" title="转置（Inverse dataframe）"></a>转置（Inverse dataframe）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.T</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>row1</th>
      <th>row2</th>
      <th>row3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>5</td>
      <td>11</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>6</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>7</td>
      <td>13</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>8</td>
      <td>14</td>
    </tr>
    <tr>
      <th>col5</th>
      <td>10</td>
      <td>10</td>
      <td>15</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="删除列（Remove-columns）"><a href="#删除列（Remove-columns）" class="headerlink" title="删除列（Remove columns）"></a>删除列（Remove columns）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = df.drop(<span class="string">&#x27;col5&#x27;</span>, axis=<span class="number">1</span>) <span class="comment"># axis =1 : column</span></span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row1</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>row2</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>row3</th>
      <td>11</td>
      <td>12</td>
      <td>13</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="删除行（Remove-row）"><a href="#删除行（Remove-row）" class="headerlink" title="删除行（Remove row）"></a>删除行（Remove row）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = df.drop(<span class="string">&#x27;row1&#x27;</span>, axis=<span class="number">0</span>)</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row2</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>row3</th>
      <td>11</td>
      <td>12</td>
      <td>13</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="设置索引（Set-index）"><a href="#设置索引（Set-index）" class="headerlink" title="设置索引（Set index）"></a>设置索引（Set index）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row2</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>row3</th>
      <td>11</td>
      <td>12</td>
      <td>13</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.set_index(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
    <tr>
      <th>0</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>13</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>



<p>提示：Pandas允许多索引，这在数据分析中非常实用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.set_index(<span class="number">0</span>, append=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
    <tr>
      <th></th>
      <th>0</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row2</th>
      <th>5</th>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>row3</th>
      <th>11</th>
      <td>12</td>
      <td>13</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="重置索引（Reset-index）"><a href="#重置索引（Reset-index）" class="headerlink" title="重置索引（Reset index）"></a>重置索引（Reset index）</h2><p>使用<code>reset_index()</code>将索引（index）转化为常规的列（regular column）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.reset_index()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>row2</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>row3</td>
      <td>11</td>
      <td>12</td>
      <td>13</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="重命名列（Rename-columns）"><a href="#重命名列（Rename-columns）" class="headerlink" title="重命名列（Rename columns）"></a>重命名列（Rename columns）</h1><p>可以直接操作<code>df.columns</code>或使用<code>df.rename()</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.columns = [<span class="string">&#x27;col1&#x27;</span>,<span class="string">&#x27;col2&#x27;</span>,<span class="string">&#x27;col3&#x27;</span>,<span class="string">&#x27;col4&#x27;</span>]</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
      <th>col3</th>
      <th>col4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row2</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>row3</th>
      <td>11</td>
      <td>12</td>
      <td>13</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.rename(columns=&#123;<span class="string">&#x27;col1&#x27;</span> : <span class="string">&#x27;column1&#x27;</span>, <span class="string">&#x27;col2&#x27;</span> : <span class="string">&#x27;column2&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>column1</th>
      <th>column2</th>
      <th>col3</th>
      <th>col4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row2</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>row3</th>
      <td>11</td>
      <td>12</td>
      <td>13</td>
      <td>14</td>
    </tr>
  </tbody>
</table>
</div>



<p>使用<code>df.rename()</code>是复制后修改，不会对原来的df覆盖。要对原来的df进行覆盖，需要使用<code>inplace=True</code>选项。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = df.rename(columns=&#123;<span class="string">&#x27;col1&#x27;</span> : <span class="string">&#x27;column1&#x27;</span>, <span class="string">&#x27;col2&#x27;</span> : <span class="string">&#x27;column2&#x27;</span>&#125;)</span><br><span class="line"><span class="comment">#or</span></span><br><span class="line">df.rename(columns=&#123;<span class="string">&#x27;col1&#x27;</span> : <span class="string">&#x27;column1&#x27;</span>, <span class="string">&#x27;col2&#x27;</span> : <span class="string">&#x27;column2&#x27;</span>&#125;, inplace=<span class="literal">True</span>) </span><br></pre></td></tr></table></figure>
<h1 id="预览-dataframe"><a href="#预览-dataframe" class="headerlink" title="预览 dataframe"></a>预览 dataframe</h1><h2 id="全部"><a href="#全部" class="headerlink" title="全部"></a>全部</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto <span class="comment"># 只显示首部和尾部</span></span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AMC Concord</td>
      <td>4099</td>
      <td>22</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>11</td>
      <td>2930</td>
      <td>186</td>
      <td>40</td>
      <td>121</td>
      <td>3.58</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AMC Pacer</td>
      <td>4749</td>
      <td>17</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>11</td>
      <td>3350</td>
      <td>173</td>
      <td>40</td>
      <td>258</td>
      <td>2.53</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AMC Spirit</td>
      <td>3799</td>
      <td>22</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>12</td>
      <td>2640</td>
      <td>168</td>
      <td>35</td>
      <td>121</td>
      <td>3.08</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Buick Century</td>
      <td>4816</td>
      <td>20</td>
      <td>3.0</td>
      <td>4.5</td>
      <td>16</td>
      <td>3250</td>
      <td>196</td>
      <td>40</td>
      <td>196</td>
      <td>2.93</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Buick Electra</td>
      <td>7827</td>
      <td>15</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>20</td>
      <td>4080</td>
      <td>222</td>
      <td>43</td>
      <td>350</td>
      <td>2.41</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>69</th>
      <td>VW Dasher</td>
      <td>7140</td>
      <td>23</td>
      <td>4.0</td>
      <td>2.5</td>
      <td>12</td>
      <td>2160</td>
      <td>172</td>
      <td>36</td>
      <td>97</td>
      <td>3.74</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>70</th>
      <td>VW Diesel</td>
      <td>5397</td>
      <td>41</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>15</td>
      <td>2040</td>
      <td>155</td>
      <td>35</td>
      <td>90</td>
      <td>3.78</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>71</th>
      <td>VW Rabbit</td>
      <td>4697</td>
      <td>25</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>15</td>
      <td>1930</td>
      <td>155</td>
      <td>35</td>
      <td>89</td>
      <td>3.78</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>72</th>
      <td>VW Scirocco</td>
      <td>6850</td>
      <td>25</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>16</td>
      <td>1990</td>
      <td>156</td>
      <td>36</td>
      <td>97</td>
      <td>3.78</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Volvo 260</td>
      <td>11995</td>
      <td>17</td>
      <td>5.0</td>
      <td>2.5</td>
      <td>14</td>
      <td>3170</td>
      <td>193</td>
      <td>37</td>
      <td>163</td>
      <td>2.98</td>
      <td>Foreign</td>
    </tr>
  </tbody>
</table>
<p>74 rows × 12 columns</p>
</div>



<h2 id="首部和尾部"><a href="#首部和尾部" class="headerlink" title="首部和尾部"></a>首部和尾部</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto.head(<span class="number">3</span>) <span class="comment"># 首部3条数据</span></span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AMC Concord</td>
      <td>4099</td>
      <td>22</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>11</td>
      <td>2930</td>
      <td>186</td>
      <td>40</td>
      <td>121</td>
      <td>3.58</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AMC Pacer</td>
      <td>4749</td>
      <td>17</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>11</td>
      <td>3350</td>
      <td>173</td>
      <td>40</td>
      <td>258</td>
      <td>2.53</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AMC Spirit</td>
      <td>3799</td>
      <td>22</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>12</td>
      <td>2640</td>
      <td>168</td>
      <td>35</td>
      <td>121</td>
      <td>3.08</td>
      <td>Domestic</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto.tail(<span class="number">5</span>) <span class="comment"># 尾部5条数据</span></span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>69</th>
      <td>VW Dasher</td>
      <td>7140</td>
      <td>23</td>
      <td>4.0</td>
      <td>2.5</td>
      <td>12</td>
      <td>2160</td>
      <td>172</td>
      <td>36</td>
      <td>97</td>
      <td>3.74</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>70</th>
      <td>VW Diesel</td>
      <td>5397</td>
      <td>41</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>15</td>
      <td>2040</td>
      <td>155</td>
      <td>35</td>
      <td>90</td>
      <td>3.78</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>71</th>
      <td>VW Rabbit</td>
      <td>4697</td>
      <td>25</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>15</td>
      <td>1930</td>
      <td>155</td>
      <td>35</td>
      <td>89</td>
      <td>3.78</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>72</th>
      <td>VW Scirocco</td>
      <td>6850</td>
      <td>25</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>16</td>
      <td>1990</td>
      <td>156</td>
      <td>36</td>
      <td>97</td>
      <td>3.78</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Volvo 260</td>
      <td>11995</td>
      <td>17</td>
      <td>5.0</td>
      <td>2.5</td>
      <td>14</td>
      <td>3170</td>
      <td>193</td>
      <td>37</td>
      <td>163</td>
      <td>2.98</td>
      <td>Foreign</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="随机X部分"><a href="#随机X部分" class="headerlink" title="随机X部分"></a>随机X部分</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = <span class="number">5</span></span><br><span class="line">df_auto.sample(X)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>Chev. Chevette</td>
      <td>3299</td>
      <td>29</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>9</td>
      <td>2110</td>
      <td>163</td>
      <td>34</td>
      <td>231</td>
      <td>2.93</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Chev. Nova</td>
      <td>3955</td>
      <td>19</td>
      <td>3.0</td>
      <td>3.5</td>
      <td>13</td>
      <td>3430</td>
      <td>197</td>
      <td>43</td>
      <td>250</td>
      <td>2.56</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389</td>
      <td>28</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>9</td>
      <td>1800</td>
      <td>147</td>
      <td>33</td>
      <td>98</td>
      <td>3.15</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AMC Spirit</td>
      <td>3799</td>
      <td>22</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>12</td>
      <td>2640</td>
      <td>168</td>
      <td>35</td>
      <td>121</td>
      <td>3.08</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Buick Electra</td>
      <td>7827</td>
      <td>15</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>20</td>
      <td>4080</td>
      <td>222</td>
      <td>43</td>
      <td>350</td>
      <td>2.41</td>
      <td>Domestic</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="通过行名选取行"><a href="#通过行名选取行" class="headerlink" title="通过行名选取行"></a>通过行名选取行</h2><p><strong>注意：</strong>下面返回的是Pandas的 Series 对象，这与Pandas的 Dataframe 对象不同！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[<span class="string">&#x27;make&#x27;</span>].head(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<pre><code>0    AMC Concord
1      AMC Pacer
2     AMC Spirit
Name: make, dtype: object
</code></pre><p>如果列名没有空格，则还可以在列名后使用点号(<code>.</code>)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto.make.head(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<pre><code>0    AMC Concord
1      AMC Pacer
2     AMC Spirit
Name: make, dtype: object
</code></pre><p>使用双引号，选择多列：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[[<span class="string">&#x27;make&#x27;</span>, <span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;mpg&#x27;</span>]].head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AMC Concord</td>
      <td>4099</td>
      <td>22</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AMC Pacer</td>
      <td>4749</td>
      <td>17</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AMC Spirit</td>
      <td>3799</td>
      <td>22</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Buick Century</td>
      <td>4816</td>
      <td>20</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Buick Electra</td>
      <td>7827</td>
      <td>15</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Buick LeSabre</td>
      <td>5788</td>
      <td>18</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Buick Opel</td>
      <td>4453</td>
      <td>26</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Buick Regal</td>
      <td>5189</td>
      <td>20</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Buick Riviera</td>
      <td>10372</td>
      <td>16</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Buick Skylark</td>
      <td>4082</td>
      <td>19</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="通过索引值选取行"><a href="#通过索引值选取行" class="headerlink" title="通过索引值选取行"></a>通过索引值选取行</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = df_auto[[<span class="string">&#x27;make&#x27;</span>, <span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;mpg&#x27;</span>, <span class="string">&#x27;trunk&#x27;</span>, <span class="string">&#x27;headroom&#x27;</span>]].set_index(<span class="string">&#x27;make&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.loc[<span class="string">&#x27;Buick Riviera&#x27;</span>]</span><br></pre></td></tr></table></figure>
<pre><code>price       10372.0
mpg            16.0
trunk          17.0
headroom        3.5
Name: Buick Riviera, dtype: float64
</code></pre><p>注意：返回一个pandas.Series对象而不是pandas.Dataframe对象。</p>
<h2 id="通过索引位置选取行"><a href="#通过索引位置选取行" class="headerlink" title="通过索引位置选取行"></a>通过索引位置选取行</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.iloc[<span class="number">2</span>:<span class="number">5</span>] <span class="comment"># index location</span></span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>mpg</th>
      <th>trunk</th>
      <th>headroom</th>
    </tr>
    <tr>
      <th>make</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AMC Spirit</th>
      <td>3799</td>
      <td>22</td>
      <td>12</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Buick Century</th>
      <td>4816</td>
      <td>20</td>
      <td>16</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>Buick Electra</th>
      <td>7827</td>
      <td>15</td>
      <td>20</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.iloc[<span class="number">2</span>:<span class="number">5</span>, <span class="number">1</span>:<span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mpg</th>
      <th>trunk</th>
    </tr>
    <tr>
      <th>make</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AMC Spirit</th>
      <td>22</td>
      <td>12</td>
    </tr>
    <tr>
      <th>Buick Century</th>
      <td>20</td>
      <td>16</td>
    </tr>
    <tr>
      <th>Buick Electra</th>
      <td>15</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="条件选择"><a href="#条件选择" class="headerlink" title="条件选择"></a>条件选择</h2><p>条件选择背后的逻辑：</p>
<ol>
<li>使用df[<code>condition</code>] 来请求Pandas过滤数据框</li>
<li><code>conditon</code>是每行的<code>True</code>或者<code>False</code>值序列（因此<code>condition</code>的长度必须和dataframe行的长度相同）</li>
<li>在Pandas中，只需在整个列上编写一个布尔表达式，就可以为每一行生成True或False值</li>
<li>Pandas仅会显示行为<code>True</code>的值。</li>
</ol>
<p>举例来说：</p>
<p><code>df_auto[&#39;price&#39;] &lt; 3800</code> 会每行依次判断 <code>df_auto[&#39;price&#39;]</code>，之后会返回条件为<code>True</code> 或者 <code>False</code>:</p>
<p><code>0     False
1     False
2      True
3     False
4     False
5     False</code><br>将条件放入方括号中 <code>df_auto[ df_auto[&#39;price&#39;] &lt; 3800 ]</code>， Pandas首先会生成值为 <code>True</code> / <code>False</code>的序列，之后仅显示为<code>True</code>的行所对应的值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[ df_auto[<span class="string">&#x27;price&#x27;</span>] &lt; <span class="number">3800</span> ]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>AMC Spirit</td>
      <td>3799</td>
      <td>22</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>12</td>
      <td>2640</td>
      <td>168</td>
      <td>35</td>
      <td>121</td>
      <td>3.08</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Chev. Chevette</td>
      <td>3299</td>
      <td>29</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>9</td>
      <td>2110</td>
      <td>163</td>
      <td>34</td>
      <td>231</td>
      <td>2.93</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667</td>
      <td>24</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7</td>
      <td>2750</td>
      <td>179</td>
      <td>40</td>
      <td>151</td>
      <td>2.73</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Merc. Zephyr</td>
      <td>3291</td>
      <td>20</td>
      <td>3.0</td>
      <td>3.5</td>
      <td>17</td>
      <td>2830</td>
      <td>195</td>
      <td>43</td>
      <td>140</td>
      <td>3.08</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Subaru</td>
      <td>3798</td>
      <td>35</td>
      <td>5.0</td>
      <td>2.5</td>
      <td>11</td>
      <td>2050</td>
      <td>164</td>
      <td>36</td>
      <td>97</td>
      <td>3.81</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Toyota Corolla</td>
      <td>3748</td>
      <td>31</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>9</td>
      <td>2200</td>
      <td>165</td>
      <td>35</td>
      <td>97</td>
      <td>3.21</td>
      <td>Foreign</td>
    </tr>
  </tbody>
</table>
</div>



<p>也可以通过链接布尔表达式来组合多个条件： </p>
<ul>
<li>且: <code>&amp;</code></li>
<li>或: <code>|</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[(df_auto[<span class="string">&#x27;price&#x27;</span>] &lt; <span class="number">3800</span>) &amp; (df_auto[<span class="string">&#x27;foreign&#x27;</span>] == <span class="string">&#x27;Foreign&#x27;</span>)]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>65</th>
      <td>Subaru</td>
      <td>3798</td>
      <td>35</td>
      <td>5.0</td>
      <td>2.5</td>
      <td>11</td>
      <td>2050</td>
      <td>164</td>
      <td>36</td>
      <td>97</td>
      <td>3.81</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Toyota Corolla</td>
      <td>3748</td>
      <td>31</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>9</td>
      <td>2200</td>
      <td>165</td>
      <td>35</td>
      <td>97</td>
      <td>3.21</td>
      <td>Foreign</td>
    </tr>
  </tbody>
</table>
</div>



<p>注意：如果我们不分配上述所有新dataframe，则上述所有操作均会返回这些新dataframe。如果我们要将其保留为单独的dataframe，则必须像这样分配它：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_auto_small = df_auto[(df_auto.price &lt; <span class="number">3800</span>) &amp; (df_auto.foreign == <span class="string">&#x27;Foreign&#x27;</span>)]</span><br><span class="line">df_auto_small</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>65</th>
      <td>Subaru</td>
      <td>3798</td>
      <td>35</td>
      <td>5.0</td>
      <td>2.5</td>
      <td>11</td>
      <td>2050</td>
      <td>164</td>
      <td>36</td>
      <td>97</td>
      <td>3.81</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Toyota Corolla</td>
      <td>3748</td>
      <td>31</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>9</td>
      <td>2200</td>
      <td>165</td>
      <td>35</td>
      <td>97</td>
      <td>3.21</td>
      <td>Foreign</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="dataframe排序"><a href="#dataframe排序" class="headerlink" title="dataframe排序"></a>dataframe排序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_auto.sort_values(by=[<span class="string">&#x27;headroom&#x27;</span>, <span class="string">&#x27;trunk&#x27;</span>], inplace=<span class="literal">True</span>) <span class="comment"># df.sort_value()</span></span><br><span class="line">df_auto.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229</td>
      <td>23</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>6</td>
      <td>2370</td>
      <td>170</td>
      <td>35</td>
      <td>119</td>
      <td>3.89</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934</td>
      <td>18</td>
      <td>1.0</td>
      <td>1.5</td>
      <td>7</td>
      <td>3470</td>
      <td>198</td>
      <td>42</td>
      <td>231</td>
      <td>3.08</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486</td>
      <td>26</td>
      <td>NaN</td>
      <td>1.5</td>
      <td>8</td>
      <td>2520</td>
      <td>182</td>
      <td>38</td>
      <td>119</td>
      <td>3.54</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389</td>
      <td>28</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>9</td>
      <td>1800</td>
      <td>147</td>
      <td>33</td>
      <td>98</td>
      <td>3.15</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667</td>
      <td>24</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7</td>
      <td>2750</td>
      <td>179</td>
      <td>40</td>
      <td>151</td>
      <td>2.73</td>
      <td>Domestic</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="处理数据类型"><a href="#处理数据类型" class="headerlink" title="处理数据类型"></a>处理数据类型</h1><h2 id="当前数据类型"><a href="#当前数据类型" class="headerlink" title="当前数据类型"></a>当前数据类型</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto.dtypes</span><br></pre></td></tr></table></figure>
<pre><code>make             object
price             int64
mpg               int64
rep78           float64
headroom        float64
trunk             int64
weight            int64
length            int64
turn              int64
displacement      int64
gear_ratio      float64
foreign          object
dtype: object
</code></pre><h2 id="转换数据类型"><a href="#转换数据类型" class="headerlink" title="转换数据类型"></a>转换数据类型</h2><p>我们可以通过两种方式转换列的数据类型：</p>
<ol>
<li>循环遍历值并分别转换；</li>
<li>使用内置的Pandas函数一次性转换列。</li>
</ol>
<h3 id="分别转换值"><a href="#分别转换值" class="headerlink" title="分别转换值"></a>分别转换值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[<span class="string">&#x27;length&#x27;</span>].apply(<span class="keyword">lambda</span> x: str(x)).dtypes <span class="comment"># apply() + lambda function</span></span><br></pre></td></tr></table></figure>
<pre><code>dtype(&#39;O&#39;)
</code></pre><p>注意: <code>&#39;O&#39;</code> 表示 ‘object’</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[<span class="string">&#x27;length&#x27;</span>].apply(<span class="keyword">lambda</span> x: int(x)).dtypes</span><br></pre></td></tr></table></figure>
<pre><code>dtype(&#39;int64&#39;)
</code></pre><h3 id="直接转换列"><a href="#直接转换列" class="headerlink" title="直接转换列"></a>直接转换列</h3><p>如果想将列转化为<code>string</code>，建议使用<code>.astype(str)</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[<span class="string">&#x27;length&#x27;</span>].astype(str).dtypes</span><br></pre></td></tr></table></figure>
<pre><code>dtype(&#39;O&#39;)
</code></pre><p>如果想将列转化为<code>numeric</code>，建议使用<code>df.to_numeric()</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.to_numeric(df_auto[<span class="string">&#x27;length&#x27;</span>]).dtypes</span><br></pre></td></tr></table></figure>
<pre><code>dtype(&#39;int64&#39;)
</code></pre><h1 id="处理缺失值"><a href="#处理缺失值" class="headerlink" title="处理缺失值"></a>处理缺失值</h1><p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/missing_data.html">http://pandas.pydata.org/pandas-docs/stable/missing_data.html</a></p>
<h2 id="添加缺失值"><a href="#添加缺失值" class="headerlink" title="添加缺失值"></a>添加缺失值</h2><p>将缺失值定义为<code>np.nan</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_auto.loc[<span class="string">&#x27;UvT_Car&#x27;</span>] = [np.nan <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>,len(df_auto.columns))]</span><br><span class="line">df_auto.loc[<span class="string">&#x27;UvT_Bike&#x27;</span>] = [np.nan <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>,len(df_auto.columns))]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto.loc[[<span class="string">&#x27;UvT_Car&#x27;</span>, <span class="string">&#x27;UvT_Bike&#x27;</span>]]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>UvT_Car</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>UvT_Bike</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="选择缺失或非缺失值"><a href="#选择缺失或非缺失值" class="headerlink" title="选择缺失或非缺失值"></a>选择缺失或非缺失值</h2><p>始终使用<code>pd.isnull()</code> 或<code>pd.notnull()</code> 最为可靠,<code>df_auto.make == np.nan</code> 有时无法取得正确的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[pd.isnull(df_auto.make)]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>UvT_Car</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>UvT_Bike</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[pd.notnull(df_auto.make)].head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>23.0</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>6.0</td>
      <td>2370.0</td>
      <td>170.0</td>
      <td>35.0</td>
      <td>119.0</td>
      <td>3.89</td>
      <td>Foreign</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>18.0</td>
      <td>1.0</td>
      <td>1.5</td>
      <td>7.0</td>
      <td>3470.0</td>
      <td>198.0</td>
      <td>42.0</td>
      <td>231.0</td>
      <td>3.08</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>26.0</td>
      <td>NaN</td>
      <td>1.5</td>
      <td>8.0</td>
      <td>2520.0</td>
      <td>182.0</td>
      <td>38.0</td>
      <td>119.0</td>
      <td>3.54</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389.0</td>
      <td>28.0</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>9.0</td>
      <td>1800.0</td>
      <td>147.0</td>
      <td>33.0</td>
      <td>98.0</td>
      <td>3.15</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2750.0</td>
      <td>179.0</td>
      <td>40.0</td>
      <td>151.0</td>
      <td>2.73</td>
      <td>Domestic</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="填补缺失值"><a href="#填补缺失值" class="headerlink" title="填补缺失值"></a>填补缺失值</h2><p>使用<code>fillna()</code>填补缺失值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = df_auto.fillna(<span class="string">&#x27;Missing&#x27;</span>)</span><br><span class="line">df.loc[[<span class="string">&#x27;UvT_Car&#x27;</span>, <span class="string">&#x27;UvT_Bike&#x27;</span>]]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>UvT_Car</th>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
    </tr>
    <tr>
      <th>UvT_Bike</th>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
      <td>Missing</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="删除含缺失值的行"><a href="#删除含缺失值的行" class="headerlink" title="删除含缺失值的行"></a>删除含缺失值的行</h2><p>使用<code>.dropna()</code>删除缺失值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto[<span class="string">&#x27;make&#x27;</span>].tail(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<pre><code>45          Plym. Volare
UvT_Car              NaN
UvT_Bike             NaN
Name: make, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = df_auto.dropna(axis=<span class="number">0</span>)</span><br><span class="line">df[<span class="string">&#x27;make&#x27;</span>].tail(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<pre><code>36       Olds Cutlass
22    Dodge St. Regis
45       Plym. Volare
Name: make, dtype: object
</code></pre><h1 id="处理-dataframe"><a href="#处理-dataframe" class="headerlink" title="处理 dataframe"></a>处理 dataframe</h1><h2 id="合并列（Combine-columns）生成新的一列"><a href="#合并列（Combine-columns）生成新的一列" class="headerlink" title="合并列（Combine columns）生成新的一列"></a>合并列（Combine columns）生成新的一列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_auto[<span class="string">&#x27;price_trunk_ratio&#x27;</span>] = df_auto.price / df_auto.trunk</span><br><span class="line">df_auto[[<span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;trunk&#x27;</span>, <span class="string">&#x27;price_trunk_ratio&#x27;</span>]].head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>trunk</th>
      <th>price_trunk_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>6229.0</td>
      <td>6.0</td>
      <td>1038.166667</td>
    </tr>
    <tr>
      <th>47</th>
      <td>4934.0</td>
      <td>7.0</td>
      <td>704.857143</td>
    </tr>
    <tr>
      <th>44</th>
      <td>6486.0</td>
      <td>8.0</td>
      <td>810.750000</td>
    </tr>
    <tr>
      <th>23</th>
      <td>4389.0</td>
      <td>9.0</td>
      <td>487.666667</td>
    </tr>
    <tr>
      <th>17</th>
      <td>3667.0</td>
      <td>7.0</td>
      <td>523.857143</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="通过遍历（iterate）每行数据框来生成新列"><a href="#通过遍历（iterate）每行数据框来生成新列" class="headerlink" title="通过遍历（iterate）每行数据框来生成新列"></a>通过遍历（iterate）每行数据框来生成新列</h2><p><strong>提出问题：如果是国外车(Foreign)，将价格（Price）乘以1.5。</strong></p>
<h3 id="法一：使用apply-函数和lambda"><a href="#法一：使用apply-函数和lambda" class="headerlink" title="法一：使用apply()函数和lambda"></a>法一：使用<code>apply()</code>函数和<code>lambda</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logic = <span class="keyword">lambda</span> x: x.price*<span class="number">1.5</span> <span class="keyword">if</span> x.foreign == <span class="string">&#x27;Foreign&#x27;</span> <span class="keyword">else</span> x.price</span><br><span class="line">df_auto[<span class="string">&#x27;new_price&#x27;</span>] = df_auto.apply(logic, axis=<span class="number">1</span>)</span><br><span class="line">df_auto[[<span class="string">&#x27;make&#x27;</span>, <span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;foreign&#x27;</span>, <span class="string">&#x27;new_price&#x27;</span>]].head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>foreign</th>
      <th>new_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>Foreign</td>
      <td>9343.5</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>Domestic</td>
      <td>4934.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>Domestic</td>
      <td>6486.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389.0</td>
      <td>Domestic</td>
      <td>4389.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>Domestic</td>
      <td>3667.0</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="法二：使用apply-和函数"><a href="#法二：使用apply-和函数" class="headerlink" title="法二：使用apply()和函数"></a>法二：使用<code>apply()</code>和函数</h3><p>在上面的示例中，我们使用匿名lambda函数。<br>对于更复杂的处理，可以使用已定义的函数并在<code>.apply()</code>中调用它。<br>比较建议这种方式，因为最灵活并且更易于阅读。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_price_function</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">if</span> x.foreign == <span class="string">&#x27;Foreign&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> x.price * <span class="number">1.5</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x.price</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_auto[<span class="string">&#x27;new_price&#x27;</span>] = df_auto.apply(new_price_function, axis=<span class="number">1</span>) <span class="comment"># axis =1: iterate over rows</span></span><br><span class="line">df_auto[[<span class="string">&#x27;make&#x27;</span>, <span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;foreign&#x27;</span>, <span class="string">&#x27;new_price&#x27;</span>]].head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>foreign</th>
      <th>new_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>Foreign</td>
      <td>9343.5</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>Domestic</td>
      <td>4934.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>Domestic</td>
      <td>6486.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389.0</td>
      <td>Domestic</td>
      <td>4389.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>Domestic</td>
      <td>3667.0</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="法三：列表推导式"><a href="#法三：列表推导式" class="headerlink" title="法三：列表推导式"></a>法三：列表推导式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_auto[<span class="string">&#x27;new_price&#x27;</span>] = [p*<span class="number">1.5</span> <span class="keyword">if</span> f == <span class="string">&#x27;Foreign&#x27;</span> <span class="keyword">else</span> p <span class="keyword">for</span> p, f <span class="keyword">in</span> zip(df_auto.price, df_auto.foreign)]</span><br><span class="line">df_auto[[<span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;foreign&#x27;</span>, <span class="string">&#x27;new_price&#x27;</span>]].sample(<span class="number">5</span>, random_state=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>foreign</th>
      <th>new_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>58</th>
      <td>8129.0</td>
      <td>Foreign</td>
      <td>12193.5</td>
    </tr>
    <tr>
      <th>49</th>
      <td>4723.0</td>
      <td>Domestic</td>
      <td>4723.0</td>
    </tr>
    <tr>
      <th>41</th>
      <td>4647.0</td>
      <td>Domestic</td>
      <td>4647.0</td>
    </tr>
    <tr>
      <th>36</th>
      <td>4733.0</td>
      <td>Domestic</td>
      <td>4733.0</td>
    </tr>
    <tr>
      <th>40</th>
      <td>10371.0</td>
      <td>Domestic</td>
      <td>10371.0</td>
    </tr>
  </tbody>
</table>
</div>



<p>注意：<code>random_state=1</code>保证每次获取同样的随机数样本。</p>
<h2 id="合并dataframe"><a href="#合并dataframe" class="headerlink" title="合并dataframe"></a>合并dataframe</h2><p>有三种方式合并dataframe：</p>
<ol>
<li>Merge  </li>
<li>Join  </li>
<li>Append  </li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据准备</span></span><br><span class="line">df_auto_p1 = df_auto[[<span class="string">&#x27;make&#x27;</span>, <span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;mpg&#x27;</span>]]</span><br><span class="line">df_auto_p2 = df_auto[[<span class="string">&#x27;make&#x27;</span>, <span class="string">&#x27;headroom&#x27;</span>, <span class="string">&#x27;trunk&#x27;</span>]]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto_p1.head(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>26.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto_p2.head(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>headroom</th>
      <th>trunk</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>1.5</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>1.5</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>1.5</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="Merge-数据集"><a href="#Merge-数据集" class="headerlink" title="Merge 数据集"></a>Merge 数据集</h3><p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.merge.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.merge.html</a> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">merged_auto = pd.merge(df_auto_p1, df_auto_p2, how=<span class="string">&#x27;left&#x27;</span>, on=<span class="string">&#x27;make&#x27;</span>)</span><br><span class="line">merged_auto.head(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>headroom</th>
      <th>trunk</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>23.0</td>
      <td>1.5</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>18.0</td>
      <td>1.5</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>26.0</td>
      <td>1.5</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="在索引上Join数据集"><a href="#在索引上Join数据集" class="headerlink" title="在索引上Join数据集"></a>在索引上Join数据集</h3><p>两个dataframe都必须具有与索引相同的列集（column set）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_auto_p1.set_index(<span class="string">&#x27;make&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">df_auto_p2.set_index(<span class="string">&#x27;make&#x27;</span>, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Append"><a href="#Append" class="headerlink" title="Append"></a>Append</h3><p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/merging.html#concatenating-objects">http://pandas.pydata.org/pandas-docs/stable/merging.html#concatenating-objects</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_auto_i1 = df_auto.iloc[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">df_auto_i2 = df_auto.iloc[<span class="number">3</span>:<span class="number">6</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto_i1</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
      <th>price_trunk_ratio</th>
      <th>new_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>23.0</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>6.0</td>
      <td>2370.0</td>
      <td>170.0</td>
      <td>35.0</td>
      <td>119.0</td>
      <td>3.89</td>
      <td>Foreign</td>
      <td>1038.166667</td>
      <td>9343.5</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>18.0</td>
      <td>1.0</td>
      <td>1.5</td>
      <td>7.0</td>
      <td>3470.0</td>
      <td>198.0</td>
      <td>42.0</td>
      <td>231.0</td>
      <td>3.08</td>
      <td>Domestic</td>
      <td>704.857143</td>
      <td>4934.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>26.0</td>
      <td>NaN</td>
      <td>1.5</td>
      <td>8.0</td>
      <td>2520.0</td>
      <td>182.0</td>
      <td>38.0</td>
      <td>119.0</td>
      <td>3.54</td>
      <td>Domestic</td>
      <td>810.750000</td>
      <td>6486.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto_i2</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
      <th>price_trunk_ratio</th>
      <th>new_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389.0</td>
      <td>28.0</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>9.0</td>
      <td>1800.0</td>
      <td>147.0</td>
      <td>33.0</td>
      <td>98.0</td>
      <td>3.15</td>
      <td>Domestic</td>
      <td>487.666667</td>
      <td>4389.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2750.0</td>
      <td>179.0</td>
      <td>40.0</td>
      <td>151.0</td>
      <td>2.73</td>
      <td>Domestic</td>
      <td>523.857143</td>
      <td>3667.0</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Pont. Sunbird</td>
      <td>4172.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2690.0</td>
      <td>179.0</td>
      <td>41.0</td>
      <td>151.0</td>
      <td>2.73</td>
      <td>Domestic</td>
      <td>596.000000</td>
      <td>4172.0</td>
    </tr>
  </tbody>
</table>
</div>



<p>使用<code>concat()</code>函数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.concat([df_auto_i1, df_auto_i2])</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
      <th>price_trunk_ratio</th>
      <th>new_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>23.0</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>6.0</td>
      <td>2370.0</td>
      <td>170.0</td>
      <td>35.0</td>
      <td>119.0</td>
      <td>3.89</td>
      <td>Foreign</td>
      <td>1038.166667</td>
      <td>9343.5</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>18.0</td>
      <td>1.0</td>
      <td>1.5</td>
      <td>7.0</td>
      <td>3470.0</td>
      <td>198.0</td>
      <td>42.0</td>
      <td>231.0</td>
      <td>3.08</td>
      <td>Domestic</td>
      <td>704.857143</td>
      <td>4934.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>26.0</td>
      <td>NaN</td>
      <td>1.5</td>
      <td>8.0</td>
      <td>2520.0</td>
      <td>182.0</td>
      <td>38.0</td>
      <td>119.0</td>
      <td>3.54</td>
      <td>Domestic</td>
      <td>810.750000</td>
      <td>6486.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389.0</td>
      <td>28.0</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>9.0</td>
      <td>1800.0</td>
      <td>147.0</td>
      <td>33.0</td>
      <td>98.0</td>
      <td>3.15</td>
      <td>Domestic</td>
      <td>487.666667</td>
      <td>4389.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2750.0</td>
      <td>179.0</td>
      <td>40.0</td>
      <td>151.0</td>
      <td>2.73</td>
      <td>Domestic</td>
      <td>523.857143</td>
      <td>3667.0</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Pont. Sunbird</td>
      <td>4172.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2690.0</td>
      <td>179.0</td>
      <td>41.0</td>
      <td>151.0</td>
      <td>2.73</td>
      <td>Domestic</td>
      <td>596.000000</td>
      <td>4172.0</td>
    </tr>
  </tbody>
</table>
</div>



<p>使用<code>append()</code>函数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto_i1.append(df_auto_i2)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
      <th>price_trunk_ratio</th>
      <th>new_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>23.0</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>6.0</td>
      <td>2370.0</td>
      <td>170.0</td>
      <td>35.0</td>
      <td>119.0</td>
      <td>3.89</td>
      <td>Foreign</td>
      <td>1038.166667</td>
      <td>9343.5</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>18.0</td>
      <td>1.0</td>
      <td>1.5</td>
      <td>7.0</td>
      <td>3470.0</td>
      <td>198.0</td>
      <td>42.0</td>
      <td>231.0</td>
      <td>3.08</td>
      <td>Domestic</td>
      <td>704.857143</td>
      <td>4934.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>26.0</td>
      <td>NaN</td>
      <td>1.5</td>
      <td>8.0</td>
      <td>2520.0</td>
      <td>182.0</td>
      <td>38.0</td>
      <td>119.0</td>
      <td>3.54</td>
      <td>Domestic</td>
      <td>810.750000</td>
      <td>6486.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389.0</td>
      <td>28.0</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>9.0</td>
      <td>1800.0</td>
      <td>147.0</td>
      <td>33.0</td>
      <td>98.0</td>
      <td>3.15</td>
      <td>Domestic</td>
      <td>487.666667</td>
      <td>4389.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2750.0</td>
      <td>179.0</td>
      <td>40.0</td>
      <td>151.0</td>
      <td>2.73</td>
      <td>Domestic</td>
      <td>523.857143</td>
      <td>3667.0</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Pont. Sunbird</td>
      <td>4172.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2690.0</td>
      <td>179.0</td>
      <td>41.0</td>
      <td>151.0</td>
      <td>2.73</td>
      <td>Domestic</td>
      <td>596.000000</td>
      <td>4172.0</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="分组操作（Group-by-operations）"><a href="#分组操作（Group-by-operations）" class="headerlink" title="分组操作（Group-by operations）"></a>分组操作（Group-by operations）</h2><p>使用<code>.groupby()</code>实现组内操作，处理流程如下：</p>
<ol>
<li><strong>Split</strong>: 根据某些条件将数据分为几组</li>
<li><strong>Apply</strong>: 分别对每个组应用函数</li>
<li><strong>Combine</strong>: 将结果组合到数据结构中</li>
</ol>
<p>参阅:<a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/groupby.html">http://pandas.pydata.org/pandas-docs/stable/groupby.html</a></p>
<h3 id="通过创建group对象拆分dataframe"><a href="#通过创建group对象拆分dataframe" class="headerlink" title="通过创建group对象拆分dataframe"></a>通过创建group对象拆分dataframe</h3><p>步骤1：创建一个组对象，该对象指定我们要创建的组。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">col_list = [<span class="string">&#x27;price&#x27;</span>, <span class="string">&#x27;mpg&#x27;</span>, <span class="string">&#x27;headroom&#x27;</span>, <span class="string">&#x27;trunk&#x27;</span>, <span class="string">&#x27;weight&#x27;</span>, <span class="string">&#x27;length&#x27;</span>]</span><br><span class="line">grouped = df_auto[col_list + [<span class="string">&#x27;foreign&#x27;</span>]].groupby([<span class="string">&#x27;foreign&#x27;</span>])</span><br></pre></td></tr></table></figure>
<h3 id="应用示例1：计算均值摘要统计量"><a href="#应用示例1：计算均值摘要统计量" class="headerlink" title="应用示例1：计算均值摘要统计量"></a>应用示例1：计算均值摘要统计量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped.mean()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>mpg</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
    </tr>
    <tr>
      <th>foreign</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Domestic</th>
      <td>6072.423077</td>
      <td>19.826923</td>
      <td>3.153846</td>
      <td>14.750000</td>
      <td>3317.115385</td>
      <td>196.134615</td>
    </tr>
    <tr>
      <th>Foreign</th>
      <td>6384.681818</td>
      <td>24.772727</td>
      <td>2.613636</td>
      <td>11.409091</td>
      <td>2315.909091</td>
      <td>168.545455</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="应用示例2：检索特定组"><a href="#应用示例2：检索特定组" class="headerlink" title="应用示例2：检索特定组"></a>应用示例2：检索特定组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped.get_group(<span class="string">&#x27;Domestic&#x27;</span>).head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>mpg</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>foreign</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>47</th>
      <td>4934.0</td>
      <td>18.0</td>
      <td>1.5</td>
      <td>7.0</td>
      <td>3470.0</td>
      <td>198.0</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>44</th>
      <td>6486.0</td>
      <td>26.0</td>
      <td>1.5</td>
      <td>8.0</td>
      <td>2520.0</td>
      <td>182.0</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>23</th>
      <td>4389.0</td>
      <td>28.0</td>
      <td>1.5</td>
      <td>9.0</td>
      <td>1800.0</td>
      <td>147.0</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>17</th>
      <td>3667.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2750.0</td>
      <td>179.0</td>
      <td>Domestic</td>
    </tr>
    <tr>
      <th>51</th>
      <td>4172.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2690.0</td>
      <td>179.0</td>
      <td>Domestic</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="应用示例3：遍历group对象中的组"><a href="#应用示例3：遍历group对象中的组" class="headerlink" title="应用示例3：遍历group对象中的组"></a>应用示例3：遍历<code>group</code>对象中的组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> name, group <span class="keyword">in</span> grouped:</span><br><span class="line">    print(name)</span><br><span class="line">    print(group.head())</span><br></pre></td></tr></table></figure>
<pre><code>Domestic
     price   mpg  headroom  trunk  weight  length   foreign
47  4934.0  18.0       1.5    7.0  3470.0   198.0  Domestic
44  6486.0  26.0       1.5    8.0  2520.0   182.0  Domestic
23  4389.0  28.0       1.5    9.0  1800.0   147.0  Domestic
17  3667.0  24.0       2.0    7.0  2750.0   179.0  Domestic
51  4172.0  24.0       2.0    7.0  2690.0   179.0  Domestic
Foreign
     price   mpg  headroom  trunk  weight  length  foreign
55  6229.0  23.0       1.5    6.0  2370.0   170.0  Foreign
56  4589.0  35.0       2.0    8.0  2020.0   165.0  Foreign
68  5719.0  18.0       2.0   11.0  2670.0   175.0  Foreign
72  6850.0  25.0       2.0   16.0  1990.0   156.0  Foreign
61  4499.0  28.0       2.5    5.0  1760.0   149.0  Foreign
</code></pre><p>在<code>group</code>对象中应用<code>.apply()</code>函数：</p>
<p>在<code>.apply（）</code>中使用<code>lambda</code>是迭代数据子集的好方法。<br>例如，假设我们要获得每个<code>trunk</code>尺寸类别中最便宜的汽车：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_auto.groupby(<span class="string">&#x27;trunk&#x27;</span>).apply(<span class="keyword">lambda</span> df: df.sort_values(<span class="string">&#x27;price&#x27;</span>).iloc[<span class="number">0</span>]).head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>mpg</th>
      <th>rep78</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
      <th>turn</th>
      <th>displacement</th>
      <th>gear_ratio</th>
      <th>foreign</th>
      <th>price_trunk_ratio</th>
      <th>new_price</th>
    </tr>
    <tr>
      <th>trunk</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5.0</th>
      <td>Honda Civic</td>
      <td>4499.0</td>
      <td>28.0</td>
      <td>4.0</td>
      <td>2.5</td>
      <td>5.0</td>
      <td>1760.0</td>
      <td>149.0</td>
      <td>34.0</td>
      <td>91.0</td>
      <td>3.30</td>
      <td>Foreign</td>
      <td>899.800000</td>
      <td>6748.5</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>23.0</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>6.0</td>
      <td>2370.0</td>
      <td>170.0</td>
      <td>35.0</td>
      <td>119.0</td>
      <td>3.89</td>
      <td>Foreign</td>
      <td>1038.166667</td>
      <td>9343.5</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>24.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>2750.0</td>
      <td>179.0</td>
      <td>40.0</td>
      <td>151.0</td>
      <td>2.73</td>
      <td>Domestic</td>
      <td>523.857143</td>
      <td>3667.0</td>
    </tr>
    <tr>
      <th>8.0</th>
      <td>Dodge Colt</td>
      <td>3984.0</td>
      <td>30.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>8.0</td>
      <td>2120.0</td>
      <td>163.0</td>
      <td>35.0</td>
      <td>98.0</td>
      <td>3.54</td>
      <td>Domestic</td>
      <td>498.000000</td>
      <td>3984.0</td>
    </tr>
    <tr>
      <th>9.0</th>
      <td>Chev. Chevette</td>
      <td>3299.0</td>
      <td>29.0</td>
      <td>3.0</td>
      <td>2.5</td>
      <td>9.0</td>
      <td>2110.0</td>
      <td>163.0</td>
      <td>34.0</td>
      <td>231.0</td>
      <td>2.93</td>
      <td>Domestic</td>
      <td>366.555556</td>
      <td>3299.0</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="将groupby对象聚合到新-dataframe"><a href="#将groupby对象聚合到新-dataframe" class="headerlink" title="将groupby对象聚合到新 dataframe"></a>将groupby对象聚合到新 dataframe</h2><p>如果要将每个组汇总到新数据框中的一行，则可以使用以下两个示例中的许多选项：</p>
<h3 id="grouped-sum-和-gropued-mean"><a href="#grouped-sum-和-gropued-mean" class="headerlink" title="grouped.sum() 和 gropued.mean()"></a><code>grouped.sum()</code> 和 <code>gropued.mean()</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped.sum()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>mpg</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
    </tr>
    <tr>
      <th>foreign</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Domestic</th>
      <td>315766.0</td>
      <td>1031.0</td>
      <td>164.0</td>
      <td>767.0</td>
      <td>172490.0</td>
      <td>10199.0</td>
    </tr>
    <tr>
      <th>Foreign</th>
      <td>140463.0</td>
      <td>545.0</td>
      <td>57.5</td>
      <td>251.0</td>
      <td>50950.0</td>
      <td>3708.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped.mean()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>mpg</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
    </tr>
    <tr>
      <th>foreign</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Domestic</th>
      <td>6072.423077</td>
      <td>19.826923</td>
      <td>3.153846</td>
      <td>14.750000</td>
      <td>3317.115385</td>
      <td>196.134615</td>
    </tr>
    <tr>
      <th>Foreign</th>
      <td>6384.681818</td>
      <td>24.772727</td>
      <td>2.613636</td>
      <td>11.409091</td>
      <td>2315.909091</td>
      <td>168.545455</td>
    </tr>
  </tbody>
</table>
</div>



<h3 id="grouped-count-和-gropued-size"><a href="#grouped-count-和-gropued-size" class="headerlink" title="grouped.count() 和 gropued.size()"></a><code>grouped.count()</code> 和 <code>gropued.size()</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped.count()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>mpg</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
    </tr>
    <tr>
      <th>foreign</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Domestic</th>
      <td>52</td>
      <td>52</td>
      <td>52</td>
      <td>52</td>
      <td>52</td>
      <td>52</td>
    </tr>
    <tr>
      <th>Foreign</th>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped.size()</span><br></pre></td></tr></table></figure>
<pre><code>foreign
Domestic    52
Foreign     22
dtype: int64
</code></pre><h3 id="grouped-first-和-gropued-last"><a href="#grouped-first-和-gropued-last" class="headerlink" title="grouped.first() 和 gropued.last()"></a><code>grouped.first()</code> 和 <code>gropued.last()</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped.first()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>mpg</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
    </tr>
    <tr>
      <th>foreign</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Domestic</th>
      <td>4934.0</td>
      <td>18.0</td>
      <td>1.5</td>
      <td>7.0</td>
      <td>3470.0</td>
      <td>198.0</td>
    </tr>
    <tr>
      <th>Foreign</th>
      <td>6229.0</td>
      <td>23.0</td>
      <td>1.5</td>
      <td>6.0</td>
      <td>2370.0</td>
      <td>170.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped.last()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>mpg</th>
      <th>headroom</th>
      <th>trunk</th>
      <th>weight</th>
      <th>length</th>
    </tr>
    <tr>
      <th>foreign</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Domestic</th>
      <td>4060.0</td>
      <td>18.0</td>
      <td>5.0</td>
      <td>16.0</td>
      <td>3330.0</td>
      <td>201.0</td>
    </tr>
    <tr>
      <th>Foreign</th>
      <td>12990.0</td>
      <td>14.0</td>
      <td>3.5</td>
      <td>14.0</td>
      <td>3420.0</td>
      <td>192.0</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped.agg(&#123;<span class="string">&#x27;price&#x27;</span> : <span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;mpg&#x27;</span> : [<span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;median&#x27;</span>], <span class="string">&#x27;trunk&#x27;</span> : [<span class="string">&#x27;mean&#x27;</span>, (<span class="keyword">lambda</span> x: <span class="number">100</span> * np.mean(x))]&#125;)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>price</th>
      <th colspan="2" halign="left">mpg</th>
      <th colspan="2" halign="left">trunk</th>
    </tr>
    <tr>
      <th></th>
      <th>first</th>
      <th>mean</th>
      <th>median</th>
      <th>mean</th>
      <th>&lt;lambda_0&gt;</th>
    </tr>
    <tr>
      <th>foreign</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Domestic</th>
      <td>4934.0</td>
      <td>19.826923</td>
      <td>19.0</td>
      <td>14.750000</td>
      <td>1475.000000</td>
    </tr>
    <tr>
      <th>Foreign</th>
      <td>6229.0</td>
      <td>24.772727</td>
      <td>24.5</td>
      <td>11.409091</td>
      <td>1140.909091</td>
    </tr>
  </tbody>
</table>
</div>



<p><code>.groupby</code>更多的操作可以参阅：<br><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/groupby.html">https://pandas.pydata.org/pandas-docs/stable/groupby.html</a></p>
<h1 id="重塑和数据透视表"><a href="#重塑和数据透视表" class="headerlink" title="重塑和数据透视表"></a>重塑和数据透视表</h1><h2 id="创建演示数据"><a href="#创建演示数据" class="headerlink" title="创建演示数据"></a>创建演示数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tuples = [(<span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;one&#x27;</span>,   <span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">          (<span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;two&#x27;</span>,   <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">          (<span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;three&#x27;</span>, <span class="number">5</span>, <span class="number">6</span>),</span><br><span class="line">          (<span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;one&#x27;</span>,   <span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">          (<span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;two&#x27;</span>,   <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">          (<span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;three&#x27;</span>, <span class="number">5</span>, <span class="number">6</span>),</span><br><span class="line">          (<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;one&#x27;</span>,   <span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">          (<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;two&#x27;</span>,   <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">          (<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;three&#x27;</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">         ]</span><br><span class="line">df = pd.DataFrame(tuples)</span><br><span class="line">df.columns = [<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>first</th>
      <th>second</th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bar</td>
      <td>one</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bar</td>
      <td>two</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bar</td>
      <td>three</td>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>baz</td>
      <td>one</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>baz</td>
      <td>two</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>baz</td>
      <td>three</td>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>6</th>
      <td>foo</td>
      <td>one</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>foo</td>
      <td>two</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>foo</td>
      <td>three</td>
      <td>5</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="示例1：创建透视表（Create-a-pivot-table）"><a href="#示例1：创建透视表（Create-a-pivot-table）" class="headerlink" title="示例1：创建透视表（Create a pivot table）"></a>示例1：创建透视表（Create a pivot table）</h2><p>使用<code>pivot()</code>函数：<br><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/reshaping.html#reshaping-by-pivoting-dataframe-objects">http://pandas.pydata.org/pandas-docs/stable/reshaping.html#reshaping-by-pivoting-dataframe-objects</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.pivot(index=<span class="string">&#x27;first&#x27;</span>, columns=<span class="string">&#x27;second&#x27;</span>, values=<span class="string">&#x27;A&#x27;</span>)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>second</th>
      <th>one</th>
      <th>three</th>
      <th>two</th>
    </tr>
    <tr>
      <th>first</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>bar</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>baz</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
    </tr>
    <tr>
      <th>foo</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>



<p>使用 <code>pd.pivot_table()</code> 函数:<br><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.pivot_table.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.pivot_table.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df, values=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>], index=<span class="string">&#x27;first&#x27;</span>, columns=<span class="string">&#x27;second&#x27;</span>)</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">A</th>
      <th colspan="3" halign="left">B</th>
    </tr>
    <tr>
      <th>second</th>
      <th>one</th>
      <th>three</th>
      <th>two</th>
      <th>one</th>
      <th>three</th>
      <th>two</th>
    </tr>
    <tr>
      <th>first</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>bar</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>baz</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>foo</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>



<p>说明1：以上内容说明了Pandas本质上具有两个索引：通常的“row index”和“column index”。<br>说明2：Pandas 还具有一个称为<code>pandas.melt</code>（<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.melt.html">https://pandas.pydata.org/pandas-docs/stable/generated/pandas.melt.html</a>)</p>
<h2 id="示例2：堆叠与去堆叠（Stack-and-Unstack）"><a href="#示例2：堆叠与去堆叠（Stack-and-Unstack）" class="headerlink" title="示例2：堆叠与去堆叠（Stack and Unstack）"></a>示例2：堆叠与去堆叠（Stack and Unstack）</h2><p><code>Stack</code>和<code>Unstack</code>是高级操作符，用于基于多级索引来重塑数据框。</p>
<ul>
<li>Stack —&gt; 向下移动数据</li>
<li>Unstack —&gt; 向上移动数据</li>
</ul>
<h2 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pivot_df = pd.pivot_table(df, values=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>], index=<span class="string">&#x27;first&#x27;</span>, columns=<span class="string">&#x27;second&#x27;</span>)</span><br><span class="line">pivot_df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">A</th>
      <th colspan="3" halign="left">B</th>
    </tr>
    <tr>
      <th>second</th>
      <th>one</th>
      <th>three</th>
      <th>two</th>
      <th>one</th>
      <th>three</th>
      <th>two</th>
    </tr>
    <tr>
      <th>first</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>bar</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>baz</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>foo</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pivot_df.stack(level=[<span class="string">&#x27;second&#x27;</span>])</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>first</th>
      <th>second</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">bar</th>
      <th>one</th>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>three</th>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>two</th>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">baz</th>
      <th>one</th>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>three</th>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>two</th>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">foo</th>
      <th>one</th>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>three</th>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>two</th>
      <td>3</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>



<p>注意：我们也可以只使用<code>pivot_df.stack()</code>，因为它将默认选择索引的“last”级别。</p>
<h2 id="Unstack"><a href="#Unstack" class="headerlink" title="Unstack"></a>Unstack</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.set_index([<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>], inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>first</th>
      <th>second</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">bar</th>
      <th>one</th>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>two</th>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>three</th>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">baz</th>
      <th>one</th>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>two</th>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>three</th>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">foo</th>
      <th>one</th>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>two</th>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>three</th>
      <td>5</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.unstack(level=[<span class="string">&#x27;first&#x27;</span>])</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">A</th>
      <th colspan="3" halign="left">B</th>
    </tr>
    <tr>
      <th>first</th>
      <th>bar</th>
      <th>baz</th>
      <th>foo</th>
      <th>bar</th>
      <th>baz</th>
      <th>foo</th>
    </tr>
    <tr>
      <th>second</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>one</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>three</th>
      <td>5</td>
      <td>5</td>
      <td>5</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
    </tr>
    <tr>
      <th>two</th>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.unstack(level=[<span class="string">&#x27;second&#x27;</span>])</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">A</th>
      <th colspan="3" halign="left">B</th>
    </tr>
    <tr>
      <th>second</th>
      <th>one</th>
      <th>three</th>
      <th>two</th>
      <th>one</th>
      <th>three</th>
      <th>two</th>
    </tr>
    <tr>
      <th>first</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>bar</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>baz</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>4</td>
    </tr>
    <tr>
      <th>foo</th>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>



<h1 id="处理日期数据"><a href="#处理日期数据" class="headerlink" title="处理日期数据"></a>处理日期数据</h1><p>Pandas具有很多内置功能来处理时间序列数据<br><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html">http://pandas.pydata.org/pandas-docs/stable/timeseries.html</a></p>
<p>文档概览：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Class</th>
<th>Remarks</th>
<th>How to create:</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Timestamp</code></td>
<td>Represents a single time stamp</td>
<td><code>to_datetime</code>, <code>Timestamp</code></td>
</tr>
<tr>
<td><code>DatetimeIndex</code></td>
<td>Index of <code>Timestamp</code></td>
<td><code>to_datetime</code>, <code>date_range</code>, <code>DatetimeIndex</code></td>
</tr>
<tr>
<td><code>Period</code></td>
<td>Represents a single time span</td>
<td><code>Period</code></td>
</tr>
<tr>
<td><code>PeriodIndex</code></td>
<td>Index of <code>Period</code></td>
<td><code>period_range</code>, <code>PeriodIndex</code></td>
</tr>
</tbody>
</table>
</div>
<h2 id="生成日期范围"><a href="#生成日期范围" class="headerlink" title="生成日期范围"></a>生成日期范围</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">date_index = pd.date_range(<span class="string">&#x27;1/1/2011&#x27;</span>, periods=len(df_auto.index), freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">date_index[<span class="number">0</span>:<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<pre><code>DatetimeIndex([&#39;2011-01-01&#39;, &#39;2011-01-02&#39;, &#39;2011-01-03&#39;, &#39;2011-01-04&#39;,
               &#39;2011-01-05&#39;],
              dtype=&#39;datetime64[ns]&#39;, freq=&#39;D&#39;)
</code></pre><p>便于解释，在<code>df_auto</code>中添加日期：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_ad = df_auto.copy()[[<span class="string">&#x27;make&#x27;</span>, <span class="string">&#x27;price&#x27;</span>]]</span><br><span class="line">df_ad[<span class="string">&#x27;date&#x27;</span>] = date_index</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_ad.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>2011-01-01</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>2011-01-02</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>2011-01-03</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389.0</td>
      <td>2011-01-04</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>2011-01-05</td>
    </tr>
  </tbody>
</table>
</div>




<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_ad.dtypes</span><br></pre></td></tr></table></figure>
<pre><code>make             object
price           float64
date     datetime64[ns]
dtype: object
</code></pre><h2 id="将-str-列转为-date-列"><a href="#将-str-列转为-date-列" class="headerlink" title="将 str 列转为 date 列"></a>将 <code>str</code> 列转为 <code>date</code> 列</h2><p>从外部导入数据的时候，会将日期数据识别成字符型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_ad[<span class="string">&#x27;date&#x27;</span>] = df_ad[<span class="string">&#x27;date&#x27;</span>].astype(str)</span><br><span class="line">df_ad[<span class="string">&#x27;date&#x27;</span>].dtypes</span><br></pre></td></tr></table></figure>
<pre><code>dtype(&#39;O&#39;)
</code></pre><p>我们现在无法对该列执行任何日期时间操作，因为它的数据类型错误！</p>
<p>幸运的是，我们可以这样修复它：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.to_datetime(df_ad[<span class="string">&#x27;date&#x27;</span>]).dtypes</span><br></pre></td></tr></table></figure>
<pre><code>dtype(&#39;&lt;M8[ns]&#39;)
</code></pre><p>或者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_ad[<span class="string">&#x27;date&#x27;</span>] = df_ad[<span class="string">&#x27;date&#x27;</span>].apply(<span class="keyword">lambda</span> x: pd.to_datetime(x))</span><br></pre></td></tr></table></figure>
<h2 id="选择特定范围内的观察值"><a href="#选择特定范围内的观察值" class="headerlink" title="选择特定范围内的观察值"></a>选择特定范围内的观察值</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.Timestamp(<span class="string">&#x27;2011-02-01&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>Timestamp(&#39;2011-02-01 00:00:00&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.to_datetime(<span class="string">&#x27;01-02-2011&#x27;</span>, format=<span class="string">&#x27;%d-%m-%Y&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>Timestamp(&#39;2011-02-01 00:00:00&#39;)
</code></pre><p>提示：通常最好明确包含格式，以避免意外行为。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_ad[df_ad.date &gt; pd.to_datetime(<span class="string">&#x27;07-03-2011&#x27;</span>, format=<span class="string">&#x27;%d-%m-%Y&#x27;</span>)]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>37</th>
      <td>Olds Delta 88</td>
      <td>4890.0</td>
      <td>2011-03-08</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Pont. Catalina</td>
      <td>5798.0</td>
      <td>2011-03-09</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Buick LeSabre</td>
      <td>5788.0</td>
      <td>2011-03-10</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Olds Omega</td>
      <td>4181.0</td>
      <td>2011-03-11</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Buick Century</td>
      <td>4816.0</td>
      <td>2011-03-12</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Olds Cutlass</td>
      <td>4733.0</td>
      <td>2011-03-13</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Dodge St. Regis</td>
      <td>6342.0</td>
      <td>2011-03-14</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Plym. Volare</td>
      <td>4060.0</td>
      <td>2011-03-15</td>
    </tr>
    <tr>
      <th>UvT_Car</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2011-03-16</td>
    </tr>
    <tr>
      <th>UvT_Bike</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2011-03-17</td>
    </tr>
  </tbody>
</table>
</div>



<p>我们也可以使用Pandas的<code>.isin()</code>代替<code>date_range</code>对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_ad[df_ad.date.isin(pd.date_range(<span class="string">&#x27;2/20/2011&#x27;</span>, <span class="string">&#x27;3/11/2011&#x27;</span>, freq=<span class="string">&#x27;D&#x27;</span>))]</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11</th>
      <td>Cad. Eldorado</td>
      <td>14500.0</td>
      <td>2011-02-20</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Merc. Cougar</td>
      <td>5379.0</td>
      <td>2011-02-21</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Buick Riviera</td>
      <td>10372.0</td>
      <td>2011-02-22</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Chev. Malibu</td>
      <td>4504.0</td>
      <td>2011-02-23</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Merc. Zephyr</td>
      <td>3291.0</td>
      <td>2011-02-24</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Olds Toronado</td>
      <td>10371.0</td>
      <td>2011-02-25</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Pont. Le Mans</td>
      <td>4723.0</td>
      <td>2011-02-26</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Linc. Continental</td>
      <td>11497.0</td>
      <td>2011-02-27</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Merc. Marquis</td>
      <td>6165.0</td>
      <td>2011-02-28</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Dodge Diplomat</td>
      <td>4010.0</td>
      <td>2011-03-01</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Dodge Magnum</td>
      <td>5886.0</td>
      <td>2011-03-02</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Plym. Horizon</td>
      <td>4482.0</td>
      <td>2011-03-03</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Buick Electra</td>
      <td>7827.0</td>
      <td>2011-03-04</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Cad. Deville</td>
      <td>11385.0</td>
      <td>2011-03-05</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Chev. Impala</td>
      <td>5705.0</td>
      <td>2011-03-06</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Olds 98</td>
      <td>8814.0</td>
      <td>2011-03-07</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Olds Delta 88</td>
      <td>4890.0</td>
      <td>2011-03-08</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Pont. Catalina</td>
      <td>5798.0</td>
      <td>2011-03-09</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Buick LeSabre</td>
      <td>5788.0</td>
      <td>2011-03-10</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Olds Omega</td>
      <td>4181.0</td>
      <td>2011-03-11</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="提取日期的组成部分"><a href="#提取日期的组成部分" class="headerlink" title="提取日期的组成部分"></a>提取日期的组成部分</h2><p>可以从日期中提取<code>day</code>,<code>month</code>和<code>year</code>：  </p>
<p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#time-date-components">http://pandas.pydata.org/pandas-docs/stable/timeseries.html#time-date-components</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_ad[<span class="string">&#x27;day&#x27;</span>] = df_ad[<span class="string">&#x27;date&#x27;</span>].apply(<span class="keyword">lambda</span> x: x.day)</span><br><span class="line">df_ad.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>date</th>
      <th>day</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>2011-01-01</td>
      <td>1</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>2011-01-02</td>
      <td>2</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>2011-01-03</td>
      <td>3</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389.0</td>
      <td>2011-01-04</td>
      <td>4</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>2011-01-05</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>



<h2 id="日期运算（Manipulate）"><a href="#日期运算（Manipulate）" class="headerlink" title="日期运算（Manipulate）"></a>日期运算（Manipulate）</h2><p>参阅： <a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html#dateoffset-objects">http://pandas.pydata.org/pandas-docs/stable/timeseries.html#dateoffset-objects</a>  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_ad[<span class="string">&#x27;new_date&#x27;</span>] = df_ad.date.apply(<span class="keyword">lambda</span> x: x + pd.DateOffset(years=<span class="number">1</span>))</span><br><span class="line">df_ad.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>make</th>
      <th>price</th>
      <th>date</th>
      <th>day</th>
      <th>new_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>Datsun 200</td>
      <td>6229.0</td>
      <td>2011-01-01</td>
      <td>1</td>
      <td>2012-01-01</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Pont. Firebird</td>
      <td>4934.0</td>
      <td>2011-01-02</td>
      <td>2</td>
      <td>2012-01-02</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Plym. Sapporo</td>
      <td>6486.0</td>
      <td>2011-01-03</td>
      <td>3</td>
      <td>2012-01-03</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Ford Fiesta</td>
      <td>4389.0</td>
      <td>2011-01-04</td>
      <td>4</td>
      <td>2012-01-04</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chev. Monza</td>
      <td>3667.0</td>
      <td>2011-01-05</td>
      <td>5</td>
      <td>2012-01-05</td>
    </tr>
  </tbody>
</table>
</div>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/17/PythonforResearch-1-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gang Li">
      <meta itemprop="description" content="Wechat Public Account: PyStaData">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LG's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/17/PythonforResearch-1-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">PythonforResearch|1_文件操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-17 12:27:03 / Modified: 14:01:02" itemprop="dateCreated datePublished" datetime="2020-08-17T12:27:03+08:00">2020-08-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>创建日期：</strong> 20200805 14:20<br><strong>上次修改：</strong> 20200805 15:10<br><strong>Python版本：</strong> Python 3.7  </p>
<p>项目介绍：一直想写一份适合经济学等社科背景、学术科研向的Python教程。因为学经济学的多少会对Stata有所了解，有一些写<del>代码</del>命令的经历，这份教程应该：</p>
<ul>
<li>简洁好理解，花最少的时间了解 Python 的核心用法；</li>
<li>实用易操作，最好是能够看完上手即用。</li>
</ul>
<p>在构思了一段时间之后，偶然发现 Ties de Kok 的 <a target="_blank" rel="noopener" href="https://github.com/TiesdeKok/LearnPythonforResearch">Get started with Python for research tutorial</a>项目已经搭建出了我想要的框架。于是打算在这个项目的基础上进行完善，首先将其主要内容“汉化”成中文，之后对用法进行扩充、加入典型用法和案例。</p>
<blockquote>
<p>原作者简介：Ties de Kok (<a target="_blank" rel="noopener" href="http://www.tiesdekok.com">Personal Website</a>)为华盛顿大学福斯特商学院的助理教授，他专注于将计算机科学与实证会计研究相结合，研究兴趣是财务会计、资本市场、计算机科学、自然语言处理和经验管理会计。</p>
</blockquote>
<p>往期目录：</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/rA5kgJvA8eQHRjx9pUGoXA">PythonforResearch | 0_语法基础</a></p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>使用 Pytnon 可以打开多种格式的数据文件，本节仅介绍一些亲测比较好用的方式。后文提及的所有数据都在<code>data</code>文件夹内，生成这些数据的代码在文末。</p>
<h1 id="导入库"><a href="#导入库" class="headerlink" title="导入库"></a>导入库</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> json</span><br></pre></td></tr></table></figure>
<p>为了方便，下面这种引用方式可以使用<code>join</code>代替<code>os.path.join</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> join</span><br></pre></td></tr></table></figure>
<h1 id="文件夹建立索引"><a href="#文件夹建立索引" class="headerlink" title="文件夹建立索引"></a>文件夹建立索引</h1><p>将文件夹建立索引对打开文件非常有用,例如要要遍历文件夹中的所有文件,当然有多种实现方式，但是下面将主要介绍<code>os.listdir</code>,<code>glob</code>和<code>os.walk</code>。</p>
<h2 id="定义路径"><a href="#定义路径" class="headerlink" title="定义路径"></a>定义路径</h2><p>示例中所需数据都在<code>data</code>文件夹中，所以首先如下定义路径：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_path = join(os.getcwd(), <span class="string">&#x27;data&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="获取根目录下所有文件"><a href="#获取根目录下所有文件" class="headerlink" title="获取根目录下所有文件"></a>获取根目录下所有文件</h2><p>注意：这种方式会忽略子文件夹中的文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filenames = os.listdir(data_path)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filepaths = [join(data_path, filename) <span class="keyword">for</span> filename <span class="keyword">in</span> filenames]</span><br><span class="line">filepaths[:<span class="number">2</span>] <span class="comment"># show first two items</span></span><br></pre></td></tr></table></figure>
<pre><code>[&#39;D:\\PyStaData\\Python\\Python_for_Research\\PythonforResearch\\data\\311-service-requests.csv&#39;,
 &#39;D:\\PyStaData\\Python\\Python_for_Research\\PythonforResearch\\data\\auto_df.csv&#39;]
</code></pre><p>使用<code>glob</code>，因为它直接允许包含路径名匹配。例如，如果只想要Excel<code>.xlsx</code>文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glob(join(data_path, <span class="string">&#x27;*.xlsx&#x27;</span>))</span><br></pre></td></tr></table></figure>
<pre><code>[&#39;D:\\PyStaData\\Python\\Python_for_Research\\PythonforResearch\\data\\excel_sample.xlsx&#39;]
</code></pre><h2 id="获取所有文件（包含子文件夹）"><a href="#获取所有文件（包含子文件夹）" class="headerlink" title="获取所有文件（包含子文件夹）"></a>获取所有文件（包含子文件夹）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果文件夹包含多个级别，则需要使用`os.walk()`或`glob`：</span><br></pre></td></tr></table></figure>
<pre><code>  File &quot;&lt;ipython-input-23-62a5d92e9698&gt;&quot;, line 1
    如果文件夹包含多个级别，则需要使用`os.walk()`或`glob`：
                    ^
SyntaxError: invalid character in identifier
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">folder = os.getcwd()</span><br><span class="line">filepaths = []</span><br><span class="line"><span class="keyword">for</span> root,dirs,files <span class="keyword">in</span> os.walk(folder):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> files:</span><br><span class="line">        filepaths.append(join(root,i))</span><br><span class="line">filepaths[:<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<pre><code>[&#39;D:\\PyStaData\\Python\\Python_for_Research\\PythonforResearch\\0_语法基础.ipynb&#39;,
 &#39;D:\\PyStaData\\Python\\Python_for_Research\\PythonforResearch\\1_文件打开与保存.ipynb&#39;]
</code></pre><p>使用 <code>glob</code>会产生更清晰的代码,但是会更晦涩：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filepaths_glob = glob(join(folder, <span class="string">&#x27;**/*&#x27;</span>), recursive=<span class="literal">True</span>)</span><br><span class="line">filepaths_glob[:<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<pre><code>[&#39;D:\\PyStaData\\Python\\Python_for_Research\\PythonforResearch\\0_语法基础.ipynb&#39;,
 &#39;D:\\PyStaData\\Python\\Python_for_Research\\PythonforResearch\\1_文件打开与保存.ipynb&#39;]
</code></pre><h1 id="文本文件"><a href="#文本文件" class="headerlink" title="文本文件"></a>文本文件</h1><p>使用Python默认库，打开文件的四种模式：</p>
<p><code>w</code> -&gt; write only<br><code>r</code> -&gt; read only<br><code>w+</code> -&gt; read and write + completely overwrite file<br><code>a+</code> -&gt; read and write + append at the bottom</p>
<h2 id="打开文件"><a href="#打开文件" class="headerlink" title="打开文件"></a>打开文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(join(data_path, <span class="string">&#x27;text_sample.txt&#x27;</span>), <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file_content = file.read()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(file_content)</span><br></pre></td></tr></table></figure>
<pre><code>Learning Python is great. 
Good luck!
</code></pre><h2 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(join(data_path, <span class="string">&#x27;text_sample.txt&#x27;</span>), <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(<span class="string">&#x27;Learning Python is great. \nGood luck!&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>除了使用<code>with</code>，也可以使用<code>open</code>和<code>close</code>打开文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = open(join(data_path, <span class="string">&#x27;text_sample.txt&#x27;</span>), <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">file_content = f.read()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>使用<code>open</code>记得最后一定要<code>.close()</code>,否则会因为文件被占用而报错。因此，推荐使用<code>with</code>方法，它会自动关闭文件。</p>
<h2 id="文件索引中循环"><a href="#文件索引中循环" class="headerlink" title="文件索引中循环"></a>文件索引中循环</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">text_files = glob(join(data_path, <span class="string">&#x27;*.txt&#x27;</span>))</span><br><span class="line">text_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> text_files:</span><br><span class="line">    <span class="keyword">with</span> open(i, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        text_list.append(f.read())</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text_list</span><br></pre></td></tr></table></figure>
<pre><code>[&#39;Content of new file. \nHi there!\nNew line&#39;,
 &#39;Learning Python is great. \nGood luck!&#39;]
</code></pre><h1 id="Excel-文件"><a href="#Excel-文件" class="headerlink" title="Excel 文件"></a>Excel 文件</h1><p>有多种方式打开Excel、csv、Stata和SAS数据集，但这里主要介绍使用 <code>Pandas</code> 库。</p>
<h2 id="打开Excel文件"><a href="#打开Excel文件" class="headerlink" title="打开Excel文件"></a>打开Excel文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">excel_file = pd.read_excel(join(data_path, <span class="string">&#x27;excel_sample.xlsx&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><code>read_excel()</code>函数具有许多选项，可以参阅：<br><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_excel.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_excel.html</a>  </p>
<p><strong>提示</strong>：有时候需要指定编码类型来防止编码报错，例如：<code>,encoding=&#39;utf-8&#39;</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 保存Excel文件</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">excel_file.to_excel(join(data_path, <span class="string">&#x27;excel_sample.xlsx&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>这将保存 Pandas 的数据框（DataFrame）对象，请参见数据处理文件:<br><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_excel.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_excel.html</a>  </p>
<h1 id="CSV-文件"><a href="#CSV-文件" class="headerlink" title="CSV 文件"></a>CSV 文件</h1><h2 id="打开-CSV-文件"><a href="#打开-CSV-文件" class="headerlink" title="打开 CSV 文件"></a>打开 CSV 文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csv_file = pd.read_csv(join(data_path, <span class="string">&#x27;csv_sample.csv&#x27;</span>), sep=<span class="string">&#x27;,&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_csv.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_csv.html</a></p>
<h2 id="保存-CSV-文件"><a href="#保存-CSV-文件" class="headerlink" title="保存 CSV 文件"></a>保存 CSV 文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csv_file.to_csv(join(data_path, <span class="string">&#x27;csv_sample.csv&#x27;</span>), sep=<span class="string">&#x27;,&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_csv.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_csv.html</a></p>
<h1 id="Stata-文件"><a href="#Stata-文件" class="headerlink" title="Stata 文件"></a>Stata 文件</h1><h2 id="打开Stata数据"><a href="#打开Stata数据" class="headerlink" title="打开Stata数据"></a>打开Stata数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stata_file = pd.read_stata(join(data_path, <span class="string">&#x27;stata_sample.dta&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_stata.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_stata.html</a>  </p>
<h2 id="保存Stata数据"><a href="#保存Stata数据" class="headerlink" title="保存Stata数据"></a>保存Stata数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stata_file.to_stata(join(data_path, <span class="string">&#x27;stata_sample.dta&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_stata.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.to_stata.html</a></p>
<p><strong>提示</strong>：请确保更新至适用于新Stata版本的最新版本的Pandas。</p>
<h1 id="SAS-文件"><a href="#SAS-文件" class="headerlink" title="SAS 文件"></a>SAS 文件</h1><p>Pandas 只能打开 SAS 文件，不能写入数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sas_file &#x3D; pd.read_sas(r&#39;C:\file.sas7bdat&#39;, format&#x3D;&#39;sas7bdat&#39;)</span><br></pre></td></tr></table></figure></p>
<p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_sas.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_sas.html</a><br>此功能在大多数情况下都有效，但是带有文本的文件可能会很难修复编码错误。</p>
<h1 id="Json-文件"><a href="#Json-文件" class="headerlink" title="Json 文件"></a>Json 文件</h1><h2 id="使用-Pandas-库"><a href="#使用-Pandas-库" class="headerlink" title="使用 Pandas 库"></a>使用 Pandas 库</h2><p><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_json.html">http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_json.html</a>  </p>
<p><em>提示：</em>路径也可以是链接（url） </p>
<h3 id="将-JSON-读入为-dataframe"><a href="#将-JSON-读入为-dataframe" class="headerlink" title="将 JSON 读入为 dataframe"></a>将 JSON 读入为 dataframe</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json_df = pd.read_json(join(data_path, <span class="string">&#x27;json_sample.json&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h3 id="将-dataframe-保存为-JSON"><a href="#将-dataframe-保存为-JSON" class="headerlink" title="将 dataframe 保存为 JSON"></a>将 dataframe 保存为 JSON</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json_df.to_json(join(data_path, <span class="string">&#x27;json_sample.json&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h2 id="使用-JSON-库"><a href="#使用-JSON-库" class="headerlink" title="使用 JSON 库"></a>使用 <code>JSON</code> 库</h2><h3 id="读取-JSON"><a href="#读取-JSON" class="headerlink" title="读取 JSON"></a>读取 JSON</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(join(data_path, <span class="string">&#x27;json_sample.json&#x27;</span>), <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json_data = json.load(f)</span><br></pre></td></tr></table></figure>
<h3 id="写入-Json"><a href="#写入-Json" class="headerlink" title="写入 Json"></a>写入 Json</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(join(data_path, <span class="string">&#x27;json_sample.json&#x27;</span>), <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(json_data, f)</span><br></pre></td></tr></table></figure>
<h1 id="生成示例数据文件的代码"><a href="#生成示例数据文件的代码" class="headerlink" title="生成示例数据文件的代码"></a>生成示例数据文件的代码</h1><p>带有随机数的字典：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">raw_data = &#123;<span class="string">&#x27;foreign&#x27;</span>:&#123;<span class="number">1</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">2</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">3</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">6</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">7</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">8</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">9</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">14</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">21</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">23</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">24</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">30</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">31</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">33</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">37</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">38</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">43</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">48</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">50</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">51</span>:<span class="string">&#x27;Domestic&#x27;</span>,<span class="number">53</span>:<span class="string">&#x27;Foreign&#x27;</span>,<span class="number">56</span>:<span class="string">&#x27;Foreign&#x27;</span>,<span class="number">57</span>:<span class="string">&#x27;Foreign&#x27;</span>,<span class="number">66</span>:<span class="string">&#x27;Foreign&#x27;</span>,<span class="number">70</span>:<span class="string">&#x27;Foreign&#x27;</span>&#125;,</span><br><span class="line">            <span class="string">&#x27;make&#x27;</span>:&#123;<span class="number">1</span>:<span class="string">&#x27;AMCPacer&#x27;</span>,<span class="number">2</span>:<span class="string">&#x27;AMCSpirit&#x27;</span>,<span class="number">3</span>:<span class="string">&#x27;BuickCentury&#x27;</span>,<span class="number">6</span>:<span class="string">&#x27;BuickOpel&#x27;</span>,<span class="number">7</span>:<span class="string">&#x27;BuickRegal&#x27;</span>,<span class="number">8</span>:<span class="string">&#x27;BuickRiviera&#x27;</span>,<span class="number">9</span>:<span class="string">&#x27;BuickSkylark&#x27;</span>,<span class="number">14</span>:<span class="string">&#x27;Chev.Impala&#x27;</span>,<span class="number">21</span>:<span class="string">&#x27;DodgeMagnum&#x27;</span>,<span class="number">23</span>:<span class="string">&#x27;FordFiesta&#x27;</span>,<span class="number">24</span>:<span class="string">&#x27;FordMustang&#x27;</span>,<span class="number">30</span>:<span class="string">&#x27;Merc.Marquis&#x27;</span>,<span class="number">31</span>:<span class="string">&#x27;Merc.Monarch&#x27;</span>,<span class="number">33</span>:<span class="string">&#x27;Merc.Zephyr&#x27;</span>,<span class="number">37</span>:<span class="string">&#x27;OldsDelta88&#x27;</span>,<span class="number">38</span>:<span class="string">&#x27;OldsOmega&#x27;</span>,<span class="number">43</span>:<span class="string">&#x27;Plym.Horizon&#x27;</span>,<span class="number">48</span>:<span class="string">&#x27;Pont.GrandPrix&#x27;</span>,<span class="number">50</span>:<span class="string">&#x27;Pont.Phoenix&#x27;</span>,<span class="number">51</span>:<span class="string">&#x27;Pont.Sunbird&#x27;</span>,<span class="number">53</span>:<span class="string">&#x27;AudiFox&#x27;</span>,<span class="number">56</span>:<span class="string">&#x27;Datsun210&#x27;</span>,<span class="number">57</span>:<span class="string">&#x27;Datsun510&#x27;</span>,<span class="number">66</span>:<span class="string">&#x27;ToyotaCelica&#x27;</span>,<span class="number">70</span>:<span class="string">&#x27;VWDiesel&#x27;</span>&#125;,</span><br><span class="line">            <span class="string">&#x27;price&#x27;</span>: &#123;<span class="number">1</span>:<span class="number">4749</span>,<span class="number">2</span>:<span class="number">3799</span>,<span class="number">3</span>:<span class="number">4816</span>,<span class="number">6</span>:<span class="number">4453</span>,<span class="number">7</span>:<span class="number">5189</span>,<span class="number">8</span>:<span class="number">10372</span>,<span class="number">9</span>:<span class="number">4082</span>,<span class="number">14</span>:<span class="number">5705</span>,<span class="number">21</span>:<span class="number">5886</span>,<span class="number">23</span>:<span class="number">4389</span>,<span class="number">24</span>:<span class="number">4187</span>,<span class="number">30</span>:<span class="number">6165</span>,<span class="number">31</span>:<span class="number">4516</span>,<span class="number">33</span>:<span class="number">3291</span>,<span class="number">37</span>:<span class="number">4890</span>,<span class="number">38</span>:<span class="number">4181</span>,<span class="number">43</span>:<span class="number">4482</span>,<span class="number">48</span>:<span class="number">5222</span>,<span class="number">50</span>:<span class="number">4424</span>,<span class="number">51</span>:<span class="number">4172</span>,<span class="number">53</span>:<span class="number">6295</span>,<span class="number">56</span>:<span class="number">4589</span>,<span class="number">57</span>:<span class="number">5079</span>,<span class="number">66</span>:<span class="number">5899</span>,<span class="number">70</span>:<span class="number">5397</span>&#125;,</span><br><span class="line">            <span class="string">&#x27;weight&#x27;</span>:&#123;<span class="number">1</span>:<span class="number">3350</span>,<span class="number">2</span>:<span class="number">2640</span>,<span class="number">3</span>:<span class="number">3250</span>,<span class="number">6</span>:<span class="number">2230</span>,<span class="number">7</span>:<span class="number">3280</span>,<span class="number">8</span>:<span class="number">3880</span>,<span class="number">9</span>:<span class="number">3400</span>,<span class="number">14</span>:<span class="number">3690</span>,<span class="number">21</span>:<span class="number">3600</span>,<span class="number">23</span>:<span class="number">1800</span>,<span class="number">24</span>:<span class="number">2650</span>,<span class="number">30</span>:<span class="number">3720</span>,<span class="number">31</span>:<span class="number">3370</span>,<span class="number">33</span>:<span class="number">2830</span>,<span class="number">37</span>:<span class="number">3690</span>,<span class="number">38</span>:<span class="number">3370</span>,<span class="number">43</span>:<span class="number">2200</span>,<span class="number">48</span>:<span class="number">3210</span>,<span class="number">50</span>:<span class="number">3420</span>,<span class="number">51</span>:<span class="number">2690</span>,<span class="number">53</span>:<span class="number">2070</span>,<span class="number">56</span>:<span class="number">2020</span>,<span class="number">57</span>:<span class="number">2280</span>,<span class="number">66</span>:<span class="number">2410</span>,<span class="number">70</span>:<span class="number">2040</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>将字典转换为Pandas的dataframe,便于保存：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_data = pd.DataFrame(raw_data)</span><br><span class="line">df_data.head()</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>foreign</th>
      <th>make</th>
      <th>price</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Domestic</td>
      <td>AMCPacer</td>
      <td>4749</td>
      <td>3350</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Domestic</td>
      <td>AMCSpirit</td>
      <td>3799</td>
      <td>2640</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Domestic</td>
      <td>BuickCentury</td>
      <td>4816</td>
      <td>3250</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Domestic</td>
      <td>BuickOpel</td>
      <td>4453</td>
      <td>2230</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Domestic</td>
      <td>BuickRegal</td>
      <td>5189</td>
      <td>3280</td>
    </tr>
  </tbody>
</table>
</div>



<p>保存为不同类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_path = os.path.join(os.getcwd(), <span class="string">&#x27;data&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(os.path.join(data_path, <span class="string">&#x27;text_sample.txt&#x27;</span>), <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(<span class="string">&#x27;Learning Python is great. \nGood luck!&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df_data.to_excel(os.path.join(data_path, <span class="string">&#x27;excel_sample.xlsx&#x27;</span>))</span><br><span class="line">df_data.to_csv(os.path.join(data_path, <span class="string">&#x27;csv_sample.csv&#x27;</span>))</span><br><span class="line">df_data.to_stata(os.path.join(data_path, <span class="string">&#x27;stata_sample.dta&#x27;</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_data.to_json(os.path.join(data_path, <span class="string">&#x27;json_sample.json&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong> pandas 没有 <code>.to_sas()</code> 函数。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Gang Li</p>
  <div class="site-description" itemprop="description">Wechat Public Account: PyStaData</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">41</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gang Li</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
